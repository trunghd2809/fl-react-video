(function(e,t){'object'==typeof exports&&'undefined'!=typeof module?t(exports,require('react'),require('react-dom')):'function'==typeof define&&define.amd?define(['exports','react','react-dom'],t):t(e['video-react']={},e.React,e.ReactDOM)})(this,function(e,t,a){'use strict';function r(e,t){return t={exports:{}},e(t,t.exports),t.exports}function n(e){if(null===e||e===void 0)throw new TypeError('Object.assign cannot be called with null or undefined');return Object(e)}function o(){}function i(e){var t=e.Symbol,a;return'function'==typeof t?t.observable?a=t.observable:(a=t('observable'),t.observable=a):a='@@observable',a}function d(e){if('object'!==('undefined'==typeof e?'undefined':N(e))||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function s(e,t,a){function r(){g===c&&(g=c.slice())}function n(){if(f)throw new Error('You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.');return u}function o(e){if('function'!=typeof e)throw new Error('Expected the listener to be a function.');if(f)throw new Error('You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.');var t=!0;return r(),g.push(e),function(){if(t){if(f)throw new Error('You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.');t=!1,r();var a=g.indexOf(e);g.splice(a,1)}}}function i(e){if(!d(e))throw new Error('Actions must be plain objects. Use custom middleware for async actions.');if('undefined'==typeof e.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(f)throw new Error('Reducers may not dispatch actions.');try{f=!0,u=p(u,e)}finally{f=!1}for(var t=c=g,a=0,r;a<t.length;a++)r=t[a],r();return e}var l;if('function'==typeof t&&'function'==typeof a||'function'==typeof a&&'function'==typeof arguments[3])throw new Error('It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function');if('function'==typeof t&&'undefined'==typeof a&&(a=t,t=void 0),'undefined'!=typeof a){if('function'!=typeof a)throw new Error('Expected the enhancer to be a function.');return a(s)(e,t)}if('function'!=typeof e)throw new Error('Expected the reducer to be a function.');var p=e,u=t,c=[],g=c,f=!1;return i({type:z.INIT}),l={dispatch:i,subscribe:o,getState:n,replaceReducer:function(e){if('function'!=typeof e)throw new Error('Expected the nextReducer to be a function.');p=e,i({type:z.REPLACE})}},l[q]=function(){var e=o,t;return t={subscribe:function(t){function a(){t.next&&t.next(n())}if('object'!==('undefined'==typeof t?'undefined':N(t))||null===t)throw new TypeError('Expected the observer to be an object.');a();var r=e(a);return{unsubscribe:r}}},t[q]=function(){return this},t},l}function l(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:$,t=arguments[1];switch(t.type){case'video-react/USER_ACTIVATE':return U({},e,{userActivity:t.activity});case'video-react/PLAYER_ACTIVATE':return U({},e,{isActive:t.activity});case'video-react/FULLSCREEN_CHANGE':return U({},e,{isFullscreen:!!t.isFullscreen});case'video-react/SEEKING_TIME':return U({},e,{seekingTime:t.time});case'video-react/END_SEEKING':return U({},e,{seekingTime:0});case'video-react/LOAD_START':return U({},e,t.videoProps,{hasStarted:!1,ended:!1});case'video-react/CAN_PLAY':return U({},e,t.videoProps,{waiting:!1});case'video-react/WAITING':return U({},e,t.videoProps,{waiting:!0});case'video-react/CAN_PLAY_THROUGH':case'video-react/PLAYING':return U({},e,t.videoProps,{waiting:!1});case'video-react/PLAY':return U({},e,t.videoProps,{ended:!1,paused:!1,autoPaused:!1,waiting:!1,hasStarted:!0});case'video-react/PAUSE':return U({},e,t.videoProps,{paused:!0});case'video-react/END':return U({},e,t.videoProps,{ended:!0});case'video-react/SEEKING':return U({},e,t.videoProps,{seeking:!0});case'video-react/SEEKED':return U({},e,t.videoProps,{seeking:!1});case'video-react/ERROR':return U({},e,t.videoProps,{error:'UNKNOWN ERROR',ended:!0});case'video-react/DURATION_CHANGE':case'video-react/TIME_UPDATE':case'video-react/VOLUME_CHANGE':case'video-react/PROGRESS_CHANGE':case'video-react/RATE_CHANGE':case'video-react/SUSPEND':case'video-react/ABORT':case'video-react/EMPTIED':case'video-react/STALLED':case'video-react/LOADED_META_DATA':case'video-react/LOADED_DATA':case'video-react/RESIZE':var a=U({},e,t.videoProps);return!1===t.videoProps.paused&&(a.hasStarted=!0,a.waiting=!1),a;default:return e;}}function p(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:ee,t=arguments[1];switch(t.type){case'video-react/OPERATE':return U({},e,{count:e.count+1,operation:U({},e.operation,t.operation)});default:return e;}}function u(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},t=arguments[1];return{player:l(e.player,t),operation:p(e.operation,t)}}function c(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:e,a=L(e%60),r=L(e/60%60),n=L(e/3600),o=L(t/60%60),i=L(t/3600);return(isNaN(e)||e===1/0)&&(n=r=a='-'),n=0<n||0<i?n+':':'',r=((n||10<=o)&&10>r?'0'+r:r)+':',a=10>a?'0'+a:a,n+r+a}function g(e){return!!(e.props&&e.props.isVideoChild)||'source'===e.type||'track'===e.type}function f(e,t){var a=arguments,r=!1;return function(){r||(e.apply(null,a),r=!0,setTimeout(function(){r=!1},t))}}function y(e){var t;if(e.getBoundingClientRect&&e.parentNode&&(t=e.getBoundingClientRect()),!t)return{left:0,top:0};var a=document.documentElement,r=document.body,n=a.clientLeft||r.clientLeft||0,o=window.pageXOffset||r.scrollLeft,i=t.left+o-n,d=a.clientTop||r.clientTop||0,s=window.pageYOffset||r.scrollTop,l=t.top+s-d;return{left:k(i),top:k(l)}}function m(e,t){var a={},r=y(e),n=e.offsetWidth,o=e.offsetHeight,i=r.top,d=r.left,s=t.pageY,l=t.pageX;return t.changedTouches&&(l=t.changedTouches[0].pageX,s=t.changedTouches[0].pageY),a.y=R(0,A(1,(i-s+o)/o)),a.x=R(0,A(1,(l-d)/n)),a}function h(e,t){for(var a=e.className.split(' '),r=0;r<a.length;r++)if(a[r].toLowerCase()===t.toLowerCase())return!0;return!1}function v(e){var t=e.percentage;return P.createElement('div',{className:'video-volume-level video-control',style:{width:''+t}})}function E(e){var t=e.currentTime,a=e.duration,r=e.percentage;return P.createElement('div',{"data-current-time":c(t,a),className:'video-play-progress video-slider-bar',style:{width:r}})}function b(e){function t(e,t){var a=e/t||0;return 100*(1<=a?1:a)+'%'}var a=e.buffered,r=e.duration;if(!a||!a.length)return null;var n=a.end(a.length-1),o={};n>r&&(n=r),o.width=t(n,r);for(var d=[],s=0;s<a.length;s++){var l=a.start(s),p=a.end(s),u=P.createElement('div',{style:{left:t(l,n),width:t(p-l,n)},key:'part-'+s});d.push(u)}return 0===d.length&&(d=null),P.createElement('div',{style:o,className:'video-load-progress'},d)}function T(e){var t=e.duration,a=e.mouseTime,r=e.text;if(!a.time)return null;var n=r||c(a.time,t);return P.createElement('span',{className:'video-mouse-time-display video-control',style:{left:a.position+'px'}},n)}function S(e){var t=e.player,a=t.currentTime,r=t.duration,n=c(a,r);return P.createElement('span',{className:'video-current-time'},n)}function _(e){var t=e.player.duration,a=c(t);return P.createElement('span',{className:'video-duration-display'},a)}var R=Math.max,A=Math.min,k=Math.round,L=Math.floor,D=String.fromCharCode,P='default'in t?t['default']:t,C='undefined'==typeof window?'undefined'==typeof global?'undefined'==typeof self?{}:self:global:window,I=Object.getOwnPropertySymbols,O=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable,x=function(){try{if(!Object.assign)return!1;var e=new String('abc');if(e[5]='de','5'===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},a=0;10>a;a++)t['_'+D(a)]=a;var r=Object.getOwnPropertyNames(t).map(function(e){return t[e]});if('0123456789'!==r.join(''))return!1;var n={};return['a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t'].forEach(function(e){n[e]=e}),'abcdefghijklmnopqrst'===Object.keys(Object.assign({},n)).join('')}catch(e){return!1}}()?Object.assign:function(e){for(var t=n(e),a=1,r,o;a<arguments.length;a++){for(var d in r=Object(arguments[a]),r)O.call(r,d)&&(t[d]=r[d]);if(I){o=I(r);for(var l=0;l<o.length;l++)F.call(r,o[l])&&(t[o[l]]=r[o[l]])}}return t},N='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&'function'==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?'symbol':typeof e},w=function(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')},M=function(){function e(e,t){for(var a=0,r;a<t.length;a++)r=t[a],r.enumerable=r.enumerable||!1,r.configurable=!0,'value'in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),U=Object.assign||function(e){for(var t=1,a;t<arguments.length;t++)for(var r in a=arguments[t],a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r]);return e},B=function(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},G=function(e,t){if(!e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return t&&('object'==typeof t||'function'==typeof t)?t:e},K=function(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)},H=function(){function e(e,t,a,r,n,o){if('SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED'!==o){var i=new Error('Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types');throw i.name='Invariant Violation',i}}function t(){return e}e.isRequired=e;var a={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t};return a.checkPropTypes=o,a.PropTypes=a,a},V=r(function(e){e.exports=H()}),W=r(function(e){(function(){function t(){for(var e=[],r=0,n;r<arguments.length;r++)if(n=arguments[r],n){var o='undefined'==typeof n?'undefined':N(n);if('string'===o||'number'===o)e.push(n);else if(Array.isArray(n)&&n.length){var d=t.apply(null,n);d&&e.push(d)}else if('object'===o)for(var s in n)a.call(n,s)&&n[s]&&e.push(s)}return e.join(' ')}var a={}.hasOwnProperty;e.exports?(t.default=t,e.exports=t):window.classNames=t})()}),Y;Y='undefined'==typeof self?'undefined'==typeof window?'undefined'==typeof global?'undefined'==typeof module?Function('return this')():module:global:window:self;var q=i(Y),j=function(){return Math.random().toString(36).substring(7).split('').join('.')},z={INIT:'@@redux/INIT'+j(),REPLACE:'@@redux/REPLACE'+j(),PROBE_UNKNOWN_ACTION:function(){return'@@redux/PROBE_UNKNOWN_ACTION'+j()}},X=Object.freeze({LOAD_START:'video-react/LOAD_START',CAN_PLAY:'video-react/CAN_PLAY',WAITING:'video-react/WAITING',CAN_PLAY_THROUGH:'video-react/CAN_PLAY_THROUGH',PLAYING:'video-react/PLAYING',PLAY:'video-react/PLAY',PAUSE:'video-react/PAUSE',END:'video-react/END',SEEKING:'video-react/SEEKING',SEEKED:'video-react/SEEKED',SEEKING_TIME:'video-react/SEEKING_TIME',END_SEEKING:'video-react/END_SEEKING',DURATION_CHANGE:'video-react/DURATION_CHANGE',TIME_UPDATE:'video-react/TIME_UPDATE',VOLUME_CHANGE:'video-react/VOLUME_CHANGE',PROGRESS_CHANGE:'video-react/PROGRESS_CHANGE',RATE_CHANGE:'video-react/RATE_CHANGE',SUSPEND:'video-react/SUSPEND',ABORT:'video-react/ABORT',EMPTIED:'video-react/EMPTIED',STALLED:'video-react/STALLED',LOADED_META_DATA:'video-react/LOADED_META_DATA',LOADED_DATA:'video-react/LOADED_DATA',RESIZE:'video-react/RESIZE',ERROR:'video-react/ERROR',handleLoadStart:function(e){return{type:'video-react/LOAD_START',videoProps:e}},handleCanPlay:function(e){return{type:'video-react/CAN_PLAY',videoProps:e}},handleWaiting:function(e){return{type:'video-react/WAITING',videoProps:e}},handleCanPlayThrough:function(e){return{type:'video-react/CAN_PLAY_THROUGH',videoProps:e}},handlePlaying:function(e){return{type:'video-react/PLAYING',videoProps:e}},handlePlay:function(e){return{type:'video-react/PLAY',videoProps:e}},handlePause:function(e){return{type:'video-react/PAUSE',videoProps:e}},handleEnd:function(e){return{type:'video-react/END',videoProps:e}},handleSeeking:function(e){return{type:'video-react/SEEKING',videoProps:e}},handleSeeked:function(e){return{type:'video-react/SEEKED',videoProps:e}},handleDurationChange:function(e){return{type:'video-react/DURATION_CHANGE',videoProps:e}},handleTimeUpdate:function(e){return{type:'video-react/TIME_UPDATE',videoProps:e}},handleVolumeChange:function(e){return{type:'video-react/VOLUME_CHANGE',videoProps:e}},handleProgressChange:function(e){return{type:'video-react/PROGRESS_CHANGE',videoProps:e}},handleRateChange:function(e){return{type:'video-react/RATE_CHANGE',videoProps:e}},handleSuspend:function(e){return{type:'video-react/SUSPEND',videoProps:e}},handleAbort:function(e){return{type:'video-react/ABORT',videoProps:e}},handleEmptied:function(e){return{type:'video-react/EMPTIED',videoProps:e}},handleStalled:function(e){return{type:'video-react/STALLED',videoProps:e}},handleLoadedMetaData:function(e){return{type:'video-react/LOADED_META_DATA',videoProps:e}},handleLoadedData:function(e){return{type:'video-react/LOADED_DATA',videoProps:e}},handleResize:function(e){return{type:'video-react/RESIZE',videoProps:e}},handleError:function(e){return{type:'video-react/ERROR',videoProps:e}},handleSeekingTime:function(e){return{type:'video-react/SEEKING_TIME',time:e}},handleEndSeeking:function(e){return{type:'video-react/END_SEEKING',time:e}}}),Q=function(){function e(){w(this,e)}return M(e,[{key:'request',value:function(e){e.requestFullscreen?e.requestFullscreen():e.webkitEnterFullScreen?e.webkitEnterFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen()}},{key:'exit',value:function(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()}},{key:'addEventListener',value:function(e){document.addEventListener('fullscreenchange',e),document.addEventListener('webkitfullscreenchange',e),document.addEventListener('mozfullscreenchange',e),document.addEventListener('MSFullscreenChange',e)}},{key:'removeEventListener',value:function(e){document.removeEventListener('fullscreenchange',e),document.removeEventListener('webkitfullscreenchange',e),document.removeEventListener('mozfullscreenchange',e),document.removeEventListener('MSFullscreenChange',e)}},{key:'isFullscreen',get:function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement}},{key:'enabled',get:function(){return document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled}}]),e}(),Z=new Q,J=Object.freeze({OPERATE:'video-react/OPERATE',FULLSCREEN_CHANGE:'video-react/FULLSCREEN_CHANGE',PLAYER_ACTIVATE:'video-react/PLAYER_ACTIVATE',USER_ACTIVATE:'video-react/USER_ACTIVATE',handleFullscreenChange:function(e){return{type:'video-react/FULLSCREEN_CHANGE',isFullscreen:e}},activate:function(e){return{type:'video-react/PLAYER_ACTIVATE',activity:e}},userActivate:function(e){return{type:'video-react/USER_ACTIVATE',activity:e}},play:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{action:'play',source:''};return this.video.play(),{type:'video-react/OPERATE',operation:e}},pause:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{action:'pause',source:''};return this.video.pause(),{type:'video-react/OPERATE',operation:e}},togglePlay:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{action:'toggle-play',source:''};return this.video.togglePlay(),{type:'video-react/OPERATE',operation:e}},seek:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{action:'seek',source:''};return this.video.seek(e),{type:'video-react/OPERATE',operation:t}},forward:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{action:'forward-'+e,source:''};return this.video.forward(e),{type:'video-react/OPERATE',operation:t}},replay:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{action:'replay-'+e,source:''};return this.video.replay(e),{type:'video-react/OPERATE',operation:t}},changeRate:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{action:'change-rate',source:''};return this.video.playbackRate=e,{type:'video-react/OPERATE',operation:t}},changeVolume:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{action:'change-volume',source:''},a=e;return 0>e&&(a=0),1<e&&(a=1),this.video.volume=a,{type:'video-react/OPERATE',operation:t}},mute:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{action:e?'muted':'unmuted',source:''};return this.video.muted=e,{type:'video-react/OPERATE',operation:t}},toggleFullscreen:function(e){return Z.enabled?(Z.isFullscreen?Z.exit():Z.request(this.rootElement),{type:'video-react/OPERATE',operation:{action:'toggle-fullscreen',source:''}}):{type:'video-react/FULLSCREEN_CHANGE',isFullscreen:!e.isFullscreen}}}),$={currentSrc:null,duration:0,currentTime:0,seekingTime:0,buffered:null,waiting:!1,seeking:!1,paused:!0,autoPaused:!1,ended:!1,playbackRate:1,muted:!1,volume:1,readyState:0,networkState:0,videoWidth:0,videoHeight:0,hasStarted:!1,userActivity:!1,isActive:!1,isFullscreen:!1},ee={count:0,operation:{action:'',source:''}},te=function(){function e(t){w(this,e),this.store=t||s(u,window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__()),this.video=null,this.rootElement=null}return M(e,[{key:'getActions',value:function(){function e(e){return function(){var r=e.apply(t,arguments);'undefined'!=typeof r&&a(r)}}var t=this,a=this.store.dispatch,r=U({},J,X);return Object.keys(r).filter(function(e){return'function'==typeof r[e]}).reduce(function(t,a){return t[a]=e(r[a]),t},{})}},{key:'getState',value:function(){return this.store.getState()}},{key:'subscribeToStateChange',value:function(e,t){t||(t=this.getState.bind(this));var a=t(),r=function(){var r=t();if(r!==a){var n=a;a=r,e(r,n)}};return this.store.subscribe(r)}},{key:'subscribeToOperationStateChange',value:function(e){var t=this;return this.subscribeToStateChange(e,function(){return t.getState().operation})}},{key:'subscribeToPlayerStateChange',value:function(e){var t=this;return this.subscribeToStateChange(e,function(){return t.getState().player})}}]),e}(),ae=['error','src','srcObject','currentSrc','crossOrigin','networkState','preload','buffered','readyState','seeking','currentTime','duration','paused','defaultPlaybackRate','playbackRate','played','seekable','ended','autoplay','loop','mediaGroup','controller','controls','volume','muted','defaultMuted','audioTracks','videoTracks','textTracks','width','height','videoWidth','videoHeight','poster'],re={actions:V.object,player:V.object,children:V.any,startTime:V.number,loop:V.bool,muted:V.bool,autoPlay:V.bool,playsInline:V.bool,src:V.string,poster:V.string,className:V.string,preload:V.oneOf(['auto','metadata','none']),crossOrigin:V.string,onLoadStart:V.func,onWaiting:V.func,onCanPlay:V.func,onCanPlayThrough:V.func,onPlaying:V.func,onEnded:V.func,onSeeking:V.func,onSeeked:V.func,onPlay:V.func,onPause:V.func,onProgress:V.func,onDurationChange:V.func,onError:V.func,onSuspend:V.func,onAbort:V.func,onEmptied:V.func,onStalled:V.func,onLoadedMetadata:V.func,onLoadedData:V.func,onTimeUpdate:V.func,onRateChange:V.func,onVolumeChange:V.func,onResize:V.func},ne=function(e){function t(e){w(this,t);var a=G(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.video=null,a.play=a.play.bind(a),a.pause=a.pause.bind(a),a.seek=a.seek.bind(a),a.forward=a.forward.bind(a),a.replay=a.replay.bind(a),a.toggleFullscreen=a.toggleFullscreen.bind(a),a.getProperties=a.getProperties.bind(a),a.renderChildren=a.renderChildren.bind(a),a.handleLoadStart=a.handleLoadStart.bind(a),a.handleCanPlay=a.handleCanPlay.bind(a),a.handleCanPlayThrough=a.handleCanPlayThrough.bind(a),a.handlePlay=a.handlePlay.bind(a),a.handlePlaying=a.handlePlaying.bind(a),a.handlePause=a.handlePause.bind(a),a.handleEnded=a.handleEnded.bind(a),a.handleWaiting=a.handleWaiting.bind(a),a.handleSeeking=a.handleSeeking.bind(a),a.handleSeeked=a.handleSeeked.bind(a),a.handleFullscreenChange=a.handleFullscreenChange.bind(a),a.handleError=a.handleError.bind(a),a.handleSuspend=a.handleSuspend.bind(a),a.handleAbort=a.handleAbort.bind(a),a.handleEmptied=a.handleEmptied.bind(a),a.handleStalled=a.handleStalled.bind(a),a.handleLoadedMetaData=a.handleLoadedMetaData.bind(a),a.handleLoadedData=a.handleLoadedData.bind(a),a.handleTimeUpdate=a.handleTimeUpdate.bind(a),a.handleRateChange=a.handleRateChange.bind(a),a.handleVolumeChange=a.handleVolumeChange.bind(a),a.handleDurationChange=a.handleDurationChange.bind(a),a.handleProgress=f(a.handleProgress.bind(a),250),a.handleKeypress=a.handleKeypress.bind(a),a}return B(t,e),M(t,[{key:'componentDidMount',value:function(){this.forceUpdate(),this.video.setAttribute('webkit-playsinline',!0),this.video.setAttribute('x-webkit-airplay','allow')}},{key:'getProperties',value:function(){var e=this;return this.video?ae.reduce(function(t,a){return t[a]=e.video[a],t},{}):null}},{key:'play',value:function(){var e=this.video.play();void 0!==e&&e.catch(function(){}).then(function(){})}},{key:'pause',value:function(){var e=this.video.pause();void 0!==e&&e.catch(function(){}).then(function(){})}},{key:'load',value:function(){this.video.load()}},{key:'addTextTrack',value:function(){var e;(e=this.video).addTextTrack.apply(e,arguments)}},{key:'canPlayType',value:function(){var e;(e=this.video).canPlayType.apply(e,arguments)}},{key:'togglePlay',value:function(){this.video.paused?this.play():this.pause()}},{key:'seek',value:function(e){try{this.video.currentTime=e}catch(t){}}},{key:'forward',value:function(e){this.seek(this.video.currentTime+e)}},{key:'replay',value:function(e){this.forward(-e)}},{key:'toggleFullscreen',value:function(){var e=this.props,t=e.player,a=e.actions;a.toggleFullscreen(t)}},{key:'handleLoadStart',value:function(){var e=this.props,t=e.actions,a=e.onLoadStart;t.handleLoadStart(this.getProperties()),a&&a.apply(void 0,arguments)}},{key:'handleCanPlay',value:function(){var e=this.props,t=e.actions,a=e.onCanPlay;t.handleCanPlay(this.getProperties()),a&&a.apply(void 0,arguments)}},{key:'handleCanPlayThrough',value:function(){var e=this.props,t=e.actions,a=e.onCanPlayThrough;t.handleCanPlayThrough(this.getProperties()),a&&a.apply(void 0,arguments)}},{key:'handlePlaying',value:function(){var e=this.props,t=e.actions,a=e.onPlaying;t.handlePlaying(this.getProperties()),a&&a.apply(void 0,arguments)}},{key:'handlePlay',value:function(){var e=this.props,t=e.actions,a=e.onPlay;t.handlePlay(this.getProperties()),a&&a.apply(void 0,arguments)}},{key:'handlePause',value:function(){var e=this.props,t=e.actions,a=e.onPause;t.handlePause(this.getProperties()),a&&a.apply(void 0,arguments)}},{key:'handleDurationChange',value:function(){var e=this.props,t=e.actions,a=e.onDurationChange;t.handleDurationChange(this.getProperties()),a&&a.apply(void 0,arguments)}},{key:'handleProgress',value:function(){var e=this.props,t=e.actions,a=e.onProgress;this.video&&t.handleProgressChange(this.getProperties()),a&&a.apply(void 0,arguments)}},{key:'handleEnded',value:function(){var e=this.props,t=e.loop,a=e.player,r=e.actions,n=e.onEnded;t?(this.seek(0),this.play()):!a.paused&&this.pause(),r.handleEnd(this.getProperties()),n&&n.apply(void 0,arguments)}},{key:'handleWaiting',value:function(){var e=this.props,t=e.actions,a=e.onWaiting;t.handleWaiting(this.getProperties()),a&&a.apply(void 0,arguments)}},{key:'handleSeeking',value:function(){var e=this.props,t=e.actions,a=e.onSeeking;t.handleSeeking(this.getProperties()),a&&a.apply(void 0,arguments)}},{key:'handleSeeked',value:function(){var e=this.props,t=e.actions,a=e.onSeeked;t.handleSeeked(this.getProperties()),a&&a.apply(void 0,arguments)}},{key:'handleFullscreenChange',value:function(){}},{key:'handleSuspend',value:function(){var e=this.props,t=e.actions,a=e.onSuspend;t.handleSuspend(this.getProperties()),a&&a.apply(void 0,arguments)}},{key:'handleAbort',value:function(){var e=this.props,t=e.actions,a=e.onAbort;t.handleAbort(this.getProperties()),a&&a.apply(void 0,arguments)}},{key:'handleEmptied',value:function(){var e=this.props,t=e.actions,a=e.onEmptied;t.handleEmptied(this.getProperties()),a&&a.apply(void 0,arguments)}},{key:'handleStalled',value:function(){var e=this.props,t=e.actions,a=e.onStalled;t.handleStalled(this.getProperties()),a&&a.apply(void 0,arguments)}},{key:'handleLoadedMetaData',value:function(){var e=this.props,t=e.actions,a=e.onLoadedMetadata,r=e.startTime;r&&0<r&&(this.video.currentTime=r),t.handleLoadedMetaData(this.getProperties()),a&&a.apply(void 0,arguments)}},{key:'handleLoadedData',value:function(){var e=this.props,t=e.actions,a=e.onLoadedData;t.handleLoadedData(this.getProperties()),a&&a.apply(void 0,arguments)}},{key:'handleTimeUpdate',value:function(){var e=this.props,t=e.actions,a=e.onTimeUpdate;t.handleTimeUpdate(this.getProperties()),a&&a.apply(void 0,arguments)}},{key:'handleRateChange',value:function(){var e=this.props,t=e.actions,a=e.onRateChange;t.handleRateChange(this.getProperties()),a&&a.apply(void 0,arguments)}},{key:'handleVolumeChange',value:function(){var e=this.props,t=e.actions,a=e.onVolumeChange;t.handleVolumeChange(this.getProperties()),a&&a.apply(void 0,arguments)}},{key:'handleError',value:function(){var e=this.props,t=e.actions,a=e.onError;t.handleError(this.getProperties()),a&&a.apply(void 0,arguments)}},{key:'handleResize',value:function(){var e=this.props,t=e.actions,a=e.onResize;t.handleResize(this.getProperties()),a&&a.apply(void 0,arguments)}},{key:'handleKeypress',value:function(){}},{key:'renderChildren',value:function(){var e=this,t=U({},this.props,{video:this.video});return this.video?P.Children.toArray(this.props.children).filter(g).map(function(a){var r;if('string'!=typeof a.type)r=t;else if('source'===a.type){r=U({},a.props);var n=r.onError;r.onError=function(){n&&n.apply(void 0,arguments),e.handleError.apply(e,arguments)}}return P.cloneElement(a,r)}):null}},{key:'render',value:function(){var e=this,t=this.props,a=t.loop,r=t.poster,n=t.preload,o=t.src,i=t.autoPlay,d=t.muted,s=t.crossOrigin,l=t.videoId;return P.createElement('video',{className:'video',id:l,crossOrigin:s,ref:function(t){e.video=t},muted:d,preload:n,loop:a,playsInline:!0,autoPlay:i,poster:r,src:o,onLoadStart:this.handleLoadStart,onWaiting:this.handleWaiting,onCanPlay:this.handleCanPlay,onCanPlayThrough:this.handleCanPlayThrough,onPlaying:this.handlePlaying,onEnded:this.handleEnded,onSeeking:this.handleSeeking,onSeeked:this.handleSeeked,onPlay:this.handlePlay,onPause:this.handlePause,onProgress:this.handleProgress,onDurationChange:this.handleDurationChange,onError:this.handleError,onSuspend:this.handleSuspend,onAbort:this.handleAbort,onEmptied:this.handleEmptied,onStalled:this.handleStalled,onLoadedMetadata:this.handleLoadedMetaData,onLoadedData:this.handleLoadedData,onTimeUpdate:this.handleTimeUpdate,onRateChange:this.handleRateChange,onVolumeChange:this.handleVolumeChange,tabIndex:0},this.renderChildren())}},{key:'playbackRate',get:function(){return this.video.playbackRate},set:function(e){this.video.playbackRate=e}},{key:'muted',get:function(){return this.video.muted},set:function(e){this.video.muted=e}},{key:'volume',get:function(){return this.video.volume},set:function(e){1<e&&(e=1),0>e&&(e=0),this.video.volume=e}},{key:'videoWidth',get:function(){return this.video.videoWidth}},{key:'videoHeight',get:function(){return this.video.videoHeight}}]),t}(t.Component);ne.propTypes=re,ne.defaultProps={preload:'auto'},ne.displayName='Video';var oe=r(function(e){'undefined'!=typeof window&&function(t,a){e.exports=a()}(C,function(){var e=Math.abs;return function(e){function t(r){if(a[r])return a[r].exports;var n=a[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var a={};return t.m=e,t.c=a,t.d=function(e,a,r){t.o(e,a)||Object.defineProperty(e,a,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var a=e&&e.__esModule?function(){return e['default']}:function(){return e};return t.d(a,'a',a),a},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p='/dist/',t(t.s=11)}([function(e,t,a){function r(){}function n(e,t){return t='['+e+'] > '+t,t}function o(e){var t=u.console[e];return t?function(){for(var a=arguments.length,r=Array(a),o=0;o<a;o++)r[o]=arguments[o];r[0]&&(r[0]=n(e,r[0])),t.apply(u.console,r)}:r}function i(e){for(var t=arguments.length,a=Array(1<t?t-1:0),r=1;r<t;r++)a[r-1]=arguments[r];a.forEach(function(t){p[t]=e[t]?e[t].bind(e):o(t)})}a.d(t,'a',function(){return c}),a.d(t,'b',function(){return g});var d=a(4),s='function'==typeof Symbol&&'symbol'===N(Symbol.iterator)?function(e){return'undefined'==typeof e?'undefined':N(e)}:function(e){return e&&'function'==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?'symbol':'undefined'==typeof e?'undefined':N(e)},l={trace:r,debug:r,log:r,warn:r,info:r,error:r},p=l,u=Object(d.a)(),c=function(e){if(!0===e||'object'===('undefined'==typeof e?'undefined':s(e))){i(e,'debug','log','info','warn','error');try{p.log()}catch(t){p=l}}else p=l},g=p},function(e,t){t.a={MEDIA_ATTACHING:'hlsMediaAttaching',MEDIA_ATTACHED:'hlsMediaAttached',MEDIA_DETACHING:'hlsMediaDetaching',MEDIA_DETACHED:'hlsMediaDetached',BUFFER_RESET:'hlsBufferReset',BUFFER_CODECS:'hlsBufferCodecs',BUFFER_CREATED:'hlsBufferCreated',BUFFER_APPENDING:'hlsBufferAppending',BUFFER_APPENDED:'hlsBufferAppended',BUFFER_EOS:'hlsBufferEos',BUFFER_FLUSHING:'hlsBufferFlushing',BUFFER_FLUSHED:'hlsBufferFlushed',MANIFEST_LOADING:'hlsManifestLoading',MANIFEST_LOADED:'hlsManifestLoaded',MANIFEST_PARSED:'hlsManifestParsed',LEVEL_SWITCHING:'hlsLevelSwitching',LEVEL_SWITCHED:'hlsLevelSwitched',LEVEL_LOADING:'hlsLevelLoading',LEVEL_LOADED:'hlsLevelLoaded',LEVEL_UPDATED:'hlsLevelUpdated',LEVEL_PTS_UPDATED:'hlsLevelPtsUpdated',AUDIO_TRACKS_UPDATED:'hlsAudioTracksUpdated',AUDIO_TRACK_SWITCHING:'hlsAudioTrackSwitching',AUDIO_TRACK_SWITCHED:'hlsAudioTrackSwitched',AUDIO_TRACK_LOADING:'hlsAudioTrackLoading',AUDIO_TRACK_LOADED:'hlsAudioTrackLoaded',SUBTITLE_TRACKS_UPDATED:'hlsSubtitleTracksUpdated',SUBTITLE_TRACK_SWITCH:'hlsSubtitleTrackSwitch',SUBTITLE_TRACK_LOADING:'hlsSubtitleTrackLoading',SUBTITLE_TRACK_LOADED:'hlsSubtitleTrackLoaded',SUBTITLE_FRAG_PROCESSED:'hlsSubtitleFragProcessed',INIT_PTS_FOUND:'hlsInitPtsFound',FRAG_LOADING:'hlsFragLoading',FRAG_LOAD_PROGRESS:'hlsFragLoadProgress',FRAG_LOAD_EMERGENCY_ABORTED:'hlsFragLoadEmergencyAborted',FRAG_LOADED:'hlsFragLoaded',FRAG_DECRYPTED:'hlsFragDecrypted',FRAG_PARSING_INIT_SEGMENT:'hlsFragParsingInitSegment',FRAG_PARSING_USERDATA:'hlsFragParsingUserdata',FRAG_PARSING_METADATA:'hlsFragParsingMetadata',FRAG_PARSING_DATA:'hlsFragParsingData',FRAG_PARSED:'hlsFragParsed',FRAG_BUFFERED:'hlsFragBuffered',FRAG_CHANGED:'hlsFragChanged',FPS_DROP:'hlsFpsDrop',FPS_DROP_LEVEL_CAPPING:'hlsFpsDropLevelCapping',ERROR:'hlsError',DESTROYING:'hlsDestroying',KEY_LOADING:'hlsKeyLoading',KEY_LOADED:'hlsKeyLoaded',STREAM_STATE_TRANSITION:'hlsStreamStateTransition'}},function(e,t,a){a.d(t,'b',function(){return r}),a.d(t,'a',function(){return n});var r={NETWORK_ERROR:'networkError',MEDIA_ERROR:'mediaError',KEY_SYSTEM_ERROR:'keySystemError',MUX_ERROR:'muxError',OTHER_ERROR:'otherError'},n={KEY_SYSTEM_NO_KEYS:'keySystemNoKeys',KEY_SYSTEM_NO_ACCESS:'keySystemNoAccess',KEY_SYSTEM_NO_SESSION:'keySystemNoSession',KEY_SYSTEM_LICENSE_REQUEST_FAILED:'keySystemLicenseRequestFailed',MANIFEST_LOAD_ERROR:'manifestLoadError',MANIFEST_LOAD_TIMEOUT:'manifestLoadTimeOut',MANIFEST_PARSING_ERROR:'manifestParsingError',MANIFEST_INCOMPATIBLE_CODECS_ERROR:'manifestIncompatibleCodecsError',LEVEL_LOAD_ERROR:'levelLoadError',LEVEL_LOAD_TIMEOUT:'levelLoadTimeOut',LEVEL_SWITCH_ERROR:'levelSwitchError',AUDIO_TRACK_LOAD_ERROR:'audioTrackLoadError',AUDIO_TRACK_LOAD_TIMEOUT:'audioTrackLoadTimeOut',FRAG_LOAD_ERROR:'fragLoadError',FRAG_LOAD_TIMEOUT:'fragLoadTimeOut',FRAG_DECRYPT_ERROR:'fragDecryptError',FRAG_PARSING_ERROR:'fragParsingError',REMUX_ALLOC_ERROR:'remuxAllocError',KEY_LOAD_ERROR:'keyLoadError',KEY_LOAD_TIMEOUT:'keyLoadTimeOut',BUFFER_ADD_CODEC_ERROR:'bufferAddCodecError',BUFFER_APPEND_ERROR:'bufferAppendError',BUFFER_APPENDING_ERROR:'bufferAppendingError',BUFFER_STALLED_ERROR:'bufferStalledError',BUFFER_FULL_ERROR:'bufferFullError',BUFFER_SEEK_OVER_HOLE:'bufferSeekOverHole',BUFFER_NUDGE_ON_STALL:'bufferNudgeOnStall',INTERNAL_EXCEPTION:'internalException'}},function(e,t,a){a.d(t,'a',function(){return r});var r=Number.isFinite||function(e){return'number'==typeof e&&isFinite(e)}},function(e,t){t.a=function(){return'undefined'==typeof window?self:window}},function(e){(function(){var t=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/\;?#]*)?(.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,a=/^([^\/;?#]*)(.*)$/,r=/(?:\/|^)\.(?=\/)/g,n=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,o={buildAbsoluteURL:function(e,t,r){if(r=r||{},e=e.trim(),t=t.trim(),!t){if(!r.alwaysNormalize)return e;var n=this.parseURL(e);if(!d)throw new Error('Error trying to parse base URL.');return n.path=o.normalizePath(n.path),o.buildURLFromParts(n)}var i=this.parseURL(t);if(!i)throw new Error('Error trying to parse relative URL.');if(i.scheme)return r.alwaysNormalize?(i.path=o.normalizePath(i.path),o.buildURLFromParts(i)):t;var d=this.parseURL(e);if(!d)throw new Error('Error trying to parse base URL.');if(!d.netLoc&&d.path&&'/'!==d.path[0]){var s=a.exec(d.path);d.netLoc=s[1],d.path=s[2]}d.netLoc&&!d.path&&(d.path='/');var l={scheme:d.scheme,netLoc:i.netLoc,path:null,params:i.params,query:i.query,fragment:i.fragment};if(!i.netLoc&&(l.netLoc=d.netLoc,'/'!==i.path[0]))if(!i.path)l.path=d.path,i.params||(l.params=d.params,!i.query&&(l.query=d.query));else{var p=d.path,u=p.substring(0,p.lastIndexOf('/')+1)+i.path;l.path=o.normalizePath(u)}return null===l.path&&(l.path=r.alwaysNormalize?o.normalizePath(i.path):i.path),o.buildURLFromParts(l)},parseURL:function(e){var a=t.exec(e);return a?{scheme:a[1]||'',netLoc:a[2]||'',path:a[3]||'',params:a[4]||'',query:a[5]||'',fragment:a[6]||''}:null},normalizePath:function(e){for(e=e.split('').reverse().join('').replace(r,'');e.length!==(e=e.replace(n,'')).length;);return e.split('').reverse().join('')},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};e.exports=o})(this)},function(e,t,a){function r(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}a.d(t,'b',function(){return o});var n=function(){function e(){r(this,e)}return e.isHeader=function(e,t){return!!(t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&255>e[t+3]&&255>e[t+4]&&128>e[t+6]&&128>e[t+7]&&128>e[t+8]&&128>e[t+9])},e.isFooter=function(e,t){return!!(t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&255>e[t+3]&&255>e[t+4]&&128>e[t+6]&&128>e[t+7]&&128>e[t+8]&&128>e[t+9])},e.getID3Data=function(t,a){for(var r=a,n=0;e.isHeader(t,a);){n+=10;var o=e._readSize(t,a+6);n+=o,e.isFooter(t,a+10)&&(n+=10),a+=n}return 0<n?t.subarray(r,r+n):void 0},e._readSize=function(e,t){var a=0;return a=(127&e[t])<<21,a|=(127&e[t+1])<<14,a|=(127&e[t+2])<<7,a|=127&e[t+3],a},e.getTimeStamp=function(t){for(var a=e.getID3Frames(t),r=0,n;r<a.length;r++)if(n=a[r],e.isTimeStampFrame(n))return e._readTimeStamp(n)},e.isTimeStampFrame=function(e){return e&&'PRIV'===e.key&&'com.apple.streaming.transportStreamTimestamp'===e.info},e._getFrameData=function(t){var a=D(t[0],t[1],t[2],t[3]),r=e._readSize(t,4);return{type:a,size:r,data:t.subarray(10,10+r)}},e.getID3Frames=function(t){for(var a=0,r=[],n;e.isHeader(t,a);){n=e._readSize(t,a+6),a+=10;for(var o=a+n;a+8<o;){var i=e._getFrameData(t.subarray(a)),d=e._decodeFrame(i);d&&r.push(d),a+=i.size+10}e.isFooter(t,a)&&(a+=10)}return r},e._decodeFrame=function(t){return'PRIV'===t.type?e._decodePrivFrame(t):'T'===t.type[0]?e._decodeTextFrame(t):'W'===t.type[0]?e._decodeURLFrame(t):void 0},e._readTimeStamp=function(e){if(8===e.data.byteLength){var t=new Uint8Array(e.data),a=1&t[3],r=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return r/=45,a&&(r+=47721858.84),k(r)}},e._decodePrivFrame=function(t){if(!(2>t.size)){var a=e._utf8ArrayToStr(t.data,!0),r=new Uint8Array(t.data.subarray(a.length+1));return{key:t.type,info:a,data:r.buffer}}},e._decodeTextFrame=function(t){if(!(2>t.size)){if('TXXX'===t.type){var a=1,r=e._utf8ArrayToStr(t.data.subarray(a));a+=r.length+1;var n=e._utf8ArrayToStr(t.data.subarray(a));return{key:t.type,info:r,data:n}}var o=e._utf8ArrayToStr(t.data.subarray(1));return{key:t.type,data:o}}},e._decodeURLFrame=function(t){if('WXXX'===t.type){if(2>t.size)return;var a=1,r=e._utf8ArrayToStr(t.data.subarray(a));a+=r.length+1;var n=e._utf8ArrayToStr(t.data.subarray(a));return{key:t.type,info:r,data:n}}var o=e._utf8ArrayToStr(t.data);return{key:t.type,data:o}},e._utf8ArrayToStr=function(e){for(var t=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],a=e.length,r=void 0,n=void 0,o=void 0,d='',s=0;s<a;){if(r=e[s++],0===r&&t)return d;if(0!==r&&3!==r)switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:d+=D(r);break;case 12:case 13:n=e[s++],d+=D((31&r)<<6|63&n);break;case 14:n=e[s++],o=e[s++],d+=D((15&r)<<12|(63&n)<<6|(63&o)<<0);break;default:}}return d},e}(),o=n._utf8ArrayToStr;t.a=n},function(e){function t(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function a(e){return'function'==typeof e}function r(e){return'number'==typeof e}function n(e){return'object'===('undefined'==typeof e?'undefined':N(e))&&null!==e}function o(e){return void 0===e}e.exports=t,t.EventEmitter=t,t.prototype._events=void 0,t.prototype._maxListeners=void 0,t.defaultMaxListeners=10,t.prototype.setMaxListeners=function(e){if(!r(e)||0>e||isNaN(e))throw TypeError('n must be a positive number');return this._maxListeners=e,this},t.prototype.emit=function(e){var t,r,d,s,l,p;if(this._events||(this._events={}),'error'===e&&(!this._events.error||n(this._events.error)&&!this._events.error.length))if(t=arguments[1],t instanceof Error)throw t;else{var u=new Error('Uncaught, unspecified "error" event. ('+t+')');throw u.context=t,u}if(r=this._events[e],o(r))return!1;if(a(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),r.apply(this,s);}else if(n(r))for(s=Array.prototype.slice.call(arguments,1),p=r.slice(),d=p.length,l=0;l<d;l++)p[l].apply(this,s);return!0},t.prototype.addListener=function(e,r){var i;if(!a(r))throw TypeError('listener must be a function');return this._events||(this._events={}),this._events.newListener&&this.emit('newListener',e,a(r.listener)?r.listener:r),this._events[e]?n(this._events[e])?this._events[e].push(r):this._events[e]=[this._events[e],r]:this._events[e]=r,n(this._events[e])&&!this._events[e].warned&&(i=o(this._maxListeners)?t.defaultMaxListeners:this._maxListeners,i&&0<i&&this._events[e].length>i&&(this._events[e].warned=!0,console.error('(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.',this._events[e].length),'function'==typeof console.trace&&console.trace())),this},t.prototype.on=t.prototype.addListener,t.prototype.once=function(e,t){function r(){this.removeListener(e,r),n||(n=!0,t.apply(this,arguments))}if(!a(t))throw TypeError('listener must be a function');var n=!1;return r.listener=t,this.on(e,r),this},t.prototype.removeListener=function(e,t){var r,o,d,s;if(!a(t))throw TypeError('listener must be a function');if(!this._events||!this._events[e])return this;if(r=this._events[e],d=r.length,o=-1,r===t||a(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit('removeListener',e,t);else if(n(r)){for(s=d;0<s--;)if(r[s]===t||r[s].listener&&r[s].listener===t){o=s;break}if(0>o)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(o,1),this._events.removeListener&&this.emit('removeListener',e,t)}return this},t.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)'removeListener'!==t&&this.removeAllListeners(t);return this.removeAllListeners('removeListener'),this._events={},this}if(r=this._events[e],a(r))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},t.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?a(this._events[e])?[this._events[e]]:this._events[e].slice():[],t},t.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(a(t))return 1;if(t)return t.length}return 0},t.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,a){function r(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function n(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function o(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function d(e){var t=e.byteLength,a=t&&new DataView(e).getUint8(t-1);return a?e.slice(0,t-a):e}function i(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}var s=function(){function e(t,a){r(this,e),this.subtle=t,this.aesIV=a}return e.prototype.decrypt=function(e,t){return this.subtle.decrypt({name:'AES-CBC',iv:this.aesIV},t,e)},e}(),l=function(){function e(t,a){n(this,e),this.subtle=t,this.key=a}return e.prototype.expandKey=function(){return this.subtle.importKey('raw',this.key,{name:'AES-CBC'},!1,['encrypt','decrypt'])},e}(),p=function(){function e(){o(this,e),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return e.prototype.uint8ArrayToUint32Array_=function(e){for(var t=new DataView(e),a=new Uint32Array(4),r=0;4>r;r++)a[r]=t.getUint32(4*r);return a},e.prototype.initTable=function(){var e=this.sBox,a=this.invSBox,r=this.subMix,n=r[0],o=r[1],s=r[2],l=r[3],p=this.invSubMix,u=p[0],c=p[1],g=p[2],f=p[3],y=new Uint32Array(256),d=0,m=0,h=0;for(h=0;256>h;h++)y[h]=128>h?h<<1:283^h<<1;for(h=0;256>h;h++){var v=m^m<<1^m<<2^m<<3^m<<4;v=99^(v>>>8^255&v),e[d]=v,a[v]=d;var E=y[d],b=y[E],T=y[b],S=257*y[v]^16843008*v;n[d]=S<<24|S>>>8,o[d]=S<<16|S>>>16,s[d]=S<<8|S>>>24,l[d]=S,S=16843009*T^65537*b^257*E^16843008*d,u[v]=S<<24|S>>>8,c[v]=S<<16|S>>>16,g[v]=S<<8|S>>>24,f[v]=S,d?(d=E^y[y[y[T^E]]],m^=y[y[m]]):d=m=1}},e.prototype.expandKey=function(e){for(var a=this.uint8ArrayToUint32Array_(e),r=!0,n=0;n<a.length&&r;)r=a[n]===this.key[n],n++;if(!r){this.key=a;var o=this.keySize=a.length;if(4!==o&&6!==o&&8!==o)throw new Error('Invalid aes key size='+o);var i=this.ksRows=4*(o+6+1),d=void 0,s=void 0,l=this.keySchedule=new Uint32Array(i),p=this.invKeySchedule=new Uint32Array(i),u=this.sBox,c=this.rcon,g=this.invSubMix,f=g[0],y=g[1],m=g[2],h=g[3],v=void 0,E=void 0;for(d=0;d<i;d++){if(d<o){v=l[d]=a[d];continue}E=v,0==d%o?(E=E<<8|E>>>24,E=u[E>>>24]<<24|u[255&E>>>16]<<16|u[255&E>>>8]<<8|u[255&E],E^=c[0|d/o]<<24):6<o&&4==d%o&&(E=u[E>>>24]<<24|u[255&E>>>16]<<16|u[255&E>>>8]<<8|u[255&E]),l[d]=v=(l[d-o]^E)>>>0}for(s=0;s<i;s++)d=i-s,E=3&s?l[d]:l[d-4],p[s]=4>s||4>=d?E:f[u[E>>>24]]^y[u[255&E>>>16]]^m[u[255&E>>>8]]^h[u[255&E]],p[s]>>>=0}},e.prototype.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},e.prototype.decrypt=function(e,t,a,r){for(var n=this.keySize+6,o=this.invKeySchedule,s=this.invSBox,l=this.invSubMix,p=l[0],u=l[1],c=l[2],g=l[3],f=this.uint8ArrayToUint32Array_(a),y=f[0],m=f[1],h=f[2],v=f[3],E=new Int32Array(e),b=new Int32Array(E.length),T=void 0,S=void 0,_=void 0,R=void 0,A=void 0,k=void 0,L=void 0,D=void 0,P=void 0,C=void 0,I=void 0,O=void 0,F=void 0,x=void 0,N=this.networkToHostOrderSwap;t<E.length;){for(P=N(E[t]),C=N(E[t+1]),I=N(E[t+2]),O=N(E[t+3]),A=P^o[0],k=O^o[1],L=I^o[2],D=C^o[3],F=4,x=1;x<n;x++)T=p[A>>>24]^u[255&k>>16]^c[255&L>>8]^g[255&D]^o[F],S=p[k>>>24]^u[255&L>>16]^c[255&D>>8]^g[255&A]^o[F+1],_=p[L>>>24]^u[255&D>>16]^c[255&A>>8]^g[255&k]^o[F+2],R=p[D>>>24]^u[255&A>>16]^c[255&k>>8]^g[255&L]^o[F+3],A=T,k=S,L=_,D=R,F+=4;T=s[A>>>24]<<24^s[255&k>>16]<<16^s[255&L>>8]<<8^s[255&D]^o[F],S=s[k>>>24]<<24^s[255&L>>16]<<16^s[255&D>>8]<<8^s[255&A]^o[F+1],_=s[L>>>24]<<24^s[255&D>>16]<<16^s[255&A>>8]<<8^s[255&k]^o[F+2],R=s[D>>>24]<<24^s[255&A>>16]<<16^s[255&k>>8]<<8^s[255&L]^o[F+3],F+=3,b[t]=N(T^y),b[t+1]=N(R^m),b[t+2]=N(_^h),b[t+3]=N(S^v),y=P,m=C,h=I,v=O,t+=4}return r?d(b.buffer):b.buffer},e.prototype.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},e}(),u=a(2),c=a(0),g=a(1),f=a(4),y=Object(f.a)(),m=function(){function e(t,a){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},n=r.removePKCS7Padding,o=void 0===n||n;if(i(this,e),this.logEnabled=!0,this.observer=t,this.config=a,this.removePKCS7Padding=o,o)try{var d=y.crypto;d&&(this.subtle=d.subtle||d.webkitSubtle)}catch(t){}this.disableWebCrypto=!this.subtle}return e.prototype.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},e.prototype.decrypt=function(e,t,a,r){var n=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(c.b.log('JS AES decrypt'),this.logEnabled=!1);var o=this.decryptor;o||(this.decryptor=o=new p),o.expandKey(t),r(o.decrypt(e,0,a,this.removePKCS7Padding))}else{this.logEnabled&&(c.b.log('WebCrypto AES decrypt'),this.logEnabled=!1);var i=this.subtle;this.key!==t&&(this.key=t,this.fastAesKey=new l(i,t)),this.fastAesKey.expandKey().then(function(o){var d=new s(i,a);d.decrypt(e,o).catch(function(o){n.onWebCryptoError(o,e,t,a,r)}).then(function(e){r(e)})}).catch(function(o){n.onWebCryptoError(o,e,t,a,r)})}},e.prototype.onWebCryptoError=function(e,t,a,r,n){this.config.enableSoftwareAES?(c.b.log('WebCrypto Error, disable WebCrypto API'),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(t,a,r,n)):(c.b.error('decrypting error : '+e.message),this.observer.trigger(g.a.ERROR,{type:u.b.MEDIA_ERROR,details:u.a.FRAG_DECRYPT_ERROR,fatal:!0,reason:e.message}))},e.prototype.destroy=function(){var e=this.decryptor;e&&(e.destroy(),this.decryptor=void 0)},e}(),h=t.a=m},function(e,t,a){function r(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}var n=a(0),o=a(1),i=function(){function e(t,a){r(this,e),this.observer=t,this.remuxer=a}return e.prototype.resetTimeStamp=function(e){this.initPTS=e},e.prototype.resetInitSegment=function(t,a,r,n){if(t&&t.byteLength){var i=this.initData=e.parseInitSegment(t);null==a&&(a='mp4a.40.5'),null==r&&(r='avc1.42e01e');var d={};i.audio&&i.video?d.audiovideo={container:'video/mp4',codec:a+','+r,initSegment:n?t:null}:(i.audio&&(d.audio={container:'audio/mp4',codec:a,initSegment:n?t:null}),i.video&&(d.video={container:'video/mp4',codec:r,initSegment:n?t:null})),this.observer.trigger(o.a.FRAG_PARSING_INIT_SEGMENT,{tracks:d})}else a&&(this.audioCodec=a),r&&(this.videoCodec=r)},e.probe=function(t){return 0<e.findBox({data:t,start:0,end:A(t.length,16384)},['moof']).length},e.bin2str=function(e){return D.apply(null,e)},e.readUint16=function(e,t){e.data&&(t+=e.start,e=e.data);var a=e[t]<<8|e[t+1];return 0>a?65536+a:a},e.readUint32=function(e,t){e.data&&(t+=e.start,e=e.data);var a=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3];return 0>a?4294967296+a:a},e.writeUint32=function(e,t,a){e.data&&(t+=e.start,e=e.data),e[t]=a>>24,e[t+1]=255&a>>16,e[t+2]=255&a>>8,e[t+3]=255&a},e.findBox=function(t,a){var r=[],n,o,d,s,l,p,u;if(t.data?(p=t.start,s=t.end,t=t.data):(p=0,s=t.byteLength),!a.length)return null;for(n=p;n<s;)o=e.readUint32(t,n),d=e.bin2str(t.subarray(n+4,n+8)),u=1<o?n+o:s,d===a[0]&&(1===a.length?r.push({data:t,start:n+8,end:u}):(l=e.findBox({data:t,start:n+8,end:u},a.slice(1)),l.length&&(r=r.concat(l)))),n=u;return r},e.parseSegmentIndex=function(t){var a=e.findBox(t,['moov'])[0],r=a?a.end:null,n=0,o=e.findBox(t,['sidx']),d=void 0;if(!o||!o[0])return null;d=[],o=o[0];var s=o.data[0];n=0===s?8:16;var l=e.readUint32(o,n);n+=4;n+=0===s?8:16,n+=2;var p=o.end+0,u=e.readUint16(o,n);n+=2;for(var c=0;c<u;c++){var g=n,f=e.readUint32(o,g);g+=4;var y=2147483647&f;if(1==(2147483648&f)>>>31)return void console.warn('SIDX has hierarchical references (not supported)');var m=e.readUint32(o,g);g+=4,d.push({referenceSize:y,subsegmentDuration:m,info:{duration:m/l,start:p,end:p+y-1}}),p+=y,g+=4,n=g}return{earliestPresentationTime:0,timescale:l,version:s,referencesCount:u,references:d,moovEndOffset:r}},e.parseInitSegment=function(t){var a=[],r=e.findBox(t,['moov','trak']);return r.forEach(function(t){var r=e.findBox(t,['tkhd'])[0];if(r){var o=r.data[r.start],i=0===o?12:20,d=e.readUint32(r,i),s=e.findBox(t,['mdia','mdhd'])[0];if(s){o=s.data[s.start],i=0===o?12:20;var l=e.readUint32(s,i),p=e.findBox(t,['mdia','hdlr'])[0];if(p){var u=e.bin2str(p.data.subarray(p.start+8,p.start+12)),c={soun:'audio',vide:'video'}[u];if(c){var g=e.findBox(t,['mdia','minf','stbl','stsd']);if(g.length){g=g[0];var f=e.bin2str(g.data.subarray(g.start+12,g.start+16));n.b.log('MP4Demuxer:'+c+':'+f+' found')}a[d]={timescale:l,type:c},a[c]={timescale:l,id:d}}}}}}),a},e.getStartDTS=function(t,a){var r,n,o;return r=e.findBox(a,['moof','traf']),n=[].concat.apply([],r.map(function(a){return e.findBox(a,['tfhd']).map(function(r){var n,o,i;return n=e.readUint32(r,4),o=t[n].timescale||9e4,i=e.findBox(a,['tfdt']).map(function(t){var a,r;return a=t.data[t.start],r=e.readUint32(t,4),1===a&&(r*=4294967296,r+=e.readUint32(t,8)),r})[0],i/o})})),o=A.apply(null,n),isFinite(o)?o:0},e.offsetStartDTS=function(t,a,r){e.findBox(a,['moof','traf']).map(function(a){return e.findBox(a,['tfhd']).map(function(n){var o=e.readUint32(n,4),i=t[o].timescale||9e4;e.findBox(a,['tfdt']).map(function(t){var a=t.data[t.start],n=e.readUint32(t,4);if(0===a)e.writeUint32(t,4,n-r*i);else{n*=4294967296,n+=e.readUint32(t,8),n-=r*i,n=R(n,0);var o=L(n/4294967296),d=L(n%4294967296);e.writeUint32(t,4,o),e.writeUint32(t,8,d)}})})})},e.prototype.append=function(t,a,r,n){var i=this.initData;i||(this.resetInitSegment(t,this.audioCodec,this.videoCodec,!1),i=this.initData);var d=this.initPTS,s;if(void 0===d){var l=e.getStartDTS(i,t);this.initPTS=d=l-a,this.observer.trigger(o.a.INIT_PTS_FOUND,{initPTS:d})}e.offsetStartDTS(i,t,d),s=e.getStartDTS(i,t),this.remuxer.remux(i.audio,i.video,null,null,s,r,n,t)},e.prototype.destroy=function(){},e}();t.a=i},function(t,a,r){function n(e,t,a,r){var n=navigator.userAgent.toLowerCase(),o=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],i,d,s,l,p;return(i=((192&t[a+2])>>>6)+1,d=(60&t[a+2])>>>2,d>o.length-1)?void e.trigger(P.a.ERROR,{type:C.b.MEDIA_ERROR,details:C.a.FRAG_PARSING_ERROR,fatal:!0,reason:'invalid ADTS sampling index:'+d}):(l=(1&t[a+2])<<2,l|=(192&t[a+3])>>>6,F.b.log('manifest codec:'+r+',ADTS data:type:'+i+',sampleingIndex:'+d+'['+o[d]+'Hz],channelConfig:'+l),/firefox/i.test(n)?6<=d?(i=5,p=[,,,,],s=d-3):(i=2,p=[,,],s=d):-1===n.indexOf('android')?(i=5,p=[,,,,],r&&(-1!==r.indexOf('mp4a.40.29')||-1!==r.indexOf('mp4a.40.5'))||!r&&6<=d?s=d-3:((r&&-1!==r.indexOf('mp4a.40.2')&&(6<=d&&1===l||/vivaldi/i.test(n))||!r&&1===l)&&(i=2,p=[,,]),s=d)):(i=2,p=[,,],s=d),p[0]=i<<3,p[0]|=(14&d)>>1,p[1]|=(1&d)<<7,p[1]|=l<<3,5===i&&(p[1]|=(14&s)>>1,p[2]=(1&s)<<7,p[2]|=8,p[3]=0),{config:p,samplerate:o[d],channelCount:l,codec:'mp4a.40.'+i,manifestCodec:r})}function o(e,t){return 255===e[t]&&240==(246&e[t+1])}function i(e,t){return 1&e[t+1]?7:9}function d(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function s(e,t){return!!(t+1<e.length&&o(e,t))}function l(e,t){if(t+1<e.length&&o(e,t)){var a=i(e,t),r=a;t+5<e.length&&(r=d(e,t));var n=t+r;if(n===e.length||n+1<e.length&&o(e,n))return!0}return!1}function p(e,t,a,r,o){if(!e.samplerate){var i=n(t,a,r,o);e.config=i.config,e.samplerate=i.samplerate,e.channelCount=i.channelCount,e.codec=i.codec,e.manifestCodec=i.manifestCodec,F.b.log('parsed codec:'+e.codec+',rate:'+i.samplerate+',nb channel:'+i.channelCount)}}function u(e){return 92160000/e}function c(e,t,a,r,n){var o=void 0,s=void 0,l=void 0,p=e.length;return o=i(e,t),s=d(e,t),s-=o,0<s&&t+o+s<=p?(l=a+r*n,{headerLength:o,frameLength:s,stamp:l}):void 0}function g(e,t,a,r,n){var o=u(e.samplerate),i=c(t,a,r,n,o);if(i){var d=i.stamp,s=i.headerLength,l=i.frameLength,p={unit:t.subarray(a+s,a+s+l),pts:d,dts:d};return e.samples.push(p),e.len+=l,{sample:p,length:l+s}}}function f(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function y(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function m(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function h(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function v(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function E(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function b(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function T(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function S(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function _(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}var D=Math.ceil,P=r(1),C=r(2),I=r(8),O=r(3),F=r(0),x=r(4),N=r(6),w=function(){function e(t,a,r){f(this,e),this.observer=t,this.config=r,this.remuxer=a}return e.prototype.resetInitSegment=function(e,t,a,r){this._audioTrack={container:'audio/adts',type:'audio',id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:t,duration:r,inputTimeScale:9e4}},e.prototype.resetTimeStamp=function(){},e.probe=function(e){if(!e)return!1;for(var t=N.a.getID3Data(e,0)||[],a=t.length,r=e.length;a<r;a++)if(l(e,a))return F.b.log('ADTS sync word found !'),!0;return!1},e.prototype.append=function(e,t,a,r){for(var n=this._audioTrack,o=N.a.getID3Data(e,0)||[],i=N.a.getTimeStamp(o),d=Object(O.a)(i)?90*i:9e4*t,l=0,u=d,c=e.length,f=o.length,y=[{pts:u,dts:u,data:o}];f<c-1;)if(s(e,f)&&f+5<c){p(n,this.observer,e,f,n.manifestCodec);var m=g(n,e,f,d,l);if(m)f+=m.length,u=m.sample.pts,l++;else{F.b.log('Unable to parse AAC frame');break}}else N.a.isHeader(e,f)?(o=N.a.getID3Data(e,f),y.push({pts:u,dts:u,data:o}),f+=o.length):f++;this.remuxer.remux(n,{samples:[]},{samples:y,inputTimeScale:9e4},{samples:[]},t,a,r)},e.prototype.destroy=function(){},e}(),M=r(9),U={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(e,t,a,r,n){if(!(a+24>t.length)){var o=this.parseHeader(t,a);if(o&&a+o.frameLength<=t.length){var i=9e4*o.samplesPerFrame/o.sampleRate,d=r+n*i,s={unit:t.subarray(a,a+o.frameLength),pts:d,dts:d};return e.config=[],e.channelCount=o.channelCount,e.samplerate=o.sampleRate,e.samples.push(s),e.len+=o.frameLength,{sample:s,length:o.frameLength}}}},parseHeader:function(e,t){var a=3&e[t+1]>>3,r=3&e[t+1]>>1,n=15&e[t+2]>>4,o=3&e[t+2]>>2,i=1&e[t+2]>>1;if(1!=a&&0!=n&&15!=n&&3!=o){var d=3==a?3-r:3==r?3:4,s=1e3*U.BitratesMap[14*d+n-1],l=3==a?0:2==a?1:2,p=U.SamplingRateMap[3*l+o],u=3==e[t+3]>>6?1:2,c=U.SamplesCoefficients[a][r],g=U.BytesInSlot[r],f=parseInt(c*s/p+i,10)*g;return{sampleRate:p,channelCount:u,frameLength:f,samplesPerFrame:8*c*g}}},isHeaderPattern:function(e,t){return 255===e[t]&&224==(224&e[t+1])&&0!=(6&e[t+1])},isHeader:function(e,t){return!!(t+1<e.length&&this.isHeaderPattern(e,t))},probe:function(e,t){if(t+1<e.length&&this.isHeaderPattern(e,t)){var a=this.parseHeader(e,t),r=4;a&&a.frameLength&&(r=a.frameLength);var n=t+r;if(n===e.length||n+1<e.length&&this.isHeaderPattern(e,n))return!0}return!1}},B=U,G=function(){function e(t){y(this,e),this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}return e.prototype.loadWord=function(){var e=this.data,t=this.bytesAvailable,a=e.byteLength-t,r=new Uint8Array(4),n=A(4,t);if(0===n)throw new Error('no bytes available');r.set(e.subarray(a,a+n)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=8*n,this.bytesAvailable-=n},e.prototype.skipBits=function(e){var t;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)},e.prototype.readBits=function(e){var t=A(this.bitsAvailable,e),a=this.word>>>32-t;return 32<e&&F.b.error('Cannot read more than 32 bits at a time'),this.bitsAvailable-=t,0<this.bitsAvailable?this.word<<=t:0<this.bytesAvailable&&this.loadWord(),t=e-t,0<t&&this.bitsAvailable?a<<t|this.readBits(t):a},e.prototype.skipLZ=function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},e.prototype.skipUEG=function(){this.skipBits(1+this.skipLZ())},e.prototype.skipEG=function(){this.skipBits(1+this.skipLZ())},e.prototype.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},e.prototype.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},e.prototype.readBoolean=function(){return 1===this.readBits(1)},e.prototype.readUByte=function(){return this.readBits(8)},e.prototype.readUShort=function(){return this.readBits(16)},e.prototype.readUInt=function(){return this.readBits(32)},e.prototype.skipScalingList=function(e){var t=8,a=8,r,n;for(r=0;r<e;r++)0!=a&&(n=this.readEG(),a=(t+n+256)%256),t=0==a?t:a},e.prototype.readSPS=function(){var e=0,t=0,a=0,r=0,n=this.readUByte.bind(this),o=this.readBits.bind(this),d=this.readUEG.bind(this),s=this.readBoolean.bind(this),l=this.skipBits.bind(this),p=this.skipEG.bind(this),u=this.skipUEG.bind(this),c=this.skipScalingList.bind(this),g,f,y,m,h,v,E,b,T;if(n(),g=n(),f=o(5),l(3),y=n(),u(),100===g||110===g||122===g||244===g||44===g||83===g||86===g||118===g||128===g){var S=d();if(3===S&&l(1),u(),u(),l(1),s())for(b=3===S?12:8,T=0;T<b;T++)s()&&(6>T?c(16):c(64))}u();var _=d();if(0===_)d();else if(1===_)for(l(1),p(),p(),m=d(),T=0;T<m;T++)p();u(),l(1),h=d(),v=d(),E=o(1),0===E&&l(1),l(1),s()&&(e=d(),t=d(),a=d(),r=d());var R=[1,1];if(s()&&s()){var A=n();switch(A){case 1:R=[1,1];break;case 2:R=[12,11];break;case 3:R=[10,11];break;case 4:R=[16,11];break;case 5:R=[40,33];break;case 6:R=[24,11];break;case 7:R=[20,11];break;case 8:R=[32,11];break;case 9:R=[80,33];break;case 10:R=[18,11];break;case 11:R=[15,11];break;case 12:R=[64,33];break;case 13:R=[160,99];break;case 14:R=[4,3];break;case 15:R=[3,2];break;case 16:R=[2,1];break;case 255:{R=[n()<<8|n(),n()<<8|n()];break}}}return{width:D(16*(h+1)-2*e-2*t),height:16*((2-E)*(v+1))-(E?2:4)*(a+r),pixelRatio:R}},e.prototype.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},e}(),K=G,H=function(){function e(t,a,r,n){m(this,e),this.decryptdata=r,this.discardEPB=n,this.decrypter=new I.a(t,a,{removePKCS7Padding:!1})}return e.prototype.decryptBuffer=function(e,t){this.decrypter.decrypt(e,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,t)},e.prototype.decryptAacSample=function(e,t,a,r){var n=e[t].unit,o=n.subarray(16,n.length-n.length%16),i=o.buffer.slice(o.byteOffset,o.byteOffset+o.length),d=this;this.decryptBuffer(i,function(o){o=new Uint8Array(o),n.set(o,16),r||d.decryptAacSamples(e,t+1,a)})},e.prototype.decryptAacSamples=function(e,t,a){for(;;t++){if(t>=e.length)return void a();if(!(32>e[t].unit.length)){var r=this.decrypter.isSync();if(this.decryptAacSample(e,t,a,r),!r)return}}},e.prototype.getAvcEncryptedData=function(e){for(var t=16*L((e.length-48)/160)+16,a=new Int8Array(t),r=0,n=32;n<=e.length-16;n+=160,r+=16)a.set(e.subarray(n,n+16),r);return a},e.prototype.getAvcDecryptedUnit=function(e,t){t=new Uint8Array(t);for(var a=0,r=32;r<=e.length-16;r+=160,a+=16)e.set(t.subarray(a,a+16),r);return e},e.prototype.decryptAvcSample=function(e,t,a,r,n,o){var i=this.discardEPB(n.data),d=this.getAvcEncryptedData(i),s=this;this.decryptBuffer(d.buffer,function(d){n.data=s.getAvcDecryptedUnit(i,d),o||s.decryptAvcSamples(e,t,a+1,r)})},e.prototype.decryptAvcSamples=function(e,t,a,r){for(;;t++,a=0){if(t>=e.length)return void r();for(var n=e[t].units;;a++){if(a>=n.length)break;var o=n[a];if(!(48>=o.length||1!==o.type&&5!==o.type)){var i=this.decrypter.isSync();if(this.decryptAvcSample(e,t,a,r,o,i),!i)return}}}},e}(),V={video:1,audio:2,id3:3,text:4},W=function(){function t(e,a,r,n){h(this,t),this.observer=e,this.config=r,this.typeSupported=n,this.remuxer=a,this.sampleAes=null}return t.prototype.setDecryptData=function(e){this.sampleAes=null!=e&&null!=e.key&&'SAMPLE-AES'===e.method?new H(this.observer,this.config,e,this.discardEPB):null},t.probe=function(e){var a=t._syncOffset(e);return!(0>a)&&(a&&F.b.warn('MPEG2-TS detected but first sync word found @ offset '+a+', junk ahead ?'),!0)},t._syncOffset=function(e){for(var t=A(1e3,e.length-564),a=0;a<t;){if(71===e[a]&&71===e[a+188]&&71===e[a+376])return a;a++}return-1},t.createTrack=function(e,t){return{container:'video'===e||'audio'===e?'video/mp2t':void 0,type:e,id:V[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:'video'===e?0:void 0,isAAC:'audio'===e||void 0,duration:'audio'===e?t:void 0}},t.prototype.resetInitSegment=function(e,a,r,n){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=t.createTrack('video',n),this._audioTrack=t.createTrack('audio',n),this._id3Track=t.createTrack('id3',n),this._txtTrack=t.createTrack('text',n),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=a,this.videoCodec=r,this._duration=n},t.prototype.resetTimeStamp=function(){},t.prototype.append=function(e,a,r,n){var o=e.length,i=!1,d,s,l,p,u,c;this.contiguous=r;var g=this.pmtParsed,f=this._avcTrack,y=this._audioTrack,m=this._id3Track,h=f.pid,v=y.pid,E=m.pid,b=this._pmtId,T=f.pesData,S=y.pesData,_=m.pesData,R=this._parsePAT,A=this._parsePMT,k=this._parsePES,L=this._parseAVCPES.bind(this),D=this._parseAACPES.bind(this),I=this._parseMPEGPES.bind(this),O=this._parseID3PES.bind(this),x=t._syncOffset(e);for(o-=(o+x)%188,d=x;d<o;d+=188)if(71===e[d]){if(s=!!(64&e[d+1]),l=((31&e[d+1])<<8)+e[d+2],p=(48&e[d+3])>>4,!(1<p))u=d+4;else if(u=d+5+e[d+4],u===d+188)continue;switch(l){case h:s&&(T&&(c=k(T))&&void 0!==c.pts&&L(c,!1),T={data:[],size:0}),T&&(T.data.push(e.subarray(u,d+188)),T.size+=d+188-u);break;case v:s&&(S&&(c=k(S))&&void 0!==c.pts&&(y.isAAC?D(c):I(c)),S={data:[],size:0}),S&&(S.data.push(e.subarray(u,d+188)),S.size+=d+188-u);break;case E:s&&(_&&(c=k(_))&&void 0!==c.pts&&O(c),_={data:[],size:0}),_&&(_.data.push(e.subarray(u,d+188)),_.size+=d+188-u);break;case 0:s&&(u+=e[u]+1),b=this._pmtId=R(e,u);break;case b:s&&(u+=e[u]+1);var N=A(e,u,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);h=N.avc,0<h&&(f.pid=h),v=N.audio,0<v&&(y.pid=v,y.isAAC=N.isAAC),E=N.id3,0<E&&(m.pid=E),i&&!g&&(F.b.log('reparse from beginning'),i=!1,d=x-188),g=this.pmtParsed=!0;break;case 17:case 8191:break;default:i=!0;}}else this.observer.trigger(P.a.ERROR,{type:C.b.MEDIA_ERROR,details:C.a.FRAG_PARSING_ERROR,fatal:!1,reason:'TS packet did not start with 0x47'});T&&(c=k(T))&&void 0!==c.pts?(L(c,!0),f.pesData=null):f.pesData=T,S&&(c=k(S))&&void 0!==c.pts?(y.isAAC?D(c):I(c),y.pesData=null):(S&&S.size&&F.b.log('last AAC PES packet truncated,might overlap between fragments'),y.pesData=S),_&&(c=k(_))&&void 0!==c.pts?(O(c),m.pesData=null):m.pesData=_,null==this.sampleAes?this.remuxer.remux(y,f,m,this._txtTrack,a,r,n):this.decryptAndRemux(y,f,m,this._txtTrack,a,r,n)},t.prototype.decryptAndRemux=function(e,t,a,r,n,o,i){if(e.samples&&e.isAAC){var d=this;this.sampleAes.decryptAacSamples(e.samples,0,function(){d.decryptAndRemuxAvc(e,t,a,r,n,o,i)})}else this.decryptAndRemuxAvc(e,t,a,r,n,o,i)},t.prototype.decryptAndRemuxAvc=function(e,t,a,r,n,o,i){if(t.samples){var d=this;this.sampleAes.decryptAvcSamples(t.samples,0,0,function(){d.remuxer.remux(e,t,a,r,n,o,i)})}else this.remuxer.remux(e,t,a,r,n,o,i)},t.prototype.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},t.prototype._parsePAT=function(e,t){return(31&e[t+10])<<8|e[t+11]},t.prototype._parsePMT=function(e,t,a,r){var n={audio:-1,avc:-1,id3:-1,isAAC:!0},o,i,d,s;for(o=(15&e[t+1])<<8|e[t+2],i=t+3+o-4,d=(15&e[t+10])<<8|e[t+11],t+=12+d;t<i;){switch(s=(31&e[t+1])<<8|e[t+2],e[t]){case 207:if(!r){F.b.log('unkown stream type:'+e[t]);break}case 15:-1===n.audio&&(n.audio=s);break;case 21:-1===n.id3&&(n.id3=s);break;case 219:if(!r){F.b.log('unkown stream type:'+e[t]);break}case 27:-1===n.avc&&(n.avc=s);break;case 3:case 4:a?-1===n.audio&&(n.audio=s,n.isAAC=!1):F.b.log('MPEG audio found, not supported in this browser for now');break;case 36:F.b.warn('HEVC stream type found, not supported for now');break;default:F.b.log('unkown stream type:'+e[t]);}t+=((15&e[t+3])<<8|e[t+4])+5}return n},t.prototype._parsePES=function(e){var t=0,a=e.data,r,n,o,d,s,l,p,u,c;if(!e||0===e.size)return null;for(;19>a[0].length&&1<a.length;){var g=new Uint8Array(a[0].length+a[1].length);g.set(a[0]),g.set(a[1],a[0].length),a[0]=g,a.splice(1,1)}if(r=a[0],o=(r[0]<<16)+(r[1]<<8)+r[2],1===o){if(d=(r[4]<<8)+r[5],d&&d>e.size-6)return null;n=r[7],192&n&&(p=536870912*(14&r[9])+4194304*(255&r[10])+16384*(254&r[11])+128*(255&r[12])+(254&r[13])/2,4294967295<p&&(p-=8589934592),64&n?(u=536870912*(14&r[14])+4194304*(255&r[15])+16384*(254&r[16])+128*(255&r[17])+(254&r[18])/2,4294967295<u&&(u-=8589934592),5400000<p-u&&(F.b.warn(k((p-u)/9e4)+'s delta between PTS and DTS, align them'),p=u)):u=p),s=r[8],c=s+9,e.size-=c,l=new Uint8Array(e.size);for(var f=0,y=a.length;f<y;f++){r=a[f];var m=r.byteLength;if(c)if(c>m){c-=m;continue}else r=r.subarray(c),m-=c,c=0;l.set(r,t),t+=m}return d&&(d-=s+3),{data:l,pts:p,dts:u,len:d}}return null},t.prototype.pushAccesUnit=function(e,t){if(e.units.length&&e.frame){var a=t.samples,r=a.length;!this.config.forceKeyFrameOnDiscontinuity||!0===e.key||t.sps&&(r||this.contiguous)?(e.id=r,a.push(e)):t.dropped++}e.debug.length&&F.b.log(e.pts+'/'+e.dts+':'+e.debug)},t.prototype._parseAVCPES=function(e,t){var a=this,r=this._avcTrack,n=this._parseAVCNALu(e.data),o=void 0,d=this.avcSample,s=void 0,l=!1,p=void 0,u=this.pushAccesUnit.bind(this),c=function(e,t,a,r){return{key:e,pts:t,dts:a,units:[],debug:r}};e.data=null,d&&n.length&&!r.audFound&&(u(d,r),d=this.avcSample=c(!1,e.pts,e.dts,'')),n.forEach(function(t){switch(t.type){case 1:s=!0,d||(d=a.avcSample=c(!0,e.pts,e.dts,'')),d.frame=!0;var n=t.data;if(l&&4<n.length){var i=new K(n).readSliceType();(2===i||4===i||7===i||9===i)&&(d.key=!0)}break;case 5:s=!0,d||(d=a.avcSample=c(!0,e.pts,e.dts,'')),d.key=!0,d.frame=!0;break;case 6:s=!0,o=new K(a.discardEPB(t.data)),o.readUByte();for(var g=0,f=0,y=!1,m=0;!y&&1<o.bytesAvailable;){g=0;do m=o.readUByte(),g+=m;while(255===m);f=0;do m=o.readUByte(),f+=m;while(255===m);if(4===g&&0!==o.bytesAvailable){y=!0;var v=o.readUByte();if(181===v){var E=o.readUShort();if(49===E){var T=o.readUInt();if(1195456820===T){var S=o.readUByte();if(3===S){var _=o.readUByte(),R=o.readUByte(),A=[_,R];for(p=0;p<(31&_);p++)A.push(o.readUByte()),A.push(o.readUByte()),A.push(o.readUByte());a._insertSampleInOrder(a._txtTrack.samples,{type:3,pts:e.pts,bytes:A})}}}}}else if(f<o.bytesAvailable)for(p=0;p<f;p++)o.readUByte()}break;case 7:if(s=!0,l=!0,!r.sps){o=new K(t.data);var k=o.readSPS();r.width=k.width,r.height=k.height,r.pixelRatio=k.pixelRatio,r.sps=[t.data],r.duration=a._duration;var L=t.data.subarray(1,4),D='avc1.';for(p=0;3>p;p++){var P=L[p].toString(16);2>P.length&&(P='0'+P),D+=P}r.codec=D}break;case 8:s=!0,r.pps||(r.pps=[t.data]);break;case 9:s=!1,r.audFound=!0,d&&u(d,r),d=a.avcSample=c(!1,e.pts,e.dts,'');break;case 12:s=!1;break;default:s=!1,d&&(d.debug+='unknown NAL '+t.type+' ');}if(d&&s){var C=d.units;C.push(t)}}),t&&d&&(u(d,r),this.avcSample=null)},t.prototype._insertSampleInOrder=function(e,t){var a=e.length;if(!(0<a))e.push(t);else if(t.pts>=e[a-1].pts)e.push(t);else for(var r=a-1;0<=r;r--)if(t.pts<e[r].pts){e.splice(r,0,t);break}},t.prototype._getLastNalUnit=function(){var e=this.avcSample,t;if(!e||0===e.units.length){var a=this._avcTrack,r=a.samples;e=r[r.length-1]}if(e){var n=e.units;t=n[n.length-1]}return t},t.prototype._parseAVCNALu=function(e){var t=0,a=e.byteLength,r=void 0,n=void 0,o=this._avcTrack,d=o.naluState||0,s=d,l=[],p=void 0,u=void 0,c=-1,g=void 0;for(-1===d&&(c=0,g=31&e[0],d=0,t=1);t<a;){if(r=e[t++],!d){d=r?0:1;continue}if(1===d){d=r?0:2;continue}if(!r)d=3;else if(1===r){if(0<=c)p={data:e.subarray(c,t-d-1),type:g},l.push(p);else{var f=this._getLastNalUnit();if(f&&(s&&t<=4-s&&f.state&&(f.data=f.data.subarray(0,f.data.byteLength-s)),n=t-d-1,0<n)){var y=new Uint8Array(f.data.byteLength+n);y.set(f.data,0),y.set(e.subarray(0,n),f.data.byteLength),f.data=y}}t<a?(u=31&e[t],c=t,g=u,d=0):d=-1}else d=0}if(0<=c&&0<=d&&(p={data:e.subarray(c,a),type:g,state:d},l.push(p)),0===l.length){var m=this._getLastNalUnit();if(m){var h=new Uint8Array(m.data.byteLength+e.byteLength);h.set(m.data,0),h.set(e,m.data.byteLength),m.data=h}}return o.naluState=d,l},t.prototype.discardEPB=function(e){for(var t=e.byteLength,a=[],r=1,n,o;r<t-2;)0===e[r]&&0===e[r+1]&&3===e[r+2]?(a.push(r+2),r+=2):r++;if(0===a.length)return e;n=t-a.length,o=new Uint8Array(n);var d=0;for(r=0;r<n;d++,r++)d===a[0]&&(d++,a.shift()),o[r]=e[d];return o},t.prototype._parseAACPES=function(t){var a=this._audioTrack,r=t.data,n=t.pts,o=this.aacOverFlow,i=this.aacLastPTS,d,l,c,f,y;if(o){var m=new Uint8Array(o.byteLength+r.byteLength);m.set(o,0),m.set(r,o.byteLength),r=m}for(c=0,y=r.length;c<y-1&&!s(r,c);c++);if(c){var h,v;if(c<y-1?(h='AAC PES did not start with ADTS header,offset:'+c,v=!1):(h='no ADTS header found in AAC PES',v=!0),F.b.warn('parsing error:'+h),this.observer.trigger(P.a.ERROR,{type:C.b.MEDIA_ERROR,details:C.a.FRAG_PARSING_ERROR,fatal:v,reason:h}),v)return}if(p(a,this.observer,r,c,this.audioCodec),l=0,d=u(a.samplerate),o&&i){var E=i+d;1<e(E-n)&&(F.b.log('AAC: align PTS for overlapping frames by '+k((E-n)/90)),n=E)}for(;c<y;)if(s(r,c)&&c+5<y){var b=g(a,r,c,n,l);if(b)c+=b.length,f=b.sample.pts,l++;else break}else c++;o=c<y?r.subarray(c,y):null,this.aacOverFlow=o,this.aacLastPTS=f},t.prototype._parseMPEGPES=function(e){for(var t=e.data,a=t.length,r=0,n=0,o=e.pts;n<a;)if(B.isHeader(t,n)){var i=B.appendFrame(this._audioTrack,t,n,o,r);if(i)n+=i.length,r++;else break}else n++},t.prototype._parseID3PES=function(e){this._id3Track.samples.push(e)},t}(),Y=function(){function e(t,a,r){v(this,e),this.observer=t,this.config=r,this.remuxer=a}return e.prototype.resetInitSegment=function(e,t,a,r){this._audioTrack={container:'audio/mpeg',type:'audio',id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:t,duration:r,inputTimeScale:9e4}},e.prototype.resetTimeStamp=function(){},e.probe=function(e){var t=void 0,a=void 0,r=N.a.getID3Data(e,0);if(r&&void 0!==N.a.getTimeStamp(r))for(t=r.length,a=A(e.length-1,t+100);t<a;t++)if(B.probe(e,t))return F.b.log('MPEG Audio sync word found !'),!0;return!1},e.prototype.append=function(e,t,a,r){for(var n=N.a.getID3Data(e,0),o=N.a.getTimeStamp(n),i=o?90*o:9e4*t,d=n.length,s=e.length,l=0,p=0,u=this._audioTrack,c=[{pts:i,dts:i,data:n}];d<s;)if(B.isHeader(e,d)){var g=B.appendFrame(u,e,d,i,l);if(g)d+=g.length,p=g.sample.pts,l++;else break}else N.a.isHeader(e,d)?(n=N.a.getID3Data(e,d),c.push({pts:p,dts:p,data:n}),d+=n.length):d++;this.remuxer.remux(u,{samples:[]},{samples:c,inputTimeScale:9e4},{samples:[]},t,a,r)},e.prototype.destroy=function(){},e}(),q=function(){function e(){E(this,e)}return e.getSilentFrame=function(e,t){switch(e){case'mp4a.40.2':if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);}return null},e}(),z=q,j=function(){function e(){b(this,e)}return e.init=function(){for(var t in e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var a=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:a,audio:r};var n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),o=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=o,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var i=new Uint8Array([105,115,111,109]),d=new Uint8Array([97,118,99,49]),s=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,i,s,i,d),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,n))},e.box=function(e){for(var t=Array.prototype.slice.call(arguments,1),a=8,r=t.length,n=r,o;r--;)a+=t[r].byteLength;for(o=new Uint8Array(a),o[0]=255&a>>24,o[1]=255&a>>16,o[2]=255&a>>8,o[3]=255&a,o.set(e,4),(r=0,a=8);r<n;r++)o.set(t[r],a),a+=t[r].byteLength;return o},e.hdlr=function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])},e.mdat=function(t){return e.box(e.types.mdat,t)},e.mdhd=function(t,a){a*=t;var r=L(a/4294967296),n=L(a%4294967296);return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,255&t>>24,255&t>>16,255&t>>8,255&t,r>>24,255&r>>16,255&r>>8,255&r,n>>24,255&n>>16,255&n>>8,255&n,85,196,0,0]))},e.mdia=function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))},e.mfhd=function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,255&t>>16,255&t>>8,255&t]))},e.minf=function(t){return'audio'===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))},e.moof=function(t,a,r){return e.box(e.types.moof,e.mfhd(t),e.traf(r,a))},e.moov=function(t){for(var a=t.length,r=[];a--;)r[a]=e.trak(t[a]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(r).concat(e.mvex(t)))},e.mvex=function(t){for(var a=t.length,r=[];a--;)r[a]=e.trex(t[a]);return e.box.apply(null,[e.types.mvex].concat(r))},e.mvhd=function(t,a){a*=t;var r=L(a/4294967296),n=L(a%4294967296),o=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,255&t>>24,255&t>>16,255&t>>8,255&t,r>>24,255&r>>16,255&r>>8,255&r,n>>24,255&n>>16,255&n>>8,255&n,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,o)},e.sdtp=function(t){var a=t.samples||[],r=new Uint8Array(4+a.length),n,o;for(o=0;o<a.length;o++)n=a[o].flags,r[o+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return e.box(e.types.sdtp,r)},e.stbl=function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))},e.avc1=function(t){var a=[],r=[],n,o,d;for(n=0;n<t.sps.length;n++)o=t.sps[n],d=o.byteLength,a.push(255&d>>>8),a.push(255&d),a=a.concat(Array.prototype.slice.call(o));for(n=0;n<t.pps.length;n++)o=t.pps[n],d=o.byteLength,r.push(255&d>>>8),r.push(255&d),r=r.concat(Array.prototype.slice.call(o));var s=e.box(e.types.avcC,new Uint8Array([1,a[3],a[4],a[5],255,224|t.sps.length].concat(a).concat([t.pps.length]).concat(r))),l=t.width,p=t.height,u=t.pixelRatio[0],c=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255&l>>8,255&l,255&p>>8,255&p,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),s,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([u>>24,255&u>>16,255&u>>8,255&u,c>>24,255&c>>16,255&c>>8,255&c])))},e.esds=function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))},e.mp4a=function(t){var a=t.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,255&a>>8,255&a,0,0]),e.box(e.types.esds,e.esds(t)))},e.mp3=function(t){var a=t.samplerate;return e.box(e.types['.mp3'],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,255&a>>8,255&a,0,0]))},e.stsd=function(t){return'audio'===t.type?t.isAAC||'mp3'!==t.codec?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.mp3(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))},e.tkhd=function(t){var a=t.id,r=t.duration*t.timescale,n=t.width,o=t.height,i=L(r/4294967296),d=L(r%4294967296);return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,255&a>>24,255&a>>16,255&a>>8,255&a,0,0,0,0,i>>24,255&i>>16,255&i>>8,255&i,d>>24,255&d>>16,255&d>>8,255&d,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,255&n>>8,255&n,0,0,255&o>>8,255&o,0,0]))},e.traf=function(t,a){var r=e.sdtp(t),n=t.id,o=L(a/4294967296),i=L(a%4294967296);return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,n>>24,255&n>>16,255&n>>8,255&n])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,o>>24,255&o>>16,255&o>>8,255&o,i>>24,255&i>>16,255&i>>8,255&i])),e.trun(t,r.length+16+20+8+16+8+8),r)},e.trak=function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))},e.trex=function(t){var a=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,a>>24,255&a>>16,255&a>>8,255&a,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},e.trun=function(t,a){var r=t.samples||[],n=r.length,o=12+16*n,d=new Uint8Array(o),s,l,p,u,c,g;for(a+=8+o,d.set([0,0,15,1,255&n>>>24,255&n>>>16,255&n>>>8,255&n,255&a>>>24,255&a>>>16,255&a>>>8,255&a],0),s=0;s<n;s++)l=r[s],p=l.duration,u=l.size,c=l.flags,g=l.cts,d.set([255&p>>>24,255&p>>>16,255&p>>>8,255&p,255&u>>>24,255&u>>>16,255&u>>>8,255&u,c.isLeading<<2|c.dependsOn,c.isDependedOn<<6|c.hasRedundancy<<4|c.paddingValue<<1|c.isNonSync,61440&c.degradPrio,15&c.degradPrio,255&g>>>24,255&g>>>16,255&g>>>8,255&g],12+16*s);return e.box(e.types.trun,d)},e.initSegment=function(t){e.types||e.init();var a=e.moov(t),r;return r=new Uint8Array(e.FTYP.byteLength+a.byteLength),r.set(e.FTYP),r.set(a,e.FTYP.byteLength),r},e}(),X=j,Q=function(){function t(e,a,r,n){T(this,t),this.observer=e,this.config=a,this.typeSupported=r;var o=navigator.userAgent;this.isSafari=n&&-1<n.indexOf('Apple')&&o&&!o.match('CriOS'),this.ISGenerated=!1}return t.prototype.destroy=function(){},t.prototype.resetTimeStamp=function(e){this._initPTS=this._initDTS=e},t.prototype.resetInitSegment=function(){this.ISGenerated=!1},t.prototype.remux=function(e,t,a,r,n,o,i){if(this.ISGenerated||this.generateIS(e,t,n),this.ISGenerated){var d=e.samples.length,s=t.samples.length,l=n,p=n;if(d&&s){var u=(e.samples[0].dts-t.samples[0].dts)/t.inputTimeScale;l+=R(0,u),p+=R(0,-u)}if(d){e.timescale||(F.b.warn('regenerate InitSegment as audio detected'),this.generateIS(e,t,n));var c=this.remuxAudio(e,l,o,i);if(s){var g;c&&(g=c.endPTS-c.startPTS),t.timescale||(F.b.warn('regenerate InitSegment as video detected'),this.generateIS(e,t,n)),this.remuxVideo(t,p,o,g,i)}}else if(s){var f=this.remuxVideo(t,p,o,0,i);f&&e.codec&&this.remuxEmptyAudio(e,l,o,f)}}a.samples.length&&this.remuxID3(a,n),r.samples.length&&this.remuxText(r,n),this.observer.trigger(P.a.FRAG_PARSED)},t.prototype.generateIS=function(e,t,a){var r=this.observer,n=e.samples,o=t.samples,i=this.typeSupported,d='audio/mp4',s={},l=void 0===this._initPTS,p,u;if(l&&(p=u=1/0),e.config&&n.length&&(e.timescale=e.samplerate,F.b.log('audio sampling rate : '+e.samplerate),!e.isAAC&&(i.mpeg?(d='audio/mpeg',e.codec=''):i.mp3&&(e.codec='mp3')),s.audio={container:d,codec:e.codec,initSegment:!e.isAAC&&i.mpeg?new Uint8Array:X.initSegment([e]),metadata:{channelCount:e.channelCount}},l&&(p=u=n[0].pts-e.inputTimeScale*a)),t.sps&&t.pps&&o.length){var c=t.inputTimeScale;t.timescale=c,s.video={container:'video/mp4',codec:t.codec,initSegment:X.initSegment([t]),metadata:{width:t.width,height:t.height}},l&&(p=A(p,o[0].pts-c*a),u=A(u,o[0].dts-c*a),this.observer.trigger(P.a.INIT_PTS_FOUND,{initPTS:p}))}Object.keys(s).length?(r.trigger(P.a.FRAG_PARSING_INIT_SEGMENT,{tracks:s}),this.ISGenerated=!0,l&&(this._initPTS=p,this._initDTS=u)):r.trigger(P.a.ERROR,{type:C.b.MEDIA_ERROR,details:C.a.FRAG_PARSING_ERROR,fatal:!1,reason:'no audio/video samples found'})},t.prototype.remuxVideo=function(t,a,r,n,o){var d=8,s=t.timescale,l=void 0,p=void 0,u=void 0,c=void 0,g=void 0,f=void 0,y=void 0,m=t.samples,h=[],v=m.length,E=this._PTSNormalize,b=this._initDTS,T=this.nextAvcDts,S=this.isSafari;if(0!==v){S&&(r|=m.length&&T&&(o&&.1>e(a-T/s)||e(m[0].pts-T-b)<s/5)),r||(T=a*s),m.forEach(function(e){e.pts=E(e.pts-b,T),e.dts=E(e.dts-b,T)}),m.sort(function(e,t){var a=e.dts-t.dts,r=e.pts-t.pts;return a||r||e.id-t.id});var _=m.reduce(function(e,t){return R(A(e,t.pts-t.dts),-18e3)},0);if(0>_){F.b.warn('PTS < DTS detected in video samples, shifting DTS by '+k(_/90)+' ms to overcome this issue');for(var D=0;D<m.length;D++)m[D].dts+=_}var I=m[0];g=R(I.dts,0),c=R(I.pts,0);var O=k((g-T)/90);r&&O&&(1<O?F.b.log('AVC:'+O+' ms hole between fragments detected,filling it'):-1>O&&F.b.log('AVC:'+-O+' ms overlapping between fragments detected'),g=T,m[0].dts=g,c=R(c-O,T),m[0].pts=c,F.b.log('Video/PTS/DTS adjusted: '+k(c/90)+'/'+k(g/90)+',delta:'+O+' ms')),I=m[m.length-1],y=R(I.dts,0),f=R(I.pts,0,y),S&&(l=k((y-g)/(m.length-1)));for(var x=0,N=0,w=0;w<v;w++){for(var M=m[w],U=M.units,B=U.length,G=0,K=0;K<B;K++)G+=U[K].data.length;N+=G,x+=B,M.length=G,M.dts=S?g+w*l:R(M.dts,g),M.pts=R(M.pts,M.dts)}var H=N+4*x+8;try{p=new Uint8Array(H)}catch(e){return void this.observer.trigger(P.a.ERROR,{type:C.b.MUX_ERROR,details:C.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:H,reason:'fail allocating video mdat '+H})}var V=new DataView(p.buffer);V.setUint32(0,H),p.set(X.types.mdat,4);for(var W=0;W<v;W++){for(var Y=m[W],q=Y.units,z=0,Q=void 0,Z=0,J=q.length;Z<J;Z++){var $=q[Z],ee=$.data,te=$.data.byteLength;V.setUint32(d,te),d+=4,p.set(ee,d),d+=te,z+=4+te}if(!S){if(W<v-1)l=m[W+1].dts-Y.dts;else{var ae=this.config,re=Y.dts-m[0<W?W-1:W].dts;if(ae.stretchShortVideoTrack){var ne=ae.maxBufferHole,oe=L(ne*s),ie=(n?c+n*s:this.nextAudioPts)-Y.pts;ie>oe?(l=ie-re,0>l&&(l=re),F.b.log('It is approximately '+ie/90+' ms to the next segment; using duration '+l/90+' ms for the last video frame.')):l=re}else l=re}Q=k(Y.pts-Y.dts)}else Q=R(0,l*k((Y.pts-Y.dts)/l));h.push({size:z,duration:l,cts:Q,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:Y.key?2:1,isNonSync:Y.key?0:1}})}this.nextAvcDts=y+l;var de=t.dropped;if(t.len=0,t.nbNalu=0,t.dropped=0,h.length&&-1<navigator.userAgent.toLowerCase().indexOf('chrome')){var se=h[0].flags;se.dependsOn=2,se.isNonSync=0}t.samples=h,u=X.moof(t.sequenceNumber++,g,t),t.samples=[];var le={data1:u,data2:p,startPTS:c/s,endPTS:(f+l)/s,startDTS:g/s,endDTS:this.nextAvcDts/s,type:'video',hasAudio:!1,hasVideo:!0,nb:h.length,dropped:de};return this.observer.trigger(P.a.FRAG_PARSING_DATA,le),le}},t.prototype.remuxAudio=function(t,a,r,n){var o=t.inputTimeScale,d=t.timescale,s=o/d,l=t.isAAC?1024:1152,p=l*s,u=this._PTSNormalize,c=this._initDTS,g=!t.isAAC&&this.typeSupported.mpeg,f=void 0,y=void 0,m=void 0,h=void 0,v=void 0,E=void 0,b=void 0,T=t.samples,S=[],_=this.nextAudioPts;if(r|=T.length&&_&&(n&&.1>e(a-_/o)||e(T[0].pts-_-c)<20*p),T.forEach(function(e){e.pts=e.dts=u(e.pts-c,a*o)}),T=T.filter(function(e){return 0<=e.pts}),0!==T.length){if(r||(n?_=a*o:_=T[0].pts),t.isAAC)for(var A=this.config.maxAudioFramesDrift,L=0,D=_;L<T.length;){var I=T[L],O=I.pts,x;x=O-D;var N=e(1e3*x/o);if(x<=-A*p)F.b.warn('Dropping 1 audio frame @ '+(D/o).toFixed(3)+'s due to '+k(N)+' ms overlap.'),T.splice(L,1),t.len-=I.unit.length;else if(x>=A*p&&10000>N&&D){var w=k(x/p);F.b.warn('Injecting '+w+' audio frame @ '+(D/o).toFixed(3)+'s due to '+k(1e3*x/o)+' ms gap.');for(var M=0,U;M<w;M++)U=R(D,0),m=z.getSilentFrame(t.manifestCodec||t.codec,t.channelCount),m||(F.b.log('Unable to get silent frame for given audio codec; duplicating last frame instead.'),m=I.unit.subarray()),T.splice(L,0,{unit:m,pts:U,dts:U}),t.len+=m.length,D+=p,L++;I.pts=I.dts=D,D+=p,L++}else I.pts=I.dts=D,D+=p,L++}for(var B=0,G=T.length;B<G;B++){var K=T[B],H=K.unit,V=K.pts;if(void 0!==b)y.duration=k((V-b)/s);else{var W=k(1e3*(V-_)/o),Y=0;if(r&&t.isAAC&&W){if(0<W&&10000>W)Y=k((V-_)/p),F.b.log(W+' ms hole between AAC samples detected,filling it'),0<Y&&(m=z.getSilentFrame(t.manifestCodec||t.codec,t.channelCount),!m&&(m=H.subarray()),t.len+=Y*m.length);else if(-12>W){F.b.log('drop overlapping AAC sample, expected/parsed/delta:'+(_/o).toFixed(3)+'s/'+(V/o).toFixed(3)+'s/'+-W+'ms'),t.len-=H.byteLength;continue}V=_}if(E=V,0<t.len){var q=g?t.len:t.len+8;f=g?0:8;try{h=new Uint8Array(q)}catch(e){return void this.observer.trigger(P.a.ERROR,{type:C.b.MUX_ERROR,details:C.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:q,reason:'fail allocating audio mdat '+q})}if(!g){var Q=new DataView(h.buffer);Q.setUint32(0,q),h.set(X.types.mdat,4)}}else return;for(var Z=0;Z<Y;Z++)m=z.getSilentFrame(t.manifestCodec||t.codec,t.channelCount),m||(F.b.log('Unable to get silent frame for given audio codec; duplicating this frame instead.'),m=H.subarray()),h.set(m,f),f+=m.byteLength,y={size:m.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},S.push(y)}h.set(H,f);var J=H.byteLength;f+=J,y={size:J,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},S.push(y),b=V}var $=0,ee=S.length;if(2<=ee&&($=S[ee-2].duration,y.duration=$),ee){this.nextAudioPts=_=b+s*$,t.len=0,t.samples=S,v=g?new Uint8Array:X.moof(t.sequenceNumber++,E/s,t),t.samples=[];var te=E/o,ae=_/o,re={data1:v,data2:h,startPTS:te,endPTS:ae,startDTS:te,endDTS:ae,type:'audio',hasAudio:!0,hasVideo:!1,nb:ee};return this.observer.trigger(P.a.FRAG_PARSING_DATA,re),re}return null}},t.prototype.remuxEmptyAudio=function(e,t,a,r){var n=e.inputTimeScale,o=e.samplerate?e.samplerate:n,d=this.nextAudioPts,s=(void 0===d?r.startDTS*n:d)+this._initDTS,l=r.endDTS*n+this._initDTS,p=1024*(n/o),u=D((l-s)/p),c=z.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(F.b.warn('remux empty Audio'),!c)return void F.b.trace('Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!');for(var g=[],f=0,y;f<u;f++)y=s+f*p,g.push({unit:c,pts:y,dts:y}),e.len+=c.length;e.samples=g,this.remuxAudio(e,t,a)},t.prototype.remuxID3=function(e,t){var a=e.samples.length,r=void 0,n=e.inputTimeScale,o=this._initPTS,i=this._initDTS;if(a){for(var d=0;d<a;d++)r=e.samples[d],r.pts=(r.pts-o)/n,r.dts=(r.dts-i)/n;this.observer.trigger(P.a.FRAG_PARSING_METADATA,{samples:e.samples})}e.samples=[],t=t},t.prototype.remuxText=function(e,t){e.samples.sort(function(e,t){return e.pts-t.pts});var a=e.samples.length,r=void 0,n=e.inputTimeScale,o=this._initPTS;if(a){for(var i=0;i<a;i++)r=e.samples[i],r.pts=(r.pts-o)/n;this.observer.trigger(P.a.FRAG_PARSING_USERDATA,{samples:e.samples})}e.samples=[],t=t},t.prototype._PTSNormalize=function(t,a){var r;if(void 0===a)return t;for(r=a<t?-8589934592:8589934592;4294967296<e(t-a);)t+=r;return t},t}(),Z=Q,J=function(){function e(t){S(this,e),this.observer=t}return e.prototype.destroy=function(){},e.prototype.resetTimeStamp=function(){},e.prototype.resetInitSegment=function(){},e.prototype.remux=function(e,t,a,r,n,o,i,d){var s=this.observer,l='';e&&(l+='audio'),t&&(l+='video'),s.trigger(P.a.FRAG_PARSING_DATA,{data1:d,startPTS:n,startDTS:n,type:l,hasAudio:!!e,hasVideo:!!t,nb:1,dropped:0}),s.trigger(P.a.FRAG_PARSED)},e}(),$=Object(x.a)(),ee=$.performance,te=function(){function e(t,a,r,n){_(this,e),this.observer=t,this.typeSupported=a,this.config=r,this.vendor=n}return e.prototype.destroy=function(){var e=this.demuxer;e&&e.destroy()},e.prototype.push=function(e,t,a,r,n,o,i,d,s,l,p,u){if(0<e.byteLength&&null!=t&&null!=t.key&&'AES-128'===t.method){var c=this.decrypter;null==c&&(c=this.decrypter=new I.a(this.observer,this.config));var g=this,f=void 0;try{f=ee.now()}catch(e){f=Date.now()}c.decrypt(e,t.key.buffer,t.iv.buffer,function(e){var c;try{c=ee.now()}catch(e){c=Date.now()}g.observer.trigger(P.a.FRAG_DECRYPTED,{stats:{tstart:f,tdecrypt:c}}),g.pushDecrypted(new Uint8Array(e),t,new Uint8Array(a),r,n,o,i,d,s,l,p,u)})}else this.pushDecrypted(new Uint8Array(e),t,new Uint8Array(a),r,n,o,i,d,s,l,p,u)},e.prototype.pushDecrypted=function(e,t,a,r,n,o,d,s,l,p,u,c){var g=this.demuxer;if(!g||(d||s)&&!this.probe(e)){for(var f=this.observer,y=this.typeSupported,m=this.config,h=[{demux:W,remux:Z},{demux:M.a,remux:J},{demux:w,remux:Z},{demux:Y,remux:Z}],v=0,E=h.length;v<E;v++){var b=h[v],T=b.demux.probe;if(T(e)){var S=this.remuxer=new b.remux(f,m,y,this.vendor);g=new b.demux(f,S,m,y),this.probe=T;break}}if(!g)return void f.trigger(P.a.ERROR,{type:C.b.MEDIA_ERROR,details:C.a.FRAG_PARSING_ERROR,fatal:!0,reason:'no demux matching with content found'});this.demuxer=g}var _=this.remuxer;(d||s)&&(g.resetInitSegment(a,r,n,p),_.resetInitSegment()),d&&(g.resetTimeStamp(c),_.resetTimeStamp(c)),'function'==typeof g.setDecryptData&&g.setDecryptData(t),g.append(e,o,l,u)},e}(),ae=a.a=te},function(t,a,r){function n(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function o(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function i(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function d(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function s(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function l(e,t){var a=It[t];return!!a&&!0===a[e.slice(0,4)]}function p(e,t){return window.MediaSource.isTypeSupported((t||'video')+'/mp4;codecs="'+e+'"')}function u(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function c(e,t){for(var a=e[t],r=t-1,n;0<=r;r--)n=e[r],n.programDateTime=a.programDateTime-1e3*n.duration,a=n}function g(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),Object(ut.a)(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}function f(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function y(e,t){if(!e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return t&&('object'===('undefined'==typeof t?'undefined':N(t))||'function'==typeof t)?t:e}function m(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+('undefined'==typeof t?'undefined':N(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function h(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function v(e,t){if(!e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return t&&('object'===('undefined'==typeof t?'undefined':N(t))||'function'==typeof t)?t:e}function E(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+('undefined'==typeof t?'undefined':N(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function b(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function T(e,t){if(!e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return t&&('object'===('undefined'==typeof t?'undefined':N(t))||'function'==typeof t)?t:e}function S(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+('undefined'==typeof t?'undefined':N(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function P(e,t){if(!e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return t&&('object'===('undefined'==typeof t?'undefined':N(t))||'function'==typeof t)?t:e}function C(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+('undefined'==typeof t?'undefined':N(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function I(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function O(){if('undefined'!=typeof window)return window.MediaSource||window.WebKitMediaSource}function F(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function x(e,t,a){'audio'===t?(e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds.push(a)):'text'===t?(e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds.push(a)):void 0}function w(e,t,a){var r=e[t],n=e[a],o=n.startPTS;Object(ut.a)(o)?a>t?(r.duration=o-r.start,0>r.duration&&gt.b.warn('negative duration computed for frag '+r.sn+',level '+r.level+', there should be some duration drift between playlist and fragment!')):(n.duration=r.start-o,0>n.duration&&gt.b.warn('negative duration computed for frag '+n.sn+',level '+n.level+', there should be some duration drift between playlist and fragment!')):a>t?n.start=r.start+r.duration:n.start=R(r.start-n.duration,0)}function M(t,a,r,n,o,d){var s=r;if(Object(ut.a)(a.startPTS)){var l=e(a.startPTS-r);a.deltaPTS=Object(ut.a)(a.deltaPTS)?R(l,a.deltaPTS):l,s=R(r,a.startPTS),r=A(r,a.startPTS),n=R(n,a.endPTS),o=A(o,a.startDTS),d=R(d,a.endDTS)}var p=r-a.start;a.start=a.startPTS=r,a.maxStartPTS=s,a.endPTS=n,a.startDTS=o,a.endDTS=d,a.duration=n-r;var u=a.sn;if(!t||u<t.startSN||u>t.endSN)return 0;var c,g,f;for(c=u-t.startSN,g=t.fragments,g[c]=a,f=c;0<f;f--)w(g,f,f-1);for(f=c;f<g.length-1;f++)w(g,f,f+1);return t.PTSKnown=!0,p}function U(e,t){var a=R(e.startSN,t.startSN)-t.startSN,r=A(e.endSN,t.endSN)-t.startSN,n=t.startSN-e.startSN,o=e.fragments,d=t.fragments,s=0,l;if(t.initSegment&&e.initSegment&&(t.initSegment=e.initSegment),r<a)return void(t.PTSKnown=!1);for(var p=a;p<=r;p++){var u=o[n+p],c=d[p];c&&u&&(s=u.cc-c.cc,Object(ut.a)(u.startPTS)&&(c.start=c.startPTS=u.startPTS,c.endPTS=u.endPTS,c.duration=u.duration,c.backtracked=u.backtracked,c.dropped=u.dropped,l=c))}if(s)for(gt.b.log('discontinuity sliding from playlist, take drift into account'),p=0;p<d.length;p++)d[p].cc+=s;if(l)M(t,l,l.startPTS,l.endPTS,l.startDTS,l.endDTS);else if(0<=n&&n<o.length){var g=o[n].start;for(p=0;p<d.length;p++)d[p].start+=g}t.PTSKnown=e.PTSKnown}function B(e,t){for(var a=null,r=0,n;r<e.length;r+=1)if(n=e[r],n&&n.cc===t){a=n;break}return a}function G(e,t){return Qt.search(e,function(e){return e.cc<t?1:e.cc>t?-1:0})}function K(e,t,a){var r=!1;return t&&t.details&&a&&(a.endCC>a.startCC||e&&e.cc<a.startCC)&&(r=!0),r}function H(e,t){var a=e.fragments,r=t.fragments;if(!r.length||!a.length)return void gt.b.log('No fragments to align');var n=B(a,r[0].cc);return n&&(!n||n.startPTS)?n:void gt.b.log('No frag in previous level to align on')}function V(e,t){t.fragments.forEach(function(t){if(t){var a=t.start+e;t.start=t.startPTS=a,t.endPTS=a+t.duration}}),t.PTSKnown=!0}function W(e,t,a){Y(e,a,t),!a.PTSKnown&&t&&q(a,t.details)}function Y(e,t,a){if(K(e,a,t)){var r=H(a.details,t);r&&(gt.b.log('Adjusting PTS using last level due to CC increase within current level'),V(r.start,t))}}function q(e,t){if(t&&t.fragments.length){if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;var a=t.fragments[0].programDateTime,r=e.fragments[0].programDateTime,n=(r-a)/1e3+t.fragments[0].start;Object(ut.a)(n)&&(gt.b.log('adjusting PTS using programDateTime delta, sliding:'+n.toFixed(3)),V(n,e))}}function j(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function z(e,t){if(!e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return t&&('object'===('undefined'==typeof t?'undefined':N(t))||'function'==typeof t)?t:e}function X(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+('undefined'==typeof t?'undefined':N(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function Q(e,t,a){if(!Array.isArray(e)||!e.length||!Object(ut.a)(t))return null;if(t<e[0].programDateTime)return null;if(t>=e[e.length-1].endProgramDateTime)return null;a=a||0;for(var r=0,n;r<e.length;++r)if(n=e[r],$(t,a,n))return n;return null}function Z(e,t){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0,r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:0,n=e?t[e.sn-t[0].sn+1]:null;return n&&!J(a,r,n)?n:Qt.search(t,J.bind(null,a,r))}function J(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,a=arguments[2],r=A(t,a.duration+(a.deltaPTS?a.deltaPTS:0));if(a.start+a.duration-r<=e)return 1;return a.start-r>e&&a.start?-1:0}function $(e,t,a){var r=1e3*A(t,a.duration+(a.deltaPTS?a.deltaPTS:0));return a.endProgramDateTime-r>e}function ee(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function te(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function ae(e,t){if(!e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return t&&('object'===('undefined'==typeof t?'undefined':N(t))||'function'==typeof t)?t:e}function re(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+('undefined'==typeof t?'undefined':N(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function ne(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function oe(e,t){if(!e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return t&&('object'===('undefined'==typeof t?'undefined':N(t))||'function'==typeof t)?t:e}function ie(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+('undefined'==typeof t?'undefined':N(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function de(e,t){var a=null;try{a=new window.Event('addtrack')}catch(e){a=document.createEvent('Event'),a.initEvent('addtrack',!1,!1)}a.track=e,t.dispatchEvent(a)}function se(e){if(e&&e.cues)for(;0<e.cues.length;)e.removeCue(e.cues[0])}function le(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function pe(e,t){if(!e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return t&&('object'===('undefined'==typeof t?'undefined':N(t))||'function'==typeof t)?t:e}function ue(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+('undefined'==typeof t?'undefined':N(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function ce(){var e=O(),t=window.SourceBuffer||window.WebKitSourceBuffer,a=e&&'function'==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),r=!t||t.prototype&&'function'==typeof t.prototype.appendBuffer&&'function'==typeof t.prototype.remove;return!!a&&!!r}function ge(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function fe(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function ye(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function me(e,t){if(!e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return t&&('object'===('undefined'==typeof t?'undefined':N(t))||'function'==typeof t)?t:e}function he(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+('undefined'==typeof t?'undefined':N(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function ve(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function Ee(e,t){if(!e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return t&&('object'===('undefined'==typeof t?'undefined':N(t))||'function'==typeof t)?t:e}function be(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+('undefined'==typeof t?'undefined':N(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function Te(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function Se(e,t){if(!e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return t&&('object'===('undefined'==typeof t?'undefined':N(t))||'function'==typeof t)?t:e}function _e(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+('undefined'==typeof t?'undefined':N(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function Re(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function Ae(e,t){if(!e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return t&&('object'===('undefined'==typeof t?'undefined':N(t))||'function'==typeof t)?t:e}function ke(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+('undefined'==typeof t?'undefined':N(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function Le(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function De(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function Pe(e,t){if(!e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return t&&('object'===('undefined'==typeof t?'undefined':N(t))||'function'==typeof t)?t:e}function Ce(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+('undefined'==typeof t?'undefined':N(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function Ie(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function Oe(e,t){if(!e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return t&&('object'===('undefined'==typeof t?'undefined':N(t))||'function'==typeof t)?t:e}function Fe(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+('undefined'==typeof t?'undefined':N(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function xe(){this.window=window,this.state='INITIAL',this.buffer='',this.decoder=new za,this.regionList=[]}function Ne(e){function t(e,t,a,r){return 3600*(0|e)+60*(0|t)+(0|a)+(0|r)/1e3}var a=e.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return a?a[3]?t(a[1],a[2],a[3].replace(':',''),a[4]):59<a[1]?t(a[1],a[2],0,a[4]):t(0,a[1],a[2],a[4]):null}function we(){this.values=Object.create(null)}function Me(e,t,a,r){var n=r?e.split(r):[e];for(var o in n)if('string'==typeof n[o]){var i=n[o].split(a);if(2===i.length){var d=i[0],s=i[1];t(d,s)}}}function Ue(e,t,a){function r(){var t=Ne(e);if(null===t)throw new Error('Malformed timestamp: '+i);return e=e.replace(/^[^\sa-zA-Z-]+/,''),t}function n(e,t){var r=new we;Me(e,function(e,t){switch(e){case'region':for(var n=a.length-1;0<=n;n--)if(a[n].id===t){r.set(e,a[n].region);break}break;case'vertical':r.alt(e,t,['rl','lr']);break;case'line':var o=t.split(','),d=o[0];r.integer(e,d),r.percent(e,d)&&r.set('snapToLines',!1),r.alt(e,d,['auto']),2===o.length&&r.alt('lineAlign',o[1],['start',Qa,'end']);break;case'position':o=t.split(','),r.percent(e,o[0]),2===o.length&&r.alt('positionAlign',o[1],['start',Qa,'end','line-left','line-right','auto']);break;case'size':r.percent(e,t);break;case'align':r.alt(e,t,['start',Qa,'end','left','right']);}},/:/,/\s/),t.region=r.get('region',null),t.vertical=r.get('vertical','');var n=r.get('line','auto');'auto'===n&&-1===Xa.line&&(n=-1),t.line=n,t.lineAlign=r.get('lineAlign','start'),t.snapToLines=r.get('snapToLines',!0),t.size=r.get('size',100),t.align=r.get('align',Qa);var o=r.get('position','auto');'auto'===o&&50===Xa.position&&(o='start'===t.align||'left'===t.align?0:'end'===t.align||'right'===t.align?100:50),t.position=o}function o(){e=e.replace(/^\s+/,'')}var i=e;if(o(),t.startTime=r(),o(),'-->'!==e.substr(0,3))throw new Error('Malformed time stamp (time stamps must be separated by \'-->\'): '+i);e=e.substr(3),o(),t.endTime=r(),o(),n(e,t)}function Be(e){return e.replace(/<br(?: \/)?>/gi,'\n')}function Ge(e,t,a,n){for(var o=void 0,i=void 0,d=void 0,s=void 0,l=void 0,p=window.VTTCue||window.TextTrackCue,u=0;u<n.rows.length;u++)if(o=n.rows[u],d=!0,s=0,l='',!o.isEmpty()){for(var g=0;g<o.chars.length;g++)o.chars[g].uchar.match(/\s/)&&d?s++:(l+=o.chars[g].uchar,d=!1);o.cueStartTime=t,t===a&&(a+=1e-4),i=new p(t,a,Be(l.trim())),16<=s?s--:s++,i.line=navigator.userAgent.match(/Firefox\//)?u+1:7<u?u-2:u+1,i.align='left',i.position=R(0,A(100,100*(s/32)+(navigator.userAgent.match(/Firefox\//)?50:0))),e.addCue(i)}}function Ke(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function He(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function Ve(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function We(e,t){if(!e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return t&&('object'===('undefined'==typeof t?'undefined':N(t))||'function'==typeof t)?t:e}function Ye(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+('undefined'==typeof t?'undefined':N(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function qe(e,t){return e&&e.label===t.name&&!(e.textTrack1||e.textTrack2)}function je(e,t,a,r){return A(t,r)-R(e,a)}function ze(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function Xe(e,t){if(!e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return t&&('object'===('undefined'==typeof t?'undefined':N(t))||'function'==typeof t)?t:e}function Qe(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+('undefined'==typeof t?'undefined':N(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function Ze(e){for(var t=[],a=0;a<e.length;a++)'subtitles'===e[a].kind&&t.push(e[a]);return t}function Je(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function $e(e,t){if(!e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return t&&('object'===('undefined'==typeof t?'undefined':N(t))||'function'==typeof t)?t:e}function et(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+('undefined'==typeof t?'undefined':N(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function tt(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function at(e,t){if(!e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return t&&('object'===('undefined'==typeof t?'undefined':N(t))||'function'==typeof t)?t:e}function rt(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+('undefined'==typeof t?'undefined':N(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function nt(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}var ot=Math.pow,it=Number.POSITIVE_INFINITY;Object.defineProperty(a,'__esModule',{value:!0});var dt={};r.d(dt,'newCue',function(){return Ge});var st=r(5),lt=r.n(st),pt=r(2),ut=r(3),ct=r(1),gt=r(0),ft='function'==typeof Symbol&&'symbol'===N(Symbol.iterator)?function(e){return'undefined'==typeof e?'undefined':N(e)}:function(e){return e&&'function'==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?'symbol':'undefined'==typeof e?'undefined':N(e)},yt=new Set(['hlsEventGeneric','hlsHandlerDestroying','hlsHandlerDestroyed']),mt=function(){function e(t){n(this,e),this.hls=t,this.onEvent=this.onEvent.bind(this);for(var a=arguments.length,r=Array(1<a?a-1:0),o=1;o<a;o++)r[o-1]=arguments[o];this.handledEvents=r,this.useGenericHandler=!0,this.registerListeners()}return e.prototype.destroy=function(){this.onHandlerDestroying(),this.unregisterListeners(),this.onHandlerDestroyed()},e.prototype.onHandlerDestroying=function(){},e.prototype.onHandlerDestroyed=function(){},e.prototype.isEventHandler=function(){return'object'===ft(this.handledEvents)&&this.handledEvents.length&&'function'==typeof this.onEvent},e.prototype.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){if(yt.has(e))throw new Error('Forbidden event-name: '+e);this.hls.on(e,this.onEvent)},this)},e.prototype.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){this.hls.off(e,this.onEvent)},this)},e.prototype.onEvent=function(e,t){this.onEventGeneric(e,t)},e.prototype.onEventGeneric=function(e,t){var a=function(e,t){var a='on'+e.replace('hls','');if('function'!=typeof this[a])throw new Error('Event '+e+' has no generic handler in this '+this.constructor.name+' class (tried '+a+')');return this[a].bind(this,t)};try{a.call(this,e,t).call()}catch(t){gt.b.error('An internal error happened while handling event '+e+'. Error message: "'+t.message+'". Here is a stacktrace:',t),this.hls.trigger(ct.a.ERROR,{type:pt.b.OTHER_ERROR,details:pt.a.INTERNAL_EXCEPTION,fatal:!1,event:e,err:t})}},e}(),ht=mt,vt=r(9),Et=function(){function e(e,t){for(var a=0,r;a<t.length;a++)r=t[a],r.enumerable=r.enumerable||!1,r.configurable=!0,'value'in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),bt=function(){function e(){o(this,e),this.method=null,this.key=null,this.iv=null,this._uri=null}return Et(e,[{key:'uri',get:function(){return!this._uri&&this.reluri&&(this._uri=lt.a.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),e}(),Tt=bt,St=function(){function e(e,t){for(var a=0,r;a<t.length;a++)r=t[a],r.enumerable=r.enumerable||!1,r.configurable=!0,'value'in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),_t=function(){function e(){var t;i(this,e),this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[],this.programDateTime=null,this.rawProgramDateTime=null,this._elementaryStreams=(t={},t[e.ElementaryStreamTypes.AUDIO]=!1,t[e.ElementaryStreamTypes.VIDEO]=!1,t)}return e.prototype.addElementaryStream=function(e){this._elementaryStreams[e]=!0},e.prototype.hasElementaryStream=function(e){return!0===this._elementaryStreams[e]},e.prototype.createInitializationVector=function(e){for(var t=new Uint8Array(16),a=12;16>a;a++)t[a]=255&e>>8*(15-a);return t},e.prototype.fragmentDecryptdataFromLevelkey=function(e,t){var a=e;return e&&e.method&&e.uri&&!e.iv&&(a=new Tt,a.method=e.method,a.baseuri=e.baseuri,a.reluri=e.reluri,a.iv=this.createInitializationVector(t)),a},St(e,[{key:'url',get:function(){return!this._url&&this.relurl&&(this._url=lt.a.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(e){this._url=e}},{key:'byteRange',get:function(){if(!this._byteRange&&!this.rawByteRange)return[];if(this._byteRange)return this._byteRange;var e=[];if(this.rawByteRange){var t=this.rawByteRange.split('@',2);if(1===t.length){var a=this.lastByteRangeEndOffset;e[0]=a||0}else e[0]=parseInt(t[1]);e[1]=parseInt(t[0])+e[0],this._byteRange=e}return e}},{key:'byteRangeStartOffset',get:function(){return this.byteRange[0]}},{key:'byteRangeEndOffset',get:function(){return this.byteRange[1]}},{key:'decryptdata',get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}},{key:'endProgramDateTime',get:function(){if(!Object(ut.a)(this.programDateTime))return null;var e=Object(ut.a)(this.duration)?this.duration:0;return this.programDateTime+1e3*e}},{key:'encrypted',get:function(){return!!(this.decryptdata&&null!==this.decryptdata.uri&&null===this.decryptdata.key)}}],[{key:'ElementaryStreamTypes',get:function(){return{AUDIO:'audio',VIDEO:'video'}}}]),e}(),Rt=_t,At=function(){function e(e,t){for(var a=0,r;a<t.length;a++)r=t[a],r.enumerable=r.enumerable||!1,r.configurable=!0,'value'in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),kt=function(){function e(t){d(this,e),this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=t,this.version=null}return At(e,[{key:'hasProgramDateTime',get:function(){return!!(this.fragments[0]&&Object(ut.a)(this.fragments[0].programDateTime))}}]),e}(),Lt=/^(\d+)x(\d+)$/,Dt=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,Pt=function(){function e(t){for(var a in s(this,e),'string'==typeof t&&(t=e.parseAttrList(t)),t)t.hasOwnProperty(a)&&(this[a]=t[a])}var t=Number.MAX_SAFE_INTEGER;return e.prototype.decimalInteger=function(e){var a=parseInt(this[e],10);return a>t?1/0:a},e.prototype.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||'0x').slice(2);t=(1&t.length?'0':'')+t;for(var a=new Uint8Array(t.length/2),r=0;r<t.length/2;r++)a[r]=parseInt(t.slice(2*r,2*r+2),16);return a}return null},e.prototype.hexadecimalIntegerAsNumber=function(e){var a=parseInt(this[e],16);return a>t?1/0:a},e.prototype.decimalFloatingPoint=function(e){return parseFloat(this[e])},e.prototype.enumeratedString=function(e){return this[e]},e.prototype.decimalResolution=function(e){var t=Lt.exec(this[e]);return null===t?void 0:{width:parseInt(t[1],10),height:parseInt(t[2],10)}},e.parseAttrList=function(e){var t={},a;for(Dt.lastIndex=0;null!==(a=Dt.exec(e));){var r=a[2];0===r.indexOf('"')&&r.lastIndexOf('"')===r.length-1&&(r=r.slice(1,-1)),t[a[1]]=r}return t},e}(),Ct=Pt,It={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}},Ot=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,Ft=/#EXT-X-MEDIA:(.*)/g,xt=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)(\S+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(''),'g'),Nt=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,wt=/\.(mp4|m4s|m4v|m4a)$/i,Mt=function(){function e(){u(this,e)}return e.findGroup=function(e,t){if(!e)return null;for(var a=null,r=0,n;r<e.length;r++)n=e[r],n.id===t&&(a=n);return a},e.convertAVC1ToAVCOTI=function(e){var t=e.split('.'),a;return 2<t.length?(a=t.shift()+'.',a+=parseInt(t.shift()).toString(16),a+=('000'+parseInt(t.shift()).toString(16)).substr(-4)):a=e,a},e.resolve=function(e,t){return lt.a.buildAbsoluteURL(t,e,{alwaysNormalize:!0})},e.parseMasterPlaylist=function(t,a){function r(e,t){['video','audio'].forEach(function(a){var r=e.filter(function(e){return l(e,a)});if(r.length){var n=r.filter(function(e){return 0===e.lastIndexOf('avc1',0)||0===e.lastIndexOf('mp4a',0)});t[a+'Codec']=0<n.length?n[0]:r[0],e=e.filter(function(e){return-1===r.indexOf(e)})}}),t.unknownCodecs=e}var n=[],o;for(Ot.lastIndex=0;null!=(o=Ot.exec(t));){var i={},d=i.attrs=new Ct(o[1]);i.url=e.resolve(o[2],a);var s=d.decimalResolution('RESOLUTION');s&&(i.width=s.width,i.height=s.height),i.bitrate=d.decimalInteger('AVERAGE-BANDWIDTH')||d.decimalInteger('BANDWIDTH'),i.name=d.NAME,r([].concat((d.CODECS||'').split(/[ ,]+/)),i),i.videoCodec&&-1!==i.videoCodec.indexOf('avc1')&&(i.videoCodec=e.convertAVC1ToAVCOTI(i.videoCodec)),n.push(i)}return n},e.parseMasterPlaylistMedia=function(t,a,r){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[],o=void 0,i=[],d=0;for(Ft.lastIndex=0;null!==(o=Ft.exec(t));){var s={},l=new Ct(o[1]);if(l.TYPE===r){if(s.groupId=l['GROUP-ID'],s.name=l.NAME,s.type=r,s.default='YES'===l.DEFAULT,s.autoselect='YES'===l.AUTOSELECT,s.forced='YES'===l.FORCED,l.URI&&(s.url=e.resolve(l.URI,a)),s.lang=l.LANGUAGE,s.name||(s.name=s.lang),n.length){var p=e.findGroup(n,s.groupId);s.audioCodec=p?p.codec:n[0].codec}s.id=d++,i.push(s)}}return i},e.parseLevelPlaylist=function(e,t,a,r,n){var o=0,d=0,s=new kt(t),l=new Tt,p=0,u=null,f=new Rt,y=void 0,m=void 0,h=null;for(xt.lastIndex=0;null!==(y=xt.exec(e));){var v=y[1];if(v){f.duration=parseFloat(v);var E=(' '+y[2]).slice(1);f.title=E||null,f.tagList.push(E?['INF',v,E]:['INF',v])}else if(y[3]){if(Object(ut.a)(f.duration)){var b=o++;f.type=r,f.start=d,f.levelkey=l,f.sn=b,f.level=a,f.cc=p,f.urlId=n,f.baseurl=t,f.relurl=(' '+y[3]).slice(1),g(f,u),s.fragments.push(f),u=f,d+=f.duration,f=new Rt}}else if(y[4]){if(f.rawByteRange=(' '+y[4]).slice(1),u){var T=u.byteRangeEndOffset;T&&(f.lastByteRangeEndOffset=T)}}else if(y[5])f.rawProgramDateTime=(' '+y[5]).slice(1),f.tagList.push(['PROGRAM-DATE-TIME',f.rawProgramDateTime]),null===h&&(h=s.fragments.length);else{for(y=y[0].match(Nt),m=1;m<y.length&&void 0===y[m];m++);var S=(' '+y[m+1]).slice(1),_=(' '+y[m+2]).slice(1);switch(y[m]){case'#':f.tagList.push(_?[S,_]:[S]);break;case'PLAYLIST-TYPE':s.type=S.toUpperCase();break;case'MEDIA-SEQUENCE':o=s.startSN=parseInt(S);break;case'TARGETDURATION':s.targetduration=parseFloat(S);break;case'VERSION':s.version=parseInt(S);break;case'EXTM3U':break;case'ENDLIST':s.live=!1;break;case'DIS':p++,f.tagList.push(['DIS']);break;case'DISCONTINUITY-SEQ':p=parseInt(S);break;case'KEY':var R=new Ct(S),A=R.enumeratedString('METHOD'),k=R.URI,L=R.hexadecimalInteger('IV');A&&(l=new Tt,k&&0<=['AES-128','SAMPLE-AES','SAMPLE-AES-CENC'].indexOf(A)&&(l.method=A,l.baseuri=t,l.reluri=k,l.key=null,l.iv=L));break;case'START':var D=new Ct(S),P=D.decimalFloatingPoint('TIME-OFFSET');Object(ut.a)(P)&&(s.startTimeOffset=P);break;case'MAP':var C=new Ct(S);f.relurl=C.URI,f.rawByteRange=C.BYTERANGE,f.baseurl=t,f.level=a,f.type=r,f.sn='initSegment',s.initSegment=f,f=new Rt,f.rawProgramDateTime=s.initSegment.rawProgramDateTime;break;default:gt.b.warn('line parsed but not handled: '+y);}}}return f=u,f&&!f.relurl&&(s.fragments.pop(),d-=f.duration),s.totalduration=d,s.averagetargetduration=d/s.fragments.length,s.endSN=o-1,s.startCC=s.fragments[0]?s.fragments[0].cc:0,s.endCC=p,!s.initSegment&&s.fragments.length&&s.fragments.every(function(e){return wt.test(e.relurl)})&&(gt.b.warn('MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX'),f=new Rt,f.relurl=s.fragments[0].relurl,f.baseurl=t,f.level=a,f.type=r,f.sn='initSegment',s.initSegment=f,s.needSidxRanges=!0),h&&c(s.fragments,h),s},e}(),Ut=Mt,Bt=function(){function e(e,t){for(var a=0,r;a<t.length;a++)r=t[a],r.enumerable=r.enumerable||!1,r.configurable=!0,'value'in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),Gt=window,Kt=Gt.performance,Ht={MANIFEST:'manifest',LEVEL:'level',AUDIO_TRACK:'audioTrack',SUBTITLE_TRACK:'subtitleTrack'},Vt={MAIN:'main',AUDIO:'audio',SUBTITLE:'subtitle'},Wt=function(e){function t(a){f(this,t);var r=y(this,e.call(this,a,ct.a.MANIFEST_LOADING,ct.a.LEVEL_LOADING,ct.a.AUDIO_TRACK_LOADING,ct.a.SUBTITLE_TRACK_LOADING));return r.loaders={},r}return m(t,e),t.canHaveQualityLevels=function(e){return e!==Ht.AUDIO_TRACK&&e!==Ht.SUBTITLE_TRACK},t.mapContextToLevelType=function(e){var t=e.type;return t===Ht.AUDIO_TRACK?Vt.AUDIO:t===Ht.SUBTITLE_TRACK?Vt.SUBTITLE:Vt.MAIN},t.getResponseUrl=function(e,t){var a=e.url;return(void 0===a||0===a.indexOf('data:'))&&(a=t.url),a},t.prototype.createInternalLoader=function(e){var t=this.hls.config,a=t.pLoader,r=t.loader,n=new(a||r)(t);return e.loader=n,this.loaders[e.type]=n,n},t.prototype.getInternalLoader=function(e){return this.loaders[e.type]},t.prototype.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},t.prototype.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},t.prototype.destroy=function(){this.destroyInternalLoaders(),e.prototype.destroy.call(this)},t.prototype.onManifestLoading=function(e){this.load(e.url,{type:Ht.MANIFEST,level:0,id:null})},t.prototype.onLevelLoading=function(e){this.load(e.url,{type:Ht.LEVEL,level:e.level,id:e.id})},t.prototype.onAudioTrackLoading=function(e){this.load(e.url,{type:Ht.AUDIO_TRACK,level:null,id:e.id})},t.prototype.onSubtitleTrackLoading=function(e){this.load(e.url,{type:Ht.SUBTITLE_TRACK,level:null,id:e.id})},t.prototype.load=function(e,t){var a=this.hls.config;gt.b.debug('Loading playlist of type '+t.type+', level: '+t.level+', id: '+t.id);var r=this.getInternalLoader(t);if(r){var n=r.context;if(n&&n.url===e)return gt.b.trace('playlist request ongoing'),!1;gt.b.warn('aborting previous loader for type: '+t.type),r.abort()}var o,i,d,s;switch(t.type){case Ht.MANIFEST:o=a.manifestLoadingMaxRetry,i=a.manifestLoadingTimeOut,d=a.manifestLoadingRetryDelay,s=a.manifestLoadingMaxRetryTimeout;break;case Ht.LEVEL:o=0,i=a.levelLoadingTimeOut;break;default:o=a.levelLoadingMaxRetry,i=a.levelLoadingTimeOut,d=a.levelLoadingRetryDelay,s=a.levelLoadingMaxRetryTimeout;}r=this.createInternalLoader(t),t.url=e,t.responseType=t.responseType||'';var l={timeout:i,maxRetry:o,retryDelay:d,maxRetryDelay:s},p={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};return gt.b.debug('Calling internal loader delegate for URL: '+e),r.load(t,l,p),!0},t.prototype.loadsuccess=function(e,t,a){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;if(a.isSidxRequest)return this._handleSidxRequest(e,a),void this._handlePlaylistLoaded(e,t,a,r);this.resetInternalLoader(a.type);var n=e.data;return t.tload=Kt.now(),0===n.indexOf('#EXTM3U')?void(0<n.indexOf('#EXTINF:')||0<n.indexOf('#EXT-X-TARGETDURATION:')?this._handleTrackOrLevelPlaylist(e,t,a,r):this._handleMasterPlaylist(e,t,a,r)):void this._handleManifestParsingError(e,a,'no EXTM3U delimiter',r)},t.prototype.loaderror=function(e,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;this._handleNetworkError(t,a)},t.prototype.loadtimeout=function(e,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;this._handleNetworkError(t,a,!0)},t.prototype._handleMasterPlaylist=function(e,a,r,n){var o=this.hls,i=e.data,d=t.getResponseUrl(e,r),s=Ut.parseMasterPlaylist(i,d);if(!s.length)return void this._handleManifestParsingError(e,r,'no level found in manifest',n);var l=s.map(function(e){return{id:e.attrs.AUDIO,codec:e.audioCodec}}),p=Ut.parseMasterPlaylistMedia(i,d,'AUDIO',l),u=Ut.parseMasterPlaylistMedia(i,d,'SUBTITLES');if(p.length){var c=!1;p.forEach(function(e){e.url||(c=!0)}),!1==c&&s[0].audioCodec&&!s[0].attrs.AUDIO&&(gt.b.log('audio codec signaled in quality level, but no embedded audio track signaled, create one'),p.unshift({type:'main',name:'main'}))}o.trigger(ct.a.MANIFEST_LOADED,{levels:s,audioTracks:p,subtitles:u,url:d,stats:a,networkDetails:n})},t.prototype._handleTrackOrLevelPlaylist=function(e,a,r,n){var o=this.hls,i=r.id,d=r.level,s=r.type,l=t.getResponseUrl(e,r),p=Object(ut.a)(i)?i:0,u=Object(ut.a)(d)?d:p,c=t.mapContextToLevelType(r),g=Ut.parseLevelPlaylist(e.data,l,u,c,p);if(g.tload=a.tload,s===Ht.MANIFEST){o.trigger(ct.a.MANIFEST_LOADED,{levels:[{url:l,details:g}],audioTracks:[],url:l,stats:a,networkDetails:n})}if(a.tparsed=Kt.now(),g.needSidxRanges){var f=g.initSegment.url;return void this.load(f,{isSidxRequest:!0,type:s,level:d,levelDetails:g,id:i,rangeStart:0,rangeEnd:2048,responseType:'arraybuffer'})}r.levelDetails=g,this._handlePlaylistLoaded(e,a,r,n)},t.prototype._handleSidxRequest=function(e,t){var a=vt.a.parseSegmentIndex(new Uint8Array(e.data));a.references.forEach(function(e,a){var r=e.info,n=t.levelDetails.fragments[a];0===n.byteRange.length&&(n.rawByteRange=1+r.end-r.start+'@'+(r.start+''))}),t.levelDetails.initSegment.rawByteRange=a.moovEndOffset+'@0'},t.prototype._handleManifestParsingError=function(e,t,a,r){this.hls.trigger(ct.a.ERROR,{type:pt.b.NETWORK_ERROR,details:pt.a.MANIFEST_PARSING_ERROR,fatal:!0,url:e.url,reason:a,networkDetails:r})},t.prototype._handleNetworkError=function(e,t){var a=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2];gt.b.info('A network error occured while loading a '+e.type+'-type playlist');var r=void 0,n=void 0,o=this.getInternalLoader(e);switch(e.type){case Ht.MANIFEST:r=a?pt.a.MANIFEST_LOAD_TIMEOUT:pt.a.MANIFEST_LOAD_ERROR,n=!0;break;case Ht.LEVEL:r=a?pt.a.LEVEL_LOAD_TIMEOUT:pt.a.LEVEL_LOAD_ERROR,n=!1;break;case Ht.AUDIO_TRACK:r=a?pt.a.AUDIO_TRACK_LOAD_TIMEOUT:pt.a.AUDIO_TRACK_LOAD_ERROR,n=!1;break;default:n=!1;}o&&(o.abort(),this.resetInternalLoader(e.type)),this.hls.trigger(ct.a.ERROR,{type:pt.b.NETWORK_ERROR,details:r,fatal:n,url:o.url,loader:o,context:e,networkDetails:t})},t.prototype._handlePlaylistLoaded=function(e,a,r,n){var o=r.type,i=r.level,d=r.id,s=r.levelDetails;if(!s.targetduration)return void this._handleManifestParsingError(e,r,'invalid target duration',n);var l=t.canHaveQualityLevels(r.type);l?this.hls.trigger(ct.a.LEVEL_LOADED,{details:s,level:i||0,id:d||0,stats:a,networkDetails:n}):o===Ht.AUDIO_TRACK?this.hls.trigger(ct.a.AUDIO_TRACK_LOADED,{details:s,id:d,stats:a,networkDetails:n}):o===Ht.SUBTITLE_TRACK?this.hls.trigger(ct.a.SUBTITLE_TRACK_LOADED,{details:s,id:d,stats:a,networkDetails:n}):void 0},Bt(t,null,[{key:'ContextType',get:function(){return Ht}},{key:'LevelType',get:function(){return Vt}}]),t}(ht),Yt=Wt,qt=function(e){function t(a){h(this,t);var r=v(this,e.call(this,a,ct.a.FRAG_LOADING));return r.loaders={},r}return E(t,e),t.prototype.destroy=function(){var t=this.loaders;for(var a in t){var r=t[a];r&&r.destroy()}this.loaders={},e.prototype.destroy.call(this)},t.prototype.onFragLoading=function(e){var t=e.frag,a=t.type,r=this.loaders,n=this.hls.config,o=n.fLoader,i=n.loader;t.loaded=0;var d=r[a];d&&(gt.b.warn('abort previous fragment loader for type: '+a),d.abort()),d=r[a]=t.loader=n.fLoader?new o(n):new i(n);var s,l,p;s={url:t.url,frag:t,responseType:'arraybuffer',progressData:!1};var u=t.byteRangeStartOffset,c=t.byteRangeEndOffset;Object(ut.a)(u)&&Object(ut.a)(c)&&(s.rangeStart=u,s.rangeEnd=c),l={timeout:n.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:n.fragLoadingMaxRetryTimeout},p={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},d.load(s,l,p)},t.prototype.loadsuccess=function(e,t,a){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,n=e.data,o=a.frag;o.loader=void 0,this.loaders[o.type]=void 0,this.hls.trigger(ct.a.FRAG_LOADED,{payload:n,frag:o,stats:t,networkDetails:r})},t.prototype.loaderror=function(e,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,r=t.frag,n=r.loader;n&&n.abort(),this.loaders[r.type]=void 0,this.hls.trigger(ct.a.ERROR,{type:pt.b.NETWORK_ERROR,details:pt.a.FRAG_LOAD_ERROR,fatal:!1,frag:t.frag,response:e,networkDetails:a})},t.prototype.loadtimeout=function(e,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,r=t.frag,n=r.loader;n&&n.abort(),this.loaders[r.type]=void 0,this.hls.trigger(ct.a.ERROR,{type:pt.b.NETWORK_ERROR,details:pt.a.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t.frag,networkDetails:a})},t.prototype.loadprogress=function(e,t){var a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,r=t.frag;r.loaded=e.loaded,this.hls.trigger(ct.a.FRAG_LOAD_PROGRESS,{frag:r,stats:e,networkDetails:a})},t}(ht),jt=function(e){function t(a){b(this,t);var r=T(this,e.call(this,a,ct.a.KEY_LOADING));return r.loaders={},r.decryptkey=null,r.decrypturl=null,r}return S(t,e),t.prototype.destroy=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={},ht.prototype.destroy.call(this)},t.prototype.onKeyLoading=function(e){var t=e.frag,a=t.type,r=this.loaders[a],n=t.decryptdata,o=n.uri;if(o!==this.decrypturl||null===this.decryptkey){var i=this.hls.config;r&&(gt.b.warn('abort previous key loader for type:'+a),r.abort()),t.loader=this.loaders[a]=new i.loader(i),this.decrypturl=o,this.decryptkey=null;var d,s,l;d={url:o,frag:t,responseType:'arraybuffer'},s={timeout:i.fragLoadingTimeOut,maxRetry:i.fragLoadingMaxRetry,retryDelay:i.fragLoadingRetryDelay,maxRetryDelay:i.fragLoadingMaxRetryTimeout},l={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},t.loader.load(d,s,l)}else this.decryptkey&&(n.key=this.decryptkey,this.hls.trigger(ct.a.KEY_LOADED,{frag:t}))},t.prototype.loadsuccess=function(e,t,a){var r=a.frag;this.decryptkey=r.decryptdata.key=new Uint8Array(e.data),r.loader=void 0,this.loaders[r.type]=void 0,this.hls.trigger(ct.a.KEY_LOADED,{frag:r})},t.prototype.loaderror=function(e,t){var a=t.frag,r=a.loader;r&&r.abort(),this.loaders[t.type]=void 0,this.hls.trigger(ct.a.ERROR,{type:pt.b.NETWORK_ERROR,details:pt.a.KEY_LOAD_ERROR,fatal:!1,frag:a,response:e})},t.prototype.loadtimeout=function(e,t){var a=t.frag,r=a.loader;r&&r.abort(),this.loaders[t.type]=void 0,this.hls.trigger(ct.a.ERROR,{type:pt.b.NETWORK_ERROR,details:pt.a.KEY_LOAD_TIMEOUT,fatal:!1,frag:a})},t}(ht),zt={NOT_LOADED:'NOT_LOADED',APPENDING:'APPENDING',PARTIAL:'PARTIAL',OK:'OK'},Xt=function(e){function t(a){_(this,t);var r=P(this,e.call(this,a,ct.a.BUFFER_APPENDED,ct.a.FRAG_BUFFERED,ct.a.FRAG_LOADED));return r.bufferPadding=.2,r.fragments=Object.create(null),r.timeRanges=Object.create(null),r.config=a.config,r}return C(t,e),t.prototype.destroy=function(){this.fragments=null,this.timeRanges=null,this.config=null,ht.prototype.destroy.call(this),e.prototype.destroy.call(this)},t.prototype.getBufferedFrag=function(e,t){var a=this.fragments,r=Object.keys(a).filter(function(r){var n=a[r];if(n.body.type!==t)return!1;if(!n.buffered)return!1;var o=n.body;return o.startPTS<=e&&e<=o.endPTS});if(0===r.length)return null;var n=r.pop();return a[n].body},t.prototype.detectEvictedFragments=function(e,t){var a=this,r=void 0,n=void 0;Object.keys(this.fragments).forEach(function(o){var d=a.fragments[o];if(!0===d.buffered){var s=d.range[e];if(s){r=s.time;for(var l=0;l<r.length;l++)if(n=r[l],!1===a.isTimeBuffered(n.startPTS,n.endPTS,t)){a.removeFragment(d.body);break}}}})},t.prototype.detectPartialFragments=function(e){var t=this,a=this.getFragmentKey(e),r=this.fragments[a];r&&(r.buffered=!0,Object.keys(this.timeRanges).forEach(function(a){if(e.hasElementaryStream(a)){var n=t.timeRanges[a];r.range[a]=t.getBufferedTimes(e.startPTS,e.endPTS,n)}}))},t.prototype.getBufferedTimes=function(e,t,a){for(var r=[],n=void 0,o=void 0,d=!1,s=0;s<a.length;s++)if(n=a.start(s)-this.bufferPadding,o=a.end(s)+this.bufferPadding,e>=n&&t<=o){r.push({startPTS:R(e,a.start(s)),endPTS:A(t,a.end(s))});break}else if(e<o&&t>n)r.push({startPTS:R(e,a.start(s)),endPTS:A(t,a.end(s))}),d=!0;else if(t<=n)break;return{time:r,partial:d}},t.prototype.getFragmentKey=function(e){return e.type+'_'+e.level+'_'+e.urlId+'_'+e.sn},t.prototype.getPartialFragment=function(e){var t=this,a=void 0,r=void 0,n=void 0,o=null,i=0;return Object.keys(this.fragments).forEach(function(d){var s=t.fragments[d];t.isPartial(s)&&(r=s.body.startPTS-t.bufferPadding,n=s.body.endPTS+t.bufferPadding,e>=r&&e<=n&&(a=A(e-r,n-e),i<=a&&(o=s.body,i=a)))}),o},t.prototype.getState=function(e){var t=this.getFragmentKey(e),a=this.fragments[t],r=zt.NOT_LOADED;return void 0!==a&&(a.buffered?!0===this.isPartial(a)?r=zt.PARTIAL:r=zt.OK:r=zt.APPENDING),r},t.prototype.isPartial=function(e){return!0===e.buffered&&(void 0!==e.range.video&&!0===e.range.video.partial||void 0!==e.range.audio&&!0===e.range.audio.partial)},t.prototype.isTimeBuffered=function(e,t,a){for(var r=void 0,n=void 0,o=0;o<a.length;o++){if(r=a.start(o)-this.bufferPadding,n=a.end(o)+this.bufferPadding,e>=r&&t<=n)return!0;if(t<=r)return!1}return!1},t.prototype.onFragLoaded=function(t){var e=t.frag;Object(ut.a)(e.sn)&&!e.bitrateTest&&(this.fragments[this.getFragmentKey(e)]={body:e,range:Object.create(null),buffered:!1})},t.prototype.onBufferAppended=function(t){var e=this;this.timeRanges=t.timeRanges,Object.keys(this.timeRanges).forEach(function(t){var a=e.timeRanges[t];e.detectEvictedFragments(t,a)})},t.prototype.onFragBuffered=function(t){this.detectPartialFragments(t.frag)},t.prototype.hasFragment=function(e){var t=this.getFragmentKey(e);return void 0!==this.fragments[t]},t.prototype.removeFragment=function(e){var t=this.getFragmentKey(e);delete this.fragments[t]},t.prototype.removeAllFragments=function(){this.fragments=Object.create(null)},t}(ht),Qt={search:function(e,t){for(var a=0,r=e.length-1,n=null,o=null;a<=r;){n=0|(a+r)/2,o=e[n];var i=t(o);if(0<i)a=n+1;else if(0>i)r=n-1;else return o}return null}},Zt=function(){function e(){I(this,e)}return e.isBuffered=function(e,t){try{if(e)for(var a=e.buffered,r=0;r<a.length;r++)if(t>=a.start(r)&&t<=a.end(r))return!0}catch(e){}return!1},e.bufferInfo=function(e,t,a){try{if(e){var r=e.buffered,n=[],o;for(o=0;o<r.length;o++)n.push({start:r.start(o),end:r.end(o)});return this.bufferedInfo(n,t,a)}}catch(e){}return{len:0,start:t,end:t,nextStart:void 0}},e.bufferedInfo=function(e,t,a){var r=[],n,o,d,s,l;for(e.sort(function(e,t){var a=e.start-t.start;return a?a:t.end-e.end}),l=0;l<e.length;l++){var p=r.length;if(p){var u=r[p-1].end;e[l].start-u<a?e[l].end>u&&(r[p-1].end=e[l].end):r.push(e[l])}else r.push(e[l])}for(l=0,n=0,o=d=t;l<r.length;l++){var c=r[l].start,g=r[l].end;if(t+a>=c&&t<g)o=c,d=g,n=d-t;else if(t+a<c){s=c;break}}return{len:n,start:o,end:d,nextStart:s}},e}(),Jt=r(7),$t=r.n(Jt),ea=r(12),ta=r.n(ea),aa=r(10),ra=r(4),na=Object(ra.a)(),oa=O(),ia=function(){function e(t,a){F(this,e),this.hls=t,this.id=a;var r=this.observer=new $t.a,n=t.config;r.trigger=function(e){for(var t=arguments.length,a=Array(1<t?t-1:0),n=1;n<t;n++)a[n-1]=arguments[n];r.emit.apply(r,[e,e].concat(a))},r.off=function(e){for(var t=arguments.length,a=Array(1<t?t-1:0),n=1;n<t;n++)a[n-1]=arguments[n];r.removeListener.apply(r,[e].concat(a))};var o=function(e,a){a=a||{},a.frag=this.frag,a.id=this.id,t.trigger(e,a)}.bind(this);r.on(ct.a.FRAG_DECRYPTED,o),r.on(ct.a.FRAG_PARSING_INIT_SEGMENT,o),r.on(ct.a.FRAG_PARSING_DATA,o),r.on(ct.a.FRAG_PARSED,o),r.on(ct.a.ERROR,o),r.on(ct.a.FRAG_PARSING_METADATA,o),r.on(ct.a.FRAG_PARSING_USERDATA,o),r.on(ct.a.INIT_PTS_FOUND,o);var i={mp4:oa.isTypeSupported('video/mp4'),mpeg:oa.isTypeSupported('audio/mpeg'),mp3:oa.isTypeSupported('audio/mp4; codecs="mp3"')},d=navigator.vendor;if(n.enableWorker&&'undefined'!=typeof Worker){gt.b.log('demuxing in webworker');var s;try{s=this.w=ta()(13),this.onwmsg=this.onWorkerMessage.bind(this),s.addEventListener('message',this.onwmsg),s.onerror=function(e){t.trigger(ct.a.ERROR,{type:pt.b.OTHER_ERROR,details:pt.a.INTERNAL_EXCEPTION,fatal:!0,event:'demuxerWorker',err:{message:e.message+' ('+e.filename+':'+e.lineno+')'}})},s.postMessage({cmd:'init',typeSupported:i,vendor:d,id:a,config:JSON.stringify(n)})}catch(e){gt.b.error('error while initializing DemuxerWorker, fallback on DemuxerInline'),s&&na.URL.revokeObjectURL(s.objectURL),this.demuxer=new aa.a(r,i,n,d),this.w=void 0}}else this.demuxer=new aa.a(r,i,n,d)}return e.prototype.destroy=function(){var e=this.w;if(e)e.removeEventListener('message',this.onwmsg),e.terminate(),this.w=null;else{var t=this.demuxer;t&&(t.destroy(),this.demuxer=null)}var a=this.observer;a&&(a.removeAllListeners(),this.observer=null)},e.prototype.push=function(e,t,a,r,n,o,i,d){var s=this.w,l=Object(ut.a)(n.startDTS)?n.startDTS:n.start,p=n.decryptdata,u=this.frag,c=!(u&&n.cc===u.cc),g=!(u&&n.level===u.level),f=u&&n.sn===u.sn+1,y=!g&&f;if(c&&gt.b.log(this.id+':discontinuity detected'),g&&gt.b.log(this.id+':switch detected'),this.frag=n,s)s.postMessage({cmd:'demux',data:e,decryptdata:p,initSegment:t,audioCodec:a,videoCodec:r,timeOffset:l,discontinuity:c,trackSwitch:g,contiguous:y,duration:o,accurateTimeOffset:i,defaultInitPTS:d},e instanceof ArrayBuffer?[e]:[]);else{var m=this.demuxer;m&&m.push(e,p,t,a,r,l,c,g,y,o,i,d)}},e.prototype.onWorkerMessage=function(e){var t=e.data,a=this.hls;switch(t.event){case'init':na.URL.revokeObjectURL(this.w.objectURL);break;case ct.a.FRAG_PARSING_DATA:t.data.data1=new Uint8Array(t.data1),t.data2&&(t.data.data2=new Uint8Array(t.data2));default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,a.trigger(t.event,t.data);}},e}(),da=ia,sa={toString:function(e){for(var t='',a=e.length,r=0;r<a;r++)t+='['+e.start(r).toFixed(3)+','+e.end(r).toFixed(3)+']';return t}},la=function(e){function t(a){j(this,t);for(var r=arguments.length,n=Array(1<r?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];var i=z(this,e.call.apply(e,[this,a].concat(n)));return i._tickInterval=null,i._tickTimer=null,i._tickCallCount=0,i._boundTick=i.tick.bind(i),i}return X(t,e),t.prototype.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},t.prototype.hasInterval=function(){return!!this._tickInterval},t.prototype.hasNextTick=function(){return!!this._tickTimer},t.prototype.setInterval=function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return!this._tickInterval&&(this._tickInterval=setInterval(this._boundTick,e),!0)}),t.prototype.clearInterval=function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){return!!this._tickInterval&&(clearInterval(this._tickInterval),this._tickInterval=null,!0)}),t.prototype.clearNextTick=function(){return!!this._tickTimer&&(clearTimeout(this._tickTimer),this._tickTimer=null,!0)},t.prototype.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),1<this._tickCallCount&&(this.clearNextTick(),this._tickTimer=setTimeout(this._boundTick,0)),this._tickCallCount=0)},t.prototype.doTick=function(){},t}(ht),pa=la,ua=function(){function e(t,a,r,n){ee(this,e),this.config=t,this.media=a,this.fragmentTracker=r,this.hls=n,this.stallReported=!1}return e.prototype.poll=function(e){var t=this.config,a=this.media,r=a.currentTime,n=window.performance.now();if(r!==e)return this.stallReported&&(gt.b.warn('playback not stuck anymore @'+r+', after '+k(n-this.stalled)+'ms'),this.stallReported=!1),this.stalled=null,void(this.nudgeRetry=0);if(!(a.ended||!a.buffered.length||2<a.readyState)&&!(a.seeking&&Zt.isBuffered(a,r))){var o=n-this.stalled,i=Zt.bufferInfo(a,r,t.maxBufferHole);if(!this.stalled)return void(this.stalled=n);1000<=o&&this._reportStall(i.len),this._tryFixBufferStall(i,o)}},e.prototype._tryFixBufferStall=function(e,t){var a=this.config,r=this.fragmentTracker,n=this.media,o=n.currentTime,i=r.getPartialFragment(o);i&&this._trySkipBufferHole(i),e.len>.5&&t>1e3*a.highBufferWatchdogPeriod&&(this.stalled=null,this._tryNudgeBuffer())},e.prototype._reportStall=function(e){var t=this.hls,a=this.media,r=this.stallReported;r||(this.stallReported=!0,gt.b.warn('Playback stalling at @'+a.currentTime+' due to low buffer'),t.trigger(ct.a.ERROR,{type:pt.b.MEDIA_ERROR,details:pt.a.BUFFER_STALLED_ERROR,fatal:!1,buffer:e}))},e.prototype._trySkipBufferHole=function(e){for(var t=this.hls,a=this.media,r=a.currentTime,n=0,o=0,d;o<a.buffered.length;o++){if(d=a.buffered.start(o),r>=n&&r<d)return a.currentTime=R(d,a.currentTime+.1),gt.b.warn('skipping hole, adjusting currentTime from '+r+' to '+a.currentTime),this.stalled=null,void t.trigger(ct.a.ERROR,{type:pt.b.MEDIA_ERROR,details:pt.a.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:'fragment loaded with buffer holes, seeking from '+r+' to '+a.currentTime,frag:e});n=a.buffered.end(o)}},e.prototype._tryNudgeBuffer=function(){var e=this.config,t=this.hls,a=this.media,r=a.currentTime,n=(this.nudgeRetry||0)+1;if(this.nudgeRetry=n,n<e.nudgeMaxRetry){var o=r+n*e.nudgeOffset;gt.b.log('adjust currentTime from '+r+' to '+o),a.currentTime=o,t.trigger(ct.a.ERROR,{type:pt.b.MEDIA_ERROR,details:pt.a.BUFFER_NUDGE_ON_STALL,fatal:!1})}else gt.b.error('still stuck in high buffer @'+r+' after '+e.nudgeMaxRetry+', raise fatal error'),t.trigger(ct.a.ERROR,{type:pt.b.MEDIA_ERROR,details:pt.a.BUFFER_STALLED_ERROR,fatal:!0})},e}(),ca=function(){function e(e,t){for(var a=0,r;a<t.length;a++)r=t[a],r.enumerable=r.enumerable||!1,r.configurable=!0,'value'in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),ga={STOPPED:'STOPPED',IDLE:'IDLE',KEY_LOADING:'KEY_LOADING',FRAG_LOADING:'FRAG_LOADING',FRAG_LOADING_WAITING_RETRY:'FRAG_LOADING_WAITING_RETRY',WAITING_LEVEL:'WAITING_LEVEL',PARSING:'PARSING',PARSED:'PARSED',BUFFER_FLUSHING:'BUFFER_FLUSHING',ENDED:'ENDED',ERROR:'ERROR'},fa=function(e){function t(a,r){te(this,t);var n=ae(this,e.call(this,a,ct.a.MEDIA_ATTACHED,ct.a.MEDIA_DETACHING,ct.a.MANIFEST_LOADING,ct.a.MANIFEST_PARSED,ct.a.LEVEL_LOADED,ct.a.KEY_LOADED,ct.a.FRAG_LOADED,ct.a.FRAG_LOAD_EMERGENCY_ABORTED,ct.a.FRAG_PARSING_INIT_SEGMENT,ct.a.FRAG_PARSING_DATA,ct.a.FRAG_PARSED,ct.a.ERROR,ct.a.AUDIO_TRACK_SWITCHING,ct.a.AUDIO_TRACK_SWITCHED,ct.a.BUFFER_CREATED,ct.a.BUFFER_APPENDED,ct.a.BUFFER_FLUSHED));return n.fragmentTracker=r,n.config=a.config,n.audioCodecSwap=!1,n._state=ga.STOPPED,n.stallReported=!1,n.gapController=null,n}return re(t,e),t.prototype.onHandlerDestroying=function(){this.stopLoad(),e.prototype.onHandlerDestroying.call(this)},t.prototype.onHandlerDestroyed=function(){this.state=ga.STOPPED,this.fragmentTracker=null,e.prototype.onHandlerDestroyed.call(this)},t.prototype.startLoad=function(e){if(this.levels){var t=this.lastCurrentTime,a=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var r=a.startLevel;-1===r&&(r=0,this.bitrateTest=!0),this.level=a.nextLoadLevel=r,this.loadedmetadata=!1}0<t&&-1===e&&(gt.b.log('override startPosition with lastCurrentTime @'+t.toFixed(3)),e=t),this.state=ga.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this.forceStartLoad=!0,this.state=ga.STOPPED},t.prototype.stopLoad=function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragmentTracker.removeFragment(e),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.clearInterval(),this.state=ga.STOPPED,this.forceStartLoad=!1},t.prototype.doTick=function(){switch(this.state){case ga.BUFFER_FLUSHING:this.fragLoadError=0;break;case ga.IDLE:this._doTickIdle();break;case ga.WAITING_LEVEL:var e=this.levels[this.level];e&&e.details&&(this.state=ga.IDLE);break;case ga.FRAG_LOADING_WAITING_RETRY:var t=window.performance.now(),a=this.retryDate;(!a||t>=a||this.media&&this.media.seeking)&&(gt.b.log('mediaController: retryDate reached, switch back to IDLE state'),this.state=ga.IDLE);break;case ga.ERROR:case ga.STOPPED:case ga.FRAG_LOADING:case ga.PARSING:case ga.PARSED:case ga.ENDED:break;default:}this._checkBuffer(),this._checkFragmentChanged()},t.prototype._doTickIdle=function(){var e=this.hls,t=e.config,a=this.media;if(void 0!==this.levelLastLoaded&&(a||!this.startFragRequested&&t.startFragPrefetch)){var r=this.loadedmetadata?a.currentTime:this.nextLoadPosition;var n=e.nextLoadLevel,o=this.levels[n];if(o){var i=o.bitrate,d;d=i?R(8*t.maxBufferSize/i,t.maxBufferLength):t.maxBufferLength,d=A(d,t.maxMaxBufferLength);var s=Zt.bufferInfo(this.mediaBuffer?this.mediaBuffer:a,r,t.maxBufferHole),l=s.len;if(!(l>=d)){gt.b.trace('buffer length of '+l.toFixed(3)+' is below max of '+d.toFixed(3)+'. checking for more payload ...'),this.level=e.nextLoadLevel=n;var p=o.details;if(!p||p.live&&this.levelLastLoaded!==n)return void(this.state=ga.WAITING_LEVEL);var u=this.fragPrevious;if(!p.live&&u&&!u.backtracked&&u.sn===p.endSN&&!s.nextStart){var c=A(a.duration,u.start+u.duration);if(c-R(s.end,u.start)<=R(.2,u.duration)){var g={};return this.altAudio&&(g.type='video'),this.hls.trigger(ct.a.BUFFER_EOS,g),void(this.state=ga.ENDED)}}this._fetchPayloadOrEos(r,s,p)}}}},t.prototype._fetchPayloadOrEos=function(e,t,a){var r=this.fragPrevious,n=this.level,o=a.fragments,i=o.length;if(0!==i){var d=o[0].start,s=o[i-1].start+o[i-1].duration,l=t.end,p;if(a.initSegment&&!a.initSegment.data)p=a.initSegment;else if(a.live){var u=this.config.initialLiveManifestSize;if(i<u)return void gt.b.warn('Can not start playback of a level, reason: not enough fragments '+i+' < '+u);if(p=this._ensureFragmentAtLivePoint(a,l,d,s,r,o,i),null===p)return}else l<d&&(p=o[0]);p||(p=this._findFragment(d,r,i,o,l,s,a)),p&&(p.encrypted?(gt.b.log('Loading key for '+p.sn+' of ['+a.startSN+' ,'+a.endSN+'],level '+n),this._loadKey(p)):(gt.b.log('Loading '+p.sn+' of ['+a.startSN+' ,'+a.endSN+'],level '+n+', currentTime:'+e.toFixed(3)+',bufferEnd:'+l.toFixed(3)),this._loadFragment(p)))}},t.prototype._ensureFragmentAtLivePoint=function(e,t,a,r,n,o,i){var d=this.hls.config,s=this.media,l=void 0,p=void 0===d.liveMaxLatencyDuration?d.liveMaxLatencyDurationCount*e.targetduration:d.liveMaxLatencyDuration;if(t<R(a-d.maxFragLookUpTolerance,r-p)){var u=this.liveSyncPosition=this.computeLivePosition(a,e);gt.b.log('buffer end: '+t.toFixed(3)+' is located too far from the end of live sliding playlist, reset currentTime to : '+u.toFixed(3)),t=u,s&&s.readyState&&s.duration>u&&(s.currentTime=u),this.nextLoadPosition=u}if(e.PTSKnown&&t>r&&s&&s.readyState)return null;if(this.startFragRequested&&!e.PTSKnown){if(n)if(e.hasProgramDateTime)gt.b.log('live playlist, switching playlist, load frag with same PDT: '+n.programDateTime),l=Q(o,n.endProgramDateTime,d.maxFragLookUpTolerance);else{var c=n.sn+1;if(c>=e.startSN&&c<=e.endSN){var g=o[c-e.startSN];n.cc===g.cc&&(l=g,gt.b.log('live playlist, switching playlist, load frag with next SN: '+l.sn))}l||(l=Qt.search(o,function(e){return n.cc-e.cc}),l&&gt.b.log('live playlist, switching playlist, load frag with same CC: '+l.sn))}l||(l=o[A(i-1,k(i/2))],gt.b.log('live playlist, switching playlist, unknown, load middle frag : '+l.sn))}return l},t.prototype._findFragment=function(e,t,a,r,n,o,i){var d=this.hls.config,s=void 0;if(n<o){var l=n>o-d.maxFragLookUpTolerance?0:d.maxFragLookUpTolerance;s=Z(t,r,n,l)}else s=r[a-1];if(s){var p=s.sn-i.startSN,u=t&&s.level===t.level,c=r[p-1],g=r[p+1];if(t&&s.sn===t.sn)if(!u||s.backtracked)s.backtracked&&(g&&g.backtracked?(gt.b.warn('Already backtracked from fragment '+g.sn+', will not backtrack to fragment '+s.sn+'. Loading fragment '+g.sn),s=g):(gt.b.warn('Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe'),s.dropped=0,c?(s=c,s.backtracked=!0):p&&(s=null)));else if(s.sn<i.endSN){var f=t.deltaPTS;f&&f>d.maxBufferHole&&t.dropped&&p?(s=c,gt.b.warn('SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this')):(s=g,gt.b.log('SN just loaded, load next one: '+s.sn,s))}else s=null}return s},t.prototype._loadKey=function(e){this.state=ga.KEY_LOADING,this.hls.trigger(ct.a.KEY_LOADING,{frag:e})},t.prototype._loadFragment=function(e){var t=this.fragmentTracker.getState(e);this.fragCurrent=e,this.startFragRequested=!0,Object(ut.a)(e.sn)&&!e.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),e.backtracked||t===zt.NOT_LOADED||t===zt.PARTIAL?(e.autoLevel=this.hls.autoLevelEnabled,e.bitrateTest=this.bitrateTest,this.hls.trigger(ct.a.FRAG_LOADING,{frag:e}),!this.demuxer&&(this.demuxer=new da(this.hls,'main')),this.state=ga.FRAG_LOADING):t===zt.APPENDING&&this._reduceMaxBufferLength(e.duration)&&this.fragmentTracker.removeFragment(e)},t.prototype.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,Yt.LevelType.MAIN)},t.prototype.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.endPTS+.5):null},t.prototype._checkFragmentChanged=function(){var e=this.media,t,a;if(e&&e.readyState&&!1===e.seeking&&(a=e.currentTime,a>this.lastCurrentTime&&(this.lastCurrentTime=a),Zt.isBuffered(e,a)?t=this.getBufferedFrag(a):Zt.isBuffered(e,a+.1)&&(t=this.getBufferedFrag(a+.1)),t)){var r=t;if(r!==this.fragPlaying){this.hls.trigger(ct.a.FRAG_CHANGED,{frag:r});var n=r.level;this.fragPlaying&&this.fragPlaying.level===n||this.hls.trigger(ct.a.LEVEL_SWITCHED,{level:n}),this.fragPlaying=r}}},t.prototype.immediateLevelSwitch=function(){if(gt.b.log('immediateLevelSwitch'),!this.immediateSwitch){this.immediateSwitch=!0;var e=this.media,t;e?(t=e.paused,e.pause()):t=!0,this.previouslyPaused=t}var a=this.fragCurrent;a&&a.loader&&a.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},t.prototype.immediateLevelSwitchEnd=function(){var e=this.media;e&&e.buffered.length&&(this.immediateSwitch=!1,Zt.isBuffered(e,e.currentTime)&&(e.currentTime-=1e-4),!this.previouslyPaused&&e.play())},t.prototype.nextLevelSwitch=function(){var e=this.media;if(e&&e.readyState){var t,a,r;if(a=this.getBufferedFrag(e.currentTime),a&&1<a.startPTS&&this.flushMainBuffer(0,a.startPTS-1),!e.paused){var n=this.hls.nextLoadLevel,o=this.levels[n],i=this.fragLastKbps;t=i&&this.fragCurrent?this.fragCurrent.duration*o.bitrate/(1e3*i)+1:0}else t=0;if(r=this.getBufferedFrag(e.currentTime+t),r&&(r=this.followingBufferedFrag(r),r)){var d=this.fragCurrent;d&&d.loader&&d.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(r.maxStartPTS,Number.POSITIVE_INFINITY)}}},t.prototype.flushMainBuffer=function(e,t){this.state=ga.BUFFER_FLUSHING;var a={startOffset:e,endOffset:t};this.altAudio&&(a.type='video'),this.hls.trigger(ct.a.BUFFER_FLUSHING,a)},t.prototype.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener('seeking',this.onvseeking),t.addEventListener('seeked',this.onvseeked),t.addEventListener('ended',this.onvended);var a=this.config;this.levels&&a.autoStartLoad&&this.hls.startLoad(a.startPosition),this.gapController=new ua(a,t,this.fragmentTracker,this.hls)},t.prototype.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(gt.b.log('MSE detaching and video ended, reset startPosition'),this.startPosition=this.lastCurrentTime=0);var t=this.levels;t&&t.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.backtracked=void 0})}),e&&(e.removeEventListener('seeking',this.onvseeking),e.removeEventListener('seeked',this.onvseeked),e.removeEventListener('ended',this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},t.prototype.onMediaSeeking=function(){var e=this.media,t=e?e.currentTime:void 0,a=this.config;Object(ut.a)(t)&&gt.b.log('media seeking to '+t.toFixed(3));var r=this.mediaBuffer?this.mediaBuffer:e,n=Zt.bufferInfo(r,t,this.config.maxBufferHole);if(this.state===ga.FRAG_LOADING){var o=this.fragCurrent;if(0===n.len&&o){var i=a.maxFragLookUpTolerance,d=o.start-i,s=o.start+o.duration+i;t<d||t>s?(o.loader&&(gt.b.log('seeking outside of buffer while fragment load in progress, cancel fragment load'),o.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=ga.IDLE):gt.b.log('seeking outside of buffer but within currently loaded fragment range')}}else this.state===ga.ENDED&&(0===n.len&&(this.fragPrevious=0),this.state=ga.IDLE);e&&(this.lastCurrentTime=t),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=t),this.tick()},t.prototype.onMediaSeeked=function(){var e=this.media,t=e?e.currentTime:void 0;Object(ut.a)(t)&&gt.b.log('media seeked to '+t.toFixed(3)),this.tick()},t.prototype.onMediaEnded=function(){gt.b.log('media ended'),this.startPosition=this.lastCurrentTime=0},t.prototype.onManifestLoading=function(){gt.b.log('trigger BUFFER_RESET'),this.hls.trigger(ct.a.BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0},t.prototype.onManifestParsed=function(e){var t=!1,a=!1,r;e.levels.forEach(function(e){r=e.audioCodec,r&&(-1!==r.indexOf('mp4a.40.2')&&(t=!0),-1!==r.indexOf('mp4a.40.5')&&(a=!0))}),this.audioCodecSwitch=t&&a,this.audioCodecSwitch&&gt.b.log('both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC'),this.levels=e.levels,this.startFragRequested=!1;var n=this.config;(n.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(n.startPosition)},t.prototype.onLevelLoaded=function(e){var t=e.details,a=e.level,r=this.levels[this.levelLastLoaded],n=this.levels[a],o=t.totalduration,i=0;if(gt.b.log('level '+a+' loaded ['+t.startSN+','+t.endSN+'],duration:'+o),t.live){var d=n.details;d&&0<t.fragments.length?(U(d,t),i=t.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(i,d),t.PTSKnown&&Object(ut.a)(i)?gt.b.log('live playlist sliding:'+i.toFixed(3)):(gt.b.log('live playlist - outdated PTS, unknown sliding'),W(this.fragPrevious,r,t))):(gt.b.log('live playlist - first load, unknown sliding'),t.PTSKnown=!1,W(this.fragPrevious,r,t))}else t.PTSKnown=!1;if(n.details=t,this.levelLastLoaded=a,this.hls.trigger(ct.a.LEVEL_UPDATED,{details:t,level:a}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var s=t.startTimeOffset;Object(ut.a)(s)?(0>s&&(gt.b.log('negative start time offset '+s+', count from end of last fragment'),s=i+o+s),gt.b.log('start time offset found in playlist, adjust startPosition to '+s),this.startPosition=s):t.live?(this.startPosition=this.computeLivePosition(i,t),gt.b.log('configure startPosition to '+this.startPosition)):this.startPosition=0,this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===ga.WAITING_LEVEL&&(this.state=ga.IDLE),this.tick()},t.prototype.onKeyLoaded=function(){this.state===ga.KEY_LOADING&&(this.state=ga.IDLE,this.tick())},t.prototype.onFragLoaded=function(e){var t=this.fragCurrent,a=this.hls,r=this.levels,n=this.media,o=e.frag;if(this.state===ga.FRAG_LOADING&&t&&'main'===o.type&&o.level===t.level&&o.sn===t.sn){var i=e.stats,d=r[t.level],s=d.details;if(this.bitrateTest=!1,this.stats=i,gt.b.log('Loaded '+t.sn+' of ['+s.startSN+' ,'+s.endSN+'],level '+t.level),o.bitrateTest&&a.nextLoadLevel)this.state=ga.IDLE,this.startFragRequested=!1,i.tparsed=i.tbuffered=window.performance.now(),a.trigger(ct.a.FRAG_BUFFERED,{stats:i,frag:t,id:'main'}),this.tick();else if('initSegment'===o.sn)this.state=ga.IDLE,i.tparsed=i.tbuffered=window.performance.now(),s.initSegment.data=e.payload,a.trigger(ct.a.FRAG_BUFFERED,{stats:i,frag:t,id:'main'}),this.tick();else{gt.b.log('Parsing '+t.sn+' of ['+s.startSN+' ,'+s.endSN+'],level '+t.level+', cc '+t.cc),this.state=ga.PARSING,this.pendingBuffering=!0,this.appended=!1,o.bitrateTest&&(o.bitrateTest=!1,this.fragmentTracker.onFragLoaded({frag:o}));var l=!(n&&n.seeking)&&(s.PTSKnown||!s.live),p=s.initSegment?s.initSegment.data:[],u=this._getAudioCodec(d),c=this.demuxer=this.demuxer||new da(this.hls,'main');c.push(e.payload,p,u,d.videoCodec,t,s.totalduration,l)}}this.fragLoadError=0},t.prototype.onFragParsingInitSegment=function(e){var t=this.fragCurrent,a=e.frag;if(t&&'main'===e.id&&a.sn===t.sn&&a.level===t.level&&this.state===ga.PARSING){var r=e.tracks,n,o;if(r.audio&&this.altAudio&&delete r.audio,o=r.audio,o){var i=this.levels[this.level].audioCodec,d=navigator.userAgent.toLowerCase();i&&this.audioCodecSwap&&(gt.b.log('swapping playlist audio codec'),i=-1===i.indexOf('mp4a.40.5')?'mp4a.40.5':'mp4a.40.2'),this.audioCodecSwitch&&1!==o.metadata.channelCount&&-1===d.indexOf('firefox')&&(i='mp4a.40.5'),-1!==d.indexOf('android')&&'audio/mpeg'!==o.container&&(i='mp4a.40.2',gt.b.log('Android: force audio codec to '+i)),o.levelCodec=i,o.id=e.id}for(n in o=r.video,o&&(o.levelCodec=this.levels[this.level].videoCodec,o.id=e.id),this.hls.trigger(ct.a.BUFFER_CODECS,r),r){o=r[n],gt.b.log('main track:'+n+',container:'+o.container+',codecs[level/parsed]=['+o.levelCodec+'/'+o.codec+']');var s=o.initSegment;s&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(ct.a.BUFFER_APPENDING,{type:n,data:s,parent:'main',content:'initSegment'}))}this.tick()}},t.prototype.onFragParsingData=function(e){var t=this,a=this.fragCurrent,r=e.frag;if(a&&'main'===e.id&&r.sn===a.sn&&r.level===a.level&&!('audio'===e.type&&this.altAudio)&&this.state===ga.PARSING){var n=this.levels[this.level],o=a;if(Object(ut.a)(e.endPTS)||(e.endPTS=e.startPTS+a.duration,e.endDTS=e.startDTS+a.duration),!0===e.hasAudio&&o.addElementaryStream(Rt.ElementaryStreamTypes.AUDIO),!0===e.hasVideo&&o.addElementaryStream(Rt.ElementaryStreamTypes.VIDEO),gt.b.log('Parsed '+e.type+',PTS:['+e.startPTS.toFixed(3)+','+e.endPTS.toFixed(3)+'],DTS:['+e.startDTS.toFixed(3)+'/'+e.endDTS.toFixed(3)+'],nb:'+e.nb+',dropped:'+(e.dropped||0)),'video'===e.type)if(o.dropped=e.dropped,!o.dropped)o.backtracked=!1;else if(!o.backtracked){var i=n.details;if(i&&o.sn===i.startSN)gt.b.warn('missing video frame(s) on first frag, appending with gap',o.sn);else return gt.b.warn('missing video frame(s), backtracking fragment',o.sn),this.fragmentTracker.removeFragment(o),o.backtracked=!0,this.nextLoadPosition=e.startPTS,this.state=ga.IDLE,this.fragPrevious=o,void this.tick()}else gt.b.warn('Already backtracked on this fragment, appending with the gap',o.sn);var d=M(n.details,o,e.startPTS,e.endPTS,e.startDTS,e.endDTS),s=this.hls;s.trigger(ct.a.LEVEL_PTS_UPDATED,{details:n.details,level:this.level,drift:d,type:e.type,start:e.startPTS,end:e.endPTS}),[e.data1,e.data2].forEach(function(a){a&&a.length&&t.state===ga.PARSING&&(t.appended=!0,t.pendingBuffering=!0,s.trigger(ct.a.BUFFER_APPENDING,{type:e.type,data:a,parent:'main',content:'data'}))}),this.tick()}},t.prototype.onFragParsed=function(e){var t=this.fragCurrent,a=e.frag;t&&'main'===e.id&&a.sn===t.sn&&a.level===t.level&&this.state===ga.PARSING&&(this.stats.tparsed=window.performance.now(),this.state=ga.PARSED,this._checkAppendedParsed())},t.prototype.onAudioTrackSwitching=function(e){var t=!!e.url,a=e.id;if(!t){if(this.mediaBuffer!==this.media){gt.b.log('switching on main audio, use media.buffered to schedule main fragment loading'),this.mediaBuffer=this.media;var r=this.fragCurrent;r.loader&&(gt.b.log('switching to main audio track, cancel main fragment load'),r.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=ga.IDLE}var n=this.hls;n.trigger(ct.a.BUFFER_FLUSHING,{startOffset:0,endOffset:it,type:'audio'}),n.trigger(ct.a.AUDIO_TRACK_SWITCHED,{id:a}),this.altAudio=!1}},t.prototype.onAudioTrackSwitched=function(e){var t=e.id,a=!!this.hls.audioTracks[t].url;if(a){var r=this.videoBuffer;r&&this.mediaBuffer!==r&&(gt.b.log('switching on alternate audio, use video.buffered to schedule main fragment loading'),this.mediaBuffer=r)}this.altAudio=a,this.tick()},t.prototype.onBufferCreated=function(e){var t=e.tracks,a=!1,r,n;for(var o in t){var i=t[o];'main'===i.id?(n=o,r=i,'video'==o&&(this.videoBuffer=t[o].buffer)):a=!0}a&&r?(gt.b.log('alternate track found, use '+n+'.buffered to schedule main fragment loading'),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media},t.prototype.onBufferAppended=function(e){if('main'===e.parent){var t=this.state;(t===ga.PARSING||t===ga.PARSED)&&(this.pendingBuffering=0<e.pending,this._checkAppendedParsed())}},t.prototype._checkAppendedParsed=function(){if(this.state===ga.PARSED&&(!this.appended||!this.pendingBuffering)){var e=this.fragCurrent;if(e){var t=this.mediaBuffer?this.mediaBuffer:this.media;gt.b.log('main buffered : '+sa.toString(t.buffered)),this.fragPrevious=e;var a=this.stats;a.tbuffered=window.performance.now(),this.fragLastKbps=k(8*a.total/(a.tbuffered-a.tfirst)),this.hls.trigger(ct.a.FRAG_BUFFERED,{stats:a,frag:e,id:'main'}),this.state=ga.IDLE}this.tick()}},t.prototype.onError=function(e){var t=e.frag||this.fragCurrent;if(!(t&&'main'!==t.type)){var a=!!this.media&&Zt.isBuffered(this.media,this.media.currentTime)&&Zt.isBuffered(this.media,this.media.currentTime+.5);switch(e.details){case pt.a.FRAG_LOAD_ERROR:case pt.a.FRAG_LOAD_TIMEOUT:case pt.a.KEY_LOAD_ERROR:case pt.a.KEY_LOAD_TIMEOUT:if(!e.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var r=A(ot(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);gt.b.warn('mediaController: frag loading failed, retry in '+r+' ms'),this.retryDate=window.performance.now()+r,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=ga.FRAG_LOADING_WAITING_RETRY}else gt.b.error('mediaController: '+e.details+' reaches max retry, redispatch as fatal ...'),e.fatal=!0,this.state=ga.ERROR;break;case pt.a.LEVEL_LOAD_ERROR:case pt.a.LEVEL_LOAD_TIMEOUT:this.state!==ga.ERROR&&(e.fatal?(this.state=ga.ERROR,gt.b.warn('streamController: '+e.details+',switch to '+this.state+' state ...')):!e.levelRetry&&this.state===ga.WAITING_LEVEL&&(this.state=ga.IDLE));break;case pt.a.BUFFER_FULL_ERROR:'main'===e.parent&&(this.state===ga.PARSING||this.state===ga.PARSED)&&(a?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=ga.IDLE):(gt.b.warn('buffer full error also media.currentTime is not buffered, flush everything'),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)));break;default:}}},t.prototype._reduceMaxBufferLength=function(e){var t=this.config;return!!(t.maxMaxBufferLength>=e)&&(t.maxMaxBufferLength/=2,gt.b.warn('main:reduce max buffer length to '+t.maxMaxBufferLength+'s'),!0)},t.prototype._checkBuffer=function(){var e=this.media;if(e&&0!==e.readyState){var t=this.mediaBuffer?this.mediaBuffer:e,a=t.buffered;!this.loadedmetadata&&a.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():this.gapController.poll(this.lastCurrentTime,a)}},t.prototype.onFragLoadEmergencyAborted=function(){this.state=ga.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},t.prototype.onBufferFlushed=function(){var e=this.mediaBuffer?this.mediaBuffer:this.media;e&&this.fragmentTracker.detectEvictedFragments(Rt.ElementaryStreamTypes.VIDEO,e.buffered),this.state=ga.IDLE,this.fragPrevious=null},t.prototype.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},t.prototype.computeLivePosition=function(e,t){var a=void 0===this.config.liveSyncDuration?this.config.liveSyncDurationCount*t.targetduration:this.config.liveSyncDuration;return e+R(0,t.totalduration-a)},t.prototype._seekToStartPos=function(){var e=this.media,t=e.currentTime,a=e.seeking?t:this.startPosition;t!==a&&(gt.b.log('target start position not buffered, seek to buffered.start(0) '+a+' from current time '+t+' '),e.currentTime=a)},t.prototype._getAudioCodec=function(e){var t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&(gt.b.log('swapping playlist audio codec'),t&&(-1===t.indexOf('mp4a.40.5')?t='mp4a.40.5':t='mp4a.40.2')),t},ca(t,[{key:'state',set:function(e){if(this.state!==e){var t=this.state;this._state=e,gt.b.log('main stream:'+t+'->'+e),this.hls.trigger(ct.a.STREAM_STATE_TRANSITION,{previousState:t,nextState:e})}},get:function(){return this._state}},{key:'currentLevel',get:function(){var e=this.media;if(e){var t=this.getBufferedFrag(e.currentTime);if(t)return t.level}return-1}},{key:'nextBufferedFrag',get:function(){var e=this.media;return e?this.followingBufferedFrag(this.getBufferedFrag(e.currentTime)):null}},{key:'nextLevel',get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:'liveSyncPosition',get:function(){return this._liveSyncPosition},set:function(e){this._liveSyncPosition=e}}]),t}(pa),ya='function'==typeof Symbol&&'symbol'===N(Symbol.iterator)?function(e){return'undefined'==typeof e?'undefined':N(e)}:function(e){return e&&'function'==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?'symbol':'undefined'==typeof e?'undefined':N(e)},ma=function(){function e(e,t){for(var a=0,r;a<t.length;a++)r=t[a],r.enumerable=r.enumerable||!1,r.configurable=!0,'value'in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),ha=window,va=ha.performance,Ea=function(e){function t(a){ne(this,t);var r=oe(this,e.call(this,a,ct.a.MANIFEST_LOADED,ct.a.LEVEL_LOADED,ct.a.AUDIO_TRACK_SWITCHED,ct.a.FRAG_LOADED,ct.a.ERROR));return r.canload=!1,r.currentLevelIndex=null,r.manualLevelIndex=-1,r.timer=null,r}return ie(t,e),t.prototype.onHandlerDestroying=function(){this.clearTimer(),this.manualLevelIndex=-1},t.prototype.clearTimer=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},t.prototype.startLoad=function(){var e=this._levels;this.canload=!0,this.levelRetryCount=0,e&&e.forEach(function(e){e.loadError=0;var t=e.details;t&&t.live&&(e.details=void 0)}),null!==this.timer&&this.loadLevel()},t.prototype.stopLoad=function(){this.canload=!1},t.prototype.onManifestLoaded=function(e){var t=[],a=void 0,r={},n=null,o=!1,d=!1,s=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),l=[];if(e.levels.forEach(function(e){e.loadError=0,e.fragmentError=!1,o=o||!!e.videoCodec,d=d||!!e.audioCodec||!!(e.attrs&&e.attrs.AUDIO),s&&e.audioCodec&&-1!==e.audioCodec.indexOf('mp4a.40.34')&&(e.audioCodec=void 0),n=r[e.bitrate],n?n.url.push(e.url):(e.url=[e.url],e.urlId=0,r[e.bitrate]=e,t.push(e)),e.attrs&&e.attrs.AUDIO&&x(n||e,'audio',e.attrs.AUDIO),e.attrs&&e.attrs.SUBTITLES&&x(n||e,'text',e.attrs.SUBTITLES)}),o&&d&&(t=t.filter(function(e){var t=e.videoCodec;return!!t})),t=t.filter(function(e){var t=e.audioCodec,a=e.videoCodec;return(!t||p(t))&&(!a||p(a))}),e.audioTracks&&(l=e.audioTracks.filter(function(e){return!e.audioCodec||p(e.audioCodec,'audio')}),l.forEach(function(e,t){e.id=t})),0<t.length){a=t[0].bitrate,t.sort(function(e,t){return e.bitrate-t.bitrate}),this._levels=t;for(var u=0;u<t.length;u++)if(t[u].bitrate===a){this._firstLevel=u,gt.b.log('manifest loaded,'+t.length+' level(s) found, first bitrate:'+a);break}this.hls.trigger(ct.a.MANIFEST_PARSED,{levels:t,audioTracks:l,firstLevel:this._firstLevel,stats:e.stats,audio:d,video:o,altAudio:0<l.length&&o})}else this.hls.trigger(ct.a.ERROR,{type:pt.b.MEDIA_ERROR,details:pt.a.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:'no level with compatible codecs found in manifest'})},t.prototype.setLevelInternal=function(e){var t=this._levels,a=this.hls;if(0<=e&&e<t.length){if(this.clearTimer(),this.currentLevelIndex!==e){gt.b.log('switching to level '+e),this.currentLevelIndex=e;var r=t[e];r.level=e,a.trigger(ct.a.LEVEL_SWITCHING,r)}var n=t[e],o=n.details;if(!o||o.live){var i=n.urlId;a.trigger(ct.a.LEVEL_LOADING,{url:n.url[i],level:e,id:i})}}else a.trigger(ct.a.ERROR,{type:pt.b.OTHER_ERROR,details:pt.a.LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:'invalid level idx'})},t.prototype.onError=function(e){if(e.fatal)return void(e.type===pt.b.NETWORK_ERROR&&this.clearTimer());var t=!1,a=!1,r=void 0;switch(e.details){case pt.a.FRAG_LOAD_ERROR:case pt.a.FRAG_LOAD_TIMEOUT:case pt.a.KEY_LOAD_ERROR:case pt.a.KEY_LOAD_TIMEOUT:r=e.frag.level,a=!0;break;case pt.a.LEVEL_LOAD_ERROR:case pt.a.LEVEL_LOAD_TIMEOUT:r=e.context.level,t=!0;break;case pt.a.REMUX_ALLOC_ERROR:r=e.level,t=!0;}void 0!==r&&this.recoverLevel(e,r,t,a)},t.prototype.recoverLevel=function(e,t,a,r){var n=this,o=this.hls.config,i=e.details,d=this._levels[t],s=void 0,l=void 0,p=void 0;if(d.loadError++,d.fragmentError=r,a)if(this.levelRetryCount+1<=o.levelLoadingMaxRetry)l=A(ot(2,this.levelRetryCount)*o.levelLoadingRetryDelay,o.levelLoadingMaxRetryTimeout),this.timer=setTimeout(function(){return n.loadLevel()},l),e.levelRetry=!0,this.levelRetryCount++,gt.b.warn('level controller, '+i+', retry in '+l+' ms, current retry count is '+this.levelRetryCount);else return gt.b.error('level controller, cannot recover from '+i+' error'),this.currentLevelIndex=null,this.clearTimer(),void(e.fatal=!0);(a||r)&&(s=d.url.length,1<s&&d.loadError<s?(d.urlId=(d.urlId+1)%s,d.details=void 0,gt.b.warn('level controller, '+i+' for level '+t+': switching to redundant URL-id '+d.urlId)):-1===this.manualLevelIndex?(p=0===t?this._levels.length-1:t-1,gt.b.warn('level controller, '+i+': switch to '+p),this.hls.nextAutoLevel=this.currentLevelIndex=p):r&&(gt.b.warn('level controller, '+i+': reload a fragment'),this.currentLevelIndex=null))},t.prototype.onFragLoaded=function(e){var t=e.frag;if(void 0!==t&&'main'===t.type){var a=this._levels[t.level];void 0!==a&&(a.fragmentError=!1,a.loadError=0,this.levelRetryCount=0)}},t.prototype.onLevelLoaded=function(e){var t=this,a=e.level;if(a===this.currentLevelIndex){var r=this._levels[a];r.fragmentError||(r.loadError=0,this.levelRetryCount=0);var n=e.details;if(n.live){var o=1e3*(n.averagetargetduration?n.averagetargetduration:n.targetduration),i=o,d=r.details;d&&n.endSN===d.endSN&&(i/=2,gt.b.log('same live playlist, reload twice faster')),i-=va.now()-e.stats.trequest,i=R(o/2,k(i)),gt.b.log('live playlist, reload in '+k(i)+' ms'),this.timer=setTimeout(function(){return t.loadLevel()},i)}else this.clearTimer()}},t.prototype.onAudioTrackSwitched=function(e){var t=this.hls.audioTracks[e.id].groupId,a=this.hls.levels[this.currentLevelIndex];if(a&&a.audioGroupIds){var r=a.audioGroupIds.findIndex(function(e){return e===t});r!==a.urlId&&(a.urlId=r,this.startLoad())}},t.prototype.loadLevel=function(){if(gt.b.debug('call to loadLevel'),null!==this.currentLevelIndex&&this.canload){var e=this._levels[this.currentLevelIndex];if('object'===('undefined'==typeof e?'undefined':ya(e))&&0<e.url.length){var t=this.currentLevelIndex,a=e.urlId,r=e.url[a];gt.b.log('Attempt loading level index '+t+' with URL-id '+a),this.hls.trigger(ct.a.LEVEL_LOADING,{url:r,level:t,id:a})}}},ma(t,[{key:'levels',get:function(){return this._levels}},{key:'level',get:function(){return this.currentLevelIndex},set:function(e){var t=this._levels;t&&(e=A(e,t.length-1),(this.currentLevelIndex!==e||!t[e].details)&&this.setLevelInternal(e))}},{key:'manualLevel',get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:'firstLevel',get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:'startLevel',get:function(){if(void 0===this._startLevel){var e=this.hls.config.startLevel;return void 0===e?this._firstLevel:e}return this._startLevel},set:function(e){this._startLevel=e}},{key:'nextLoadLevel',get:function(){return-1===this.manualLevelIndex?this.hls.nextAutoLevel:this.manualLevelIndex},set:function(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}}]),t}(ht),ba=r(6),Ta=function(e){function t(a){le(this,t);var r=pe(this,e.call(this,a,ct.a.MEDIA_ATTACHED,ct.a.MEDIA_DETACHING,ct.a.FRAG_PARSING_METADATA));return r.id3Track=void 0,r.media=void 0,r}return ue(t,e),t.prototype.destroy=function(){ht.prototype.destroy.call(this)},t.prototype.onMediaAttached=function(e){if(this.media=e.media,!this.media);},t.prototype.onMediaDetaching=function(){se(this.id3Track),this.id3Track=void 0,this.media=void 0},t.prototype.getID3Track=function(e){for(var t=0,a;t<e.length;t++)if(a=e[t],'metadata'===a.kind&&'id3'===a.label)return de(a,this.media),a;return this.media.addTextTrack('metadata','id3')},t.prototype.onFragParsingMetadata=function(e){var t=e.frag,a=e.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode='hidden');for(var r=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,n=0,o;n<a.length;n++)if(o=ba.a.getID3Frames(a[n].data),o){var d=a[n].pts,s=n<a.length-1?a[n+1].pts:t.endPTS;d===s&&(s+=1e-4);for(var l=0,p;l<o.length;l++)if(p=o[l],!ba.a.isTimeStampFrame(p)){var u=new r(d,s,'');u.value=p,this.id3Track.addCue(u)}}},t}(ht),Sa=function(){function e(t){ge(this,e),this.alpha_=t?Math.exp(-0.6931471805599453/t):0,this.estimate_=0,this.totalWeight_=0}return e.prototype.sample=function(e,t){var a=ot(this.alpha_,e);this.estimate_=t*(1-a)+a*this.estimate_,this.totalWeight_+=e},e.prototype.getTotalWeight=function(){return this.totalWeight_},e.prototype.getEstimate=function(){if(this.alpha_){var e=1-ot(this.alpha_,this.totalWeight_);return this.estimate_/e}return this.estimate_},e}(),_a=Sa,Ra=function(){function e(t,a,r,n){fe(this,e),this.hls=t,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new _a(a),this.fast_=new _a(r)}return e.prototype.sample=function(e,t){e=R(e,this.minDelayMs_);var a=8e3*t/e,r=e/1e3;this.fast_.sample(r,a),this.slow_.sample(r,a)},e.prototype.canEstimate=function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_},e.prototype.getEstimate=function(){return this.canEstimate()?A(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},e.prototype.destroy=function(){},e}(),Aa=function(){function e(e,t){for(var a=0,r;a<t.length;a++)r=t[a],r.enumerable=r.enumerable||!1,r.configurable=!0,'value'in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),ka=window,La=ka.performance,Da=function(t){function a(e){ye(this,a);var r=me(this,t.call(this,e,ct.a.FRAG_LOADING,ct.a.FRAG_LOADED,ct.a.FRAG_BUFFERED,ct.a.ERROR));return r.lastLoadedFragLevel=0,r._nextAutoLevel=-1,r.hls=e,r.timer=null,r._bwEstimator=null,r.onCheck=r._abandonRulesCheck.bind(r),r}return he(a,t),a.prototype.destroy=function(){this.clearTimer(),ht.prototype.destroy.call(this)},a.prototype.onFragLoading=function(e){var t=e.frag;if('main'===t.type&&(this.timer||(this.fragCurrent=t,this.timer=setInterval(this.onCheck,100)),!this._bwEstimator)){var a=this.hls,r=a.config,n=t.level,o=a.levels[n].details.live,i=void 0,d=void 0;o?(i=r.abrEwmaFastLive,d=r.abrEwmaSlowLive):(i=r.abrEwmaFastVoD,d=r.abrEwmaSlowVoD),this._bwEstimator=new Ra(a,d,i,r.abrEwmaDefaultEstimate)}},a.prototype._abandonRulesCheck=function(){var t=this.hls,a=t.media,r=this.fragCurrent;if(r){var n=r.loader,o=t.minAutoLevel;if(!n||n.stats&&n.stats.aborted)return gt.b.warn('frag loader destroy or aborted, disarm abandonRules'),this.clearTimer(),void(this._nextAutoLevel=-1);var i=n.stats;if(a&&i&&(!a.paused&&0!==a.playbackRate||!a.readyState)&&r.autoLevel&&r.level){var d=La.now()-i.trequest,s=e(a.playbackRate);if(d>500*r.duration/s){var l=t.levels,p=R(1,i.bw?i.bw/8:1e3*i.loaded/d),u=l[r.level],c=u.realBitrate?R(u.realBitrate,u.bitrate):u.bitrate,g=i.total?i.total:R(i.loaded,k(r.duration*c/8)),f=a.currentTime,y=(g-i.loaded)/p,m=(Zt.bufferInfo(a,f,t.config.maxBufferHole).end-f)/s;if(m<2*r.duration/s&&y>m){var h,v;for(v=r.level-1;v>o;v--){var E=l[v].realBitrate?R(l[v].realBitrate,l[v].bitrate):l[v].bitrate;if(h=r.duration*E/(.8*8*p),h<m)break}h<y&&(gt.b.warn('loading too slow, abort fragment loading and switch to level '+v+':fragLoadedDelay['+v+']<fragLoadedDelay['+(r.level-1)+'];bufferStarvationDelay:'+h.toFixed(1)+'<'+y.toFixed(1)+':'+m.toFixed(1)),t.nextLoadLevel=v,this._bwEstimator.sample(d,i.loaded),n.abort(),this.clearTimer(),t.trigger(ct.a.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,stats:i}))}}}}},a.prototype.onFragLoaded=function(e){var t=e.frag;if('main'===t.type&&Object(ut.a)(t.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var a=this.hls.levels[t.level],r=(a.loaded?a.loaded.bytes:0)+e.stats.loaded,n=(a.loaded?a.loaded.duration:0)+e.frag.duration;a.loaded={bytes:r,duration:n},a.realBitrate=k(8*r/n)}if(e.frag.bitrateTest){var o=e.stats;o.tparsed=o.tbuffered=o.tload,this.onFragBuffered(e)}}},a.prototype.onFragBuffered=function(e){var t=e.stats,a=e.frag;if(!0!==t.aborted&&'main'===a.type&&Object(ut.a)(a.sn)&&(!a.bitrateTest||t.tload===t.tbuffered)){var r=t.tparsed-t.trequest;gt.b.log('latency/loading/parsing/append/kbps:'+k(t.tfirst-t.trequest)+'/'+k(t.tload-t.tfirst)+'/'+k(t.tparsed-t.tload)+'/'+k(t.tbuffered-t.tparsed)+'/'+k(8*t.loaded/(t.tbuffered-t.trequest))),this._bwEstimator.sample(r,t.loaded),t.bwEstimate=this._bwEstimator.getEstimate(),this.bitrateTestDelay=a.bitrateTest?r/1e3:0}},a.prototype.onError=function(e){switch(e.details){case pt.a.FRAG_LOAD_ERROR:case pt.a.FRAG_LOAD_TIMEOUT:this.clearTimer();break;default:}},a.prototype.clearTimer=function(){clearInterval(this.timer),this.timer=null},a.prototype._findBestLevel=function(e,t,a,r,n,o,d,s,l){for(var p=n,u;p>=r;p--)if(u=l[p],!!u){var c=u.details,g=c?c.totalduration/c.fragments.length:t,f=!!c&&c.live,y=void 0;y=p<=e?d*a:s*a;var m=l[p].realBitrate?R(l[p].realBitrate,l[p].bitrate):l[p].bitrate,h=m*g/y;if(gt.b.trace('level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: '+p+'/'+k(y)+'/'+m+'/'+g+'/'+o+'/'+h),y>m&&(!h||f&&!this.bitrateTestDelay||h<o))return p}return-1},Aa(a,[{key:'nextAutoLevel',get:function(){var e=this._nextAutoLevel,t=this._bwEstimator;if(-1!==e&&(!t||!t.canEstimate()))return e;var a=this._nextABRAutoLevel;return-1!==e&&(a=A(e,a)),a},set:function(e){this._nextAutoLevel=e}},{key:'_nextABRAutoLevel',get:function(){var t=this.hls,a=t.maxAutoLevel,r=t.levels,n=t.config,o=t.minAutoLevel,i=t.media,d=this.lastLoadedFragLevel,s=this.fragCurrent?this.fragCurrent.duration:0,l=i?i.currentTime:0,p=i&&0!==i.playbackRate?e(i.playbackRate):1,u=this._bwEstimator?this._bwEstimator.getEstimate():n.abrEwmaDefaultEstimate,c=(Zt.bufferInfo(i,l,n.maxBufferHole).end-l)/p,g=this._findBestLevel(d,s,u,o,a,c,n.abrBandWidthFactor,n.abrBandWidthUpFactor,r);if(0<=g)return g;gt.b.trace('rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering');var f=s?A(s,n.maxStarvationDelay):n.maxStarvationDelay,y=n.abrBandWidthFactor,m=n.abrBandWidthUpFactor;if(0==c){var h=this.bitrateTestDelay;if(h){var v=s?A(s,n.maxLoadingDelay):n.maxLoadingDelay;f=v-h,gt.b.trace('bitrate test took '+k(1e3*h)+'ms, set first fragment max fetchDuration to '+k(1e3*f)+' ms'),y=m=1}}return g=this._findBestLevel(d,s,u,o,a,c+f,y,m,r),R(g,0)}}]),a}(ht),Pa=O(),Ca=function(t){function a(e){ve(this,a);var r=Ee(this,t.call(this,e,ct.a.MEDIA_ATTACHING,ct.a.MEDIA_DETACHING,ct.a.MANIFEST_PARSED,ct.a.BUFFER_RESET,ct.a.BUFFER_APPENDING,ct.a.BUFFER_CODECS,ct.a.BUFFER_EOS,ct.a.BUFFER_FLUSHING,ct.a.LEVEL_PTS_UPDATED,ct.a.LEVEL_UPDATED));return r._msDuration=null,r._levelDuration=null,r._live=null,r._objectUrl=null,r.onsbue=r.onSBUpdateEnd.bind(r),r.onsbe=r.onSBUpdateError.bind(r),r.pendingTracks={},r.tracks={},r}return be(a,t),a.prototype.destroy=function(){ht.prototype.destroy.call(this)},a.prototype.onLevelPtsUpdated=function(t){var a=t.type,r=this.tracks.audio;if('audio'===a&&r&&'audio/mpeg'===r.container){var n=this.sourceBuffer.audio,o=e(n.timestampOffset-t.start);if(.1<o){var i=n.updating;try{n.abort()}catch(e){i=!0,gt.b.warn('can not abort audio buffer: '+e)}i?this.audioTimestampOffset=t.start:(gt.b.warn('change mpeg audio timestamp offset from '+n.timestampOffset+' to '+t.start),n.timestampOffset=t.start)}}},a.prototype.onManifestParsed=function(e){var t=e.audio,a=e.video||e.levels.length&&e.altAudio,r=0;e.altAudio&&(t||a)&&(r=(t?1:0)+(a?1:0),gt.b.log(r+' sourceBuffer(s) expected')),this.sourceBufferNb=r},a.prototype.onMediaAttaching=function(e){var t=this.media=e.media;if(t){var a=this.mediaSource=new Pa;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),a.addEventListener('sourceopen',this.onmso),a.addEventListener('sourceended',this.onmse),a.addEventListener('sourceclose',this.onmsc),t.src=window.URL.createObjectURL(a),this._objectUrl=t.src}},a.prototype.onMediaDetaching=function(){gt.b.log('media source detaching');var e=this.mediaSource;if(e){if('open'===e.readyState)try{e.endOfStream()}catch(e){gt.b.warn('onMediaDetaching:'+e.message+' while calling endOfStream')}e.removeEventListener('sourceopen',this.onmso),e.removeEventListener('sourceended',this.onmse),e.removeEventListener('sourceclose',this.onmsc),this.media&&(window.URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute('src'),this.media.load()):gt.b.warn('media.src was changed by a third party - skip cleanup')),this.mediaSource=null,this.media=null,this._objectUrl=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(ct.a.MEDIA_DETACHED)},a.prototype.onMediaSourceOpen=function(){gt.b.log('media source opened'),this.hls.trigger(ct.a.MEDIA_ATTACHED,{media:this.media});var e=this.mediaSource;e&&e.removeEventListener('sourceopen',this.onmso),this.checkPendingTracks()},a.prototype.checkPendingTracks=function(){var e=this.pendingTracks,t=Object.keys(e).length;t&&(this.sourceBufferNb<=t||0===this.sourceBufferNb)&&(this.createSourceBuffers(e),this.pendingTracks={},this.doAppending())},a.prototype.onMediaSourceClose=function(){gt.b.log('media source closed')},a.prototype.onMediaSourceEnded=function(){gt.b.log('media source ended')},a.prototype.onSBUpdateEnd=function(){if(this.audioTimestampOffset){var e=this.sourceBuffer.audio;gt.b.warn('change mpeg audio timestamp offset from '+e.timestampOffset+' to '+this.audioTimestampOffset),e.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var t=this.parent,a=this.segments.reduce(function(e,a){return a.parent===t?e+1:e},0),r={},n=this.sourceBuffer;for(var o in n)r[o]=n[o].buffered;this.hls.trigger(ct.a.BUFFER_APPENDED,{parent:t,pending:a,timeRanges:r}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration()},a.prototype.onSBUpdateError=function(e){gt.b.error('sourceBuffer error:',e),this.hls.trigger(ct.a.ERROR,{type:pt.b.MEDIA_ERROR,details:pt.a.BUFFER_APPENDING_ERROR,fatal:!1})},a.prototype.onBufferReset=function(){var e=this.sourceBuffer;for(var t in e){var a=e[t];try{this.mediaSource.removeSourceBuffer(a),a.removeEventListener('updateend',this.onsbue),a.removeEventListener('error',this.onsbe)}catch(e){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},a.prototype.onBufferCodecs=function(e){if(0===Object.keys(this.sourceBuffer).length){for(var t in e)this.pendingTracks[t]=e[t];var a=this.mediaSource;a&&'open'===a.readyState&&this.checkPendingTracks()}},a.prototype.createSourceBuffers=function(e){var t=this.sourceBuffer,a=this.mediaSource;for(var r in e)if(!t[r]){var n=e[r],o=n.levelCodec||n.codec,i=n.container+';codecs='+o;gt.b.log('creating sourceBuffer('+i+')');try{var d=t[r]=a.addSourceBuffer(i);d.addEventListener('updateend',this.onsbue),d.addEventListener('error',this.onsbe),this.tracks[r]={codec:o,container:n.container},n.buffer=d}catch(e){gt.b.error('error while trying to add sourceBuffer:'+e.message),this.hls.trigger(ct.a.ERROR,{type:pt.b.MEDIA_ERROR,details:pt.a.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:e,mimeType:i})}}this.hls.trigger(ct.a.BUFFER_CREATED,{tracks:e})},a.prototype.onBufferAppending=function(e){this._needsFlush||(this.segments?this.segments.push(e):this.segments=[e],this.doAppending())},a.prototype.onBufferAppendFail=function(e){gt.b.error('sourceBuffer error:',e.event),this.hls.trigger(ct.a.ERROR,{type:pt.b.MEDIA_ERROR,details:pt.a.BUFFER_APPENDING_ERROR,fatal:!1})},a.prototype.onBufferEos=function(e){var t=this.sourceBuffer,a=e.type;for(var r in t)(!a||r===a)&&(t[r].ended||(t[r].ended=!0,gt.b.log(r+' sourceBuffer now EOS')));this.checkEos()},a.prototype.checkEos=function(){var e=this.sourceBuffer,t=this.mediaSource;if(!t||'open'!==t.readyState)return void(this._needsEos=!1);for(var a in e){var r=e[a];if(!r.ended)return;if(r.updating)return void(this._needsEos=!0)}gt.b.log('all media data available, signal endOfStream() to MediaSource and stop loading fragment');try{t.endOfStream()}catch(t){gt.b.warn('exception while calling mediaSource.endOfStream()')}this._needsEos=!1},a.prototype.onBufferFlushing=function(e){this.flushRange.push({start:e.startOffset,end:e.endOffset,type:e.type}),this.flushBufferCounter=0,this.doFlush()},a.prototype.onLevelUpdated=function(e){var t=e.details;0<t.fragments.length&&(this._levelDuration=t.totalduration+t.fragments[0].start,this._live=t.live,this.updateMediaElementDuration())},a.prototype.updateMediaElementDuration=function(){var e=this.hls.config,t=void 0;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&'open'===this.mediaSource.readyState){for(var a in this.sourceBuffer)if(!0===this.sourceBuffer[a].updating)return;t=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),!0===this._live&&!0===e.liveDurationInfinity?(gt.b.log('Media Source duration is set to Infinity'),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>t||!Object(ut.a)(t))&&(gt.b.log('Updating Media Source duration to '+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},a.prototype.doFlush=function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(this.flushBuffer(e.start,e.end,e.type))this.flushRange.shift(),this.flushBufferCounter=0;else return void(this._needsFlush=!0)}if(0===this.flushRange.length){this._needsFlush=!1;var t=0,a=this.sourceBuffer;try{for(var r in a)t+=a[r].buffered.length}catch(e){gt.b.error('error while accessing sourceBuffer.buffered')}this.appended=t,this.hls.trigger(ct.a.BUFFER_FLUSHED)}},a.prototype.doAppending=function(){var e=this.hls,t=this.sourceBuffer,a=this.segments;if(Object.keys(t).length){if(this.media.error)return this.segments=[],void gt.b.error('trying to append although a media error occured, flush segment and abort');if(this.appending)return;if(a&&a.length){var r=a.shift();try{var n=r.type,o=t[n];o?o.updating?a.unshift(r):(o.ended=!1,this.parent=r.parent,o.appendBuffer(r.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(t){gt.b.error('error while trying to append buffer:'+t.message),a.unshift(r);var i={type:pt.b.MEDIA_ERROR,parent:r.parent};22===t.code?(this.segments=[],i.details=pt.a.BUFFER_FULL_ERROR,i.fatal=!1,e.trigger(ct.a.ERROR,i)):(this.appendError?this.appendError++:this.appendError=1,i.details=pt.a.BUFFER_APPEND_ERROR,this.appendError>e.config.appendErrorMaxRetry?(gt.b.log('fail '+e.config.appendErrorMaxRetry+' times to append segment in sourceBuffer'),a=[],i.fatal=!0,e.trigger(ct.a.ERROR,i)):(i.fatal=!1,e.trigger(ct.a.ERROR,i)))}}}},a.prototype.flushBuffer=function(e,t,a){var r=this.sourceBuffer,n,o,d,s,l,p;if(Object.keys(r).length){if(gt.b.log('flushBuffer,pos/start/end: '+this.media.currentTime.toFixed(3)+'/'+e+'/'+t),this.flushBufferCounter<this.appended){for(var u in r)if(!(a&&u!==a))if(n=r[u],n.ended=!1,!n.updating)try{for(o=0;o<n.buffered.length;o++)if(d=n.buffered.start(o),s=n.buffered.end(o),-1!==navigator.userAgent.toLowerCase().indexOf('firefox')&&t===it?(l=e,p=t):(l=R(d,e),p=A(s,t)),.5<A(p,s)-l)return this.flushBufferCounter++,gt.b.log('flush '+u+' ['+l+','+p+'], of ['+d+','+s+'], pos:'+this.media.currentTime),n.remove(l,p),!1}catch(t){gt.b.warn('exception while accessing sourcebuffer, it might have been removed from MediaSource')}else return gt.b.warn('cannot flush, sb updating in progress'),!1;}else gt.b.warn('abort flushing too many retries');gt.b.log('buffer flushed')}return!0},a}(ht),Ia=function(){function e(e,t){for(var a=0,r;a<t.length;a++)r=t[a],r.enumerable=r.enumerable||!1,r.configurable=!0,'value'in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),Oa=function(e){function t(a){Te(this,t);var r=Se(this,e.call(this,a,ct.a.FPS_DROP_LEVEL_CAPPING,ct.a.MEDIA_ATTACHING,ct.a.MANIFEST_PARSED,ct.a.BUFFER_CODECS,ct.a.MEDIA_DETACHING));return r.autoLevelCapping=it,r.firstLevel=null,r.levels=[],r.media=null,r.restrictedLevels=[],r.timer=null,r}return _e(t,e),t.prototype.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this._stopCapping())},t.prototype.onFpsDropLevelCapping=function(e){t.isLevelAllowed(e.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(e.droppedLevel)},t.prototype.onMediaAttaching=function(e){this.media=e.media instanceof window.HTMLVideoElement?e.media:null},t.prototype.onManifestParsed=function(e){var t=this.hls;this.restrictedLevels=[],this.levels=e.levels,this.firstLevel=e.firstLevel,t.config.capLevelToPlayerSize&&(e.video||e.levels.length&&e.altAudio)&&this._startCapping()},t.prototype.onBufferCodecs=function(e){var t=this.hls;t.config.capLevelToPlayerSize&&e.video&&this._startCapping()},t.prototype.onLevelsUpdated=function(e){this.levels=e.levels},t.prototype.onMediaDetaching=function(){this._stopCapping()},t.prototype.detectPlayerSize=function(){if(this.media){var e=this.levels?this.levels.length:0;if(e){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e-1),t.autoLevelCapping>this.autoLevelCapping&&t.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}},t.prototype.getMaxLevel=function(e){var a=this;if(!this.levels)return-1;var r=this.levels.filter(function(r,n){return t.isLevelAllowed(n,a.restrictedLevels)&&n<=e});return t.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)},t.prototype._startCapping=function(){this.timer||(this.autoLevelCapping=it,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},t.prototype._stopCapping=function(){this.restrictedLevels=[],this.firstLevel=null,this.autoLevelCapping=it,this.timer&&(this.timer=clearInterval(this.timer),this.timer=null)},t.isLevelAllowed=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return-1===t.indexOf(e)},t.getMaxLevelByMediaSize=function(e,t,a){if(!e||e&&!e.length)return-1;for(var r=function(e,t){return!t||e.width!==t.width||e.height!==t.height},n=e.length-1,o=0,d;o<e.length;o+=1)if(d=e[o],(d.width>=t||d.height>=a)&&r(d,e[o+1])){n=o;break}return n},Ia(t,[{key:'mediaWidth',get:function(){var e=void 0,a=this.media;return a&&(e=a.width||a.clientWidth||a.offsetWidth,e*=t.contentScaleFactor),e}},{key:'mediaHeight',get:function(){var e=void 0,a=this.media;return a&&(e=a.height||a.clientHeight||a.offsetHeight,e*=t.contentScaleFactor),e}}],[{key:'contentScaleFactor',get:function(){var e=1;try{e=window.devicePixelRatio}catch(t){}return e}}]),t}(ht),Fa=window,xa=Fa.performance,Na=function(e){function t(a){return Re(this,t),Ae(this,e.call(this,a,ct.a.MEDIA_ATTACHING))}return ke(t,e),t.prototype.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},t.prototype.onMediaAttaching=function(e){var t=this.hls.config;if(t.capLevelOnFPSDrop){var a=this.video=e.media instanceof window.HTMLVideoElement?e.media:null;'function'==typeof a.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),t.fpsDroppedMonitoringPeriod)}},t.prototype.checkFPS=function(e,t,a){var r=xa.now();if(t){if(this.lastTime){var n=r-this.lastTime,o=a-this.lastDroppedFrames,i=t-this.lastDecodedFrames,d=this.hls;if(d.trigger(ct.a.FPS_DROP,{currentDropped:o,currentDecoded:i,totalDroppedFrames:a}),0<1e3*o/n&&o>d.config.fpsDroppedMonitoringThreshold*i){var s=d.currentLevel;gt.b.warn('drop FPS ratio greater than max allowed value for currentLevel: '+s),0<s&&(-1===d.autoLevelCapping||d.autoLevelCapping>=s)&&(--s,d.trigger(ct.a.FPS_DROP_LEVEL_CAPPING,{level:s,droppedLevel:d.currentLevel}),d.autoLevelCapping=s,d.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=a,this.lastDecodedFrames=t}},t.prototype.checkFPSInterval=function(){var e=this.video;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},t}(ht),wa=window,Ma=wa.performance,Ua=wa.XMLHttpRequest,Ba=function(){function e(t){Le(this,e),t&&t.xhrSetup&&(this.xhrSetup=t.xhrSetup)}return e.prototype.destroy=function(){this.abort(),this.loader=null},e.prototype.abort=function(){var e=this.loader;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},e.prototype.load=function(e,t,a){this.context=e,this.config=t,this.callbacks=a,this.stats={trequest:Ma.now(),retry:0},this.retryDelay=t.retryDelay,this.loadInternal()},e.prototype.loadInternal=function(){var t=this.context,a;a=this.loader=new Ua;var e=this.stats;e.tfirst=0,e.loaded=0;var r=this.xhrSetup;try{if(r)try{r(a,t.url)}catch(n){a.open('GET',t.url,!0),r(a,t.url)}a.readyState||a.open('GET',t.url,!0)}catch(r){return void this.callbacks.onError({code:a.status,text:r.message},t,a)}t.rangeEnd&&a.setRequestHeader('Range','bytes='+t.rangeStart+'-'+(t.rangeEnd-1)),a.onreadystatechange=this.readystatechange.bind(this),a.onprogress=this.loadprogress.bind(this),a.responseType=t.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),a.send()},e.prototype.readystatechange=function(e){var t=e.currentTarget,a=t.readyState,r=this.stats,n=this.context,o=this.config;if(!r.aborted&&2<=a)if(window.clearTimeout(this.requestTimeout),0===r.tfirst&&(r.tfirst=R(Ma.now(),r.trequest)),4===a){var i=t.status;if(200<=i&&300>i){r.tload=R(r.tfirst,Ma.now());var d,s;'arraybuffer'===n.responseType?(d=t.response,s=d.byteLength):(d=t.responseText,s=d.length),r.loaded=r.total=s;var l={url:t.responseURL,data:d};this.callbacks.onSuccess(l,r,n,t)}else r.retry>=o.maxRetry||400<=i&&499>i?(gt.b.error(i+' while loading '+n.url),this.callbacks.onError({code:i,text:t.statusText},n,t)):(gt.b.warn(i+' while loading '+n.url+', retrying in '+this.retryDelay+'...'),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=A(2*this.retryDelay,o.maxRetryDelay),r.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),o.timeout)},e.prototype.loadtimeout=function(){gt.b.warn('timeout while loading '+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},e.prototype.loadprogress=function(e){var t=e.currentTarget,a=this.stats;a.loaded=e.loaded,e.lengthComputable&&(a.total=e.total);var r=this.callbacks.onProgress;r&&r(a,this.context,null,t)},e}(),Ga=function(){function e(e,t){for(var a=0,r;a<t.length;a++)r=t[a],r.enumerable=r.enumerable||!1,r.configurable=!0,'value'in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),Ka=function(e){function t(a){De(this,t);var r=Pe(this,e.call(this,a,ct.a.MANIFEST_LOADING,ct.a.MANIFEST_PARSED,ct.a.AUDIO_TRACK_LOADED,ct.a.AUDIO_TRACK_SWITCHED,ct.a.LEVEL_LOADED,ct.a.ERROR));return r._trackId=-1,r._selectDefaultTrack=!0,r.tracks=[],r.trackIdBlacklist=Object.create(null),r.audioGroupId=null,r}return Ce(t,e),t.prototype.onManifestLoading=function(){this.tracks=[],this._trackId=-1,this._selectDefaultTrack=!0},t.prototype.onManifestParsed=function(e){var t=this.tracks=e.audioTracks||[];this.hls.trigger(ct.a.AUDIO_TRACKS_UPDATED,{audioTracks:t})},t.prototype.onAudioTrackLoaded=function(e){if(e.id>=this.tracks.length)return void gt.b.warn('Invalid audio track id:',e.id);if(gt.b.log('audioTrack '+e.id+' loaded'),this.tracks[e.id].details=e.details,e.details.live&&!this.hasInterval()){var t=1e3*e.details.targetduration;this.setInterval(t)}!e.details.live&&this.hasInterval()&&this.clearInterval()},t.prototype.onAudioTrackSwitched=function(e){var t=this.tracks[e.id].groupId;t&&this.audioGroupId!==t&&(this.audioGroupId=t)},t.prototype.onLevelLoaded=function(e){var t=this.hls.levels[e.level];if(t.audioGroupIds){var a=t.audioGroupIds[t.urlId];this.audioGroupId!==a&&(this.audioGroupId=a,this._selectInitialAudioTrack())}},t.prototype.onError=function(e){e.type===pt.b.NETWORK_ERROR&&(e.fatal&&this.clearInterval(),e.details!==pt.a.AUDIO_TRACK_LOAD_ERROR||(gt.b.warn('Network failure on audio-track id:',e.context.id),this._handleLoadError()))},t.prototype._setAudioTrack=function(e){if(this._trackId===e&&this.tracks[this._trackId].details)return void gt.b.debug('Same id as current audio-track passed, and track details available -> no-op');if(0>e||e>=this.tracks.length)return void gt.b.warn('Invalid id passed to audio-track controller');var t=this.tracks[e];gt.b.log('Now switching to audio-track index '+e),this.clearInterval(),this._trackId=e;var a=t.url,r=t.type,n=t.id;this.hls.trigger(ct.a.AUDIO_TRACK_SWITCHING,{id:n,type:r,url:a}),this._loadTrackDetailsIfNeeded(t)},t.prototype.doTick=function(){this._updateTrack(this._trackId)},t.prototype._selectInitialAudioTrack=function(){var e=this,t=this.tracks;if(t.length){var a=this.tracks[this._trackId],r=null;if(a&&(r=a.name),this._selectDefaultTrack){var n=t.filter(function(e){return e.default});n.length?t=n:gt.b.warn('No default audio tracks defined')}var o=!1,i=function(){t.forEach(function(t){!o&&(e.audioGroupId&&t.groupId!==e.audioGroupId||r&&r!==t.name||(e._setAudioTrack(t.id),o=!0))})};i(),o||(r=null,i()),o||(gt.b.error('No track found for running audio group-ID: '+this.audioGroupId),this.hls.trigger(ct.a.ERROR,{type:pt.b.MEDIA_ERROR,details:pt.a.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))}},t.prototype._needsTrackLoading=function(e){var t=e.details;return!t||!!t.live||void 0},t.prototype._loadTrackDetailsIfNeeded=function(e){if(this._needsTrackLoading(e)){var t=e.url,a=e.id;gt.b.log('loading audio-track playlist for id: '+a),this.hls.trigger(ct.a.AUDIO_TRACK_LOADING,{url:t,id:a})}},t.prototype._updateTrack=function(e){if(!(0>e||e>=this.tracks.length)){this.clearInterval(),this._trackId=e,gt.b.log('trying to update audio-track '+e);var t=this.tracks[e];this._loadTrackDetailsIfNeeded(t)}},t.prototype._handleLoadError=function(){this.trackIdBlacklist[this._trackId]=!0;var e=this._trackId,t=this.tracks[e],a=t.name,r=t.language,n=t.groupId;gt.b.warn('Loading failed on audio track id: '+e+', group-id: '+n+', name/language: "'+a+'" / "'+r+'"');for(var o=e,d=0;d<this.tracks.length;d++)if(!this.trackIdBlacklist[d]){var s=this.tracks[d];if(s.name===a){o=d;break}}return o===e?void gt.b.warn('No fallback audio-track found for name/language: "'+a+'" / "'+r+'"'):void(gt.b.log('Attempting audio-track fallback id:',o,'group-id:',this.tracks[o].groupId),this._setAudioTrack(o))},Ga(t,[{key:'audioTracks',get:function(){return this.tracks}},{key:'audioTrack',get:function(){return this._trackId},set:function(e){this._setAudioTrack(e),this._selectDefaultTrack=!1}}]),t}(pa),Ha=function(){function e(e,t){for(var a=0,r;a<t.length;a++)r=t[a],r.enumerable=r.enumerable||!1,r.configurable=!0,'value'in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),Va=window,Wa=Va.performance,Ya={STOPPED:'STOPPED',STARTING:'STARTING',IDLE:'IDLE',PAUSED:'PAUSED',KEY_LOADING:'KEY_LOADING',FRAG_LOADING:'FRAG_LOADING',FRAG_LOADING_WAITING_RETRY:'FRAG_LOADING_WAITING_RETRY',WAITING_TRACK:'WAITING_TRACK',PARSING:'PARSING',PARSED:'PARSED',BUFFER_FLUSHING:'BUFFER_FLUSHING',ENDED:'ENDED',ERROR:'ERROR',WAITING_INIT_PTS:'WAITING_INIT_PTS'},qa=function(e){function t(a,r){Ie(this,t);var n=Oe(this,e.call(this,a,ct.a.MEDIA_ATTACHED,ct.a.MEDIA_DETACHING,ct.a.AUDIO_TRACKS_UPDATED,ct.a.AUDIO_TRACK_SWITCHING,ct.a.AUDIO_TRACK_LOADED,ct.a.KEY_LOADED,ct.a.FRAG_LOADED,ct.a.FRAG_PARSING_INIT_SEGMENT,ct.a.FRAG_PARSING_DATA,ct.a.FRAG_PARSED,ct.a.ERROR,ct.a.BUFFER_RESET,ct.a.BUFFER_CREATED,ct.a.BUFFER_APPENDED,ct.a.BUFFER_FLUSHED,ct.a.INIT_PTS_FOUND));return n.fragmentTracker=r,n.config=a.config,n.audioCodecSwap=!1,n._state=Ya.STOPPED,n.initPTS=[],n.waitingFragment=null,n.videoTrackCC=null,n}return Fe(t,e),t.prototype.onHandlerDestroying=function(){this.stopLoad(),e.prototype.onHandlerDestroying.call(this)},t.prototype.onHandlerDestroyed=function(){this.state=Ya.STOPPED,this.fragmentTracker=null,e.prototype.onHandlerDestroyed.call(this)},t.prototype.onInitPtsFound=function(e){var t=e.id,a=e.frag.cc,r=e.initPTS;'main'===t&&(this.initPTS[a]=r,this.videoTrackCC=a,gt.b.log('InitPTS for cc: '+a+' found from video track: '+r),this.state===Ya.WAITING_INIT_PTS&&this.tick())},t.prototype.startLoad=function(e){if(this.tracks){var t=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,0<t&&-1===e?(gt.b.log('audio:override startPosition with lastCurrentTime @'+t.toFixed(3)),this.state=Ya.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:e,this.state=Ya.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=e,this.state=Ya.STOPPED},t.prototype.stopLoad=function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragmentTracker.removeFragment(e),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=Ya.STOPPED},t.prototype.doTick=function(){var e=this.hls,t=e.config,a,r,n;switch(this.state){case Ya.ERROR:case Ya.PAUSED:case Ya.BUFFER_FLUSHING:break;case Ya.STARTING:this.state=Ya.WAITING_TRACK,this.loadedmetadata=!1;break;case Ya.IDLE:var o=this.tracks;if(!o)break;if(!this.media&&(this.startFragRequested||!t.startFragPrefetch))break;if(this.loadedmetadata)a=this.media.currentTime;else if(a=this.nextLoadPosition,void 0===a)break;var i=this.mediaBuffer?this.mediaBuffer:this.media,d=this.videoBuffer?this.videoBuffer:this.media,s=Zt.bufferInfo(i,a,t.maxBufferHole),l=Zt.bufferInfo(d,a,t.maxBufferHole),p=s.len,u=s.end,c=this.fragPrevious,g=A(t.maxBufferLength,t.maxMaxBufferLength),f=R(g,l.len),y=this.audioSwitch,m=this.trackId;if((p<f||y)&&m<o.length){if(n=o[m].details,'undefined'==typeof n){this.state=Ya.WAITING_TRACK;break}if(!y&&!n.live&&c&&c.sn===n.endSN&&!s.nextStart&&(!this.media.seeking||this.media.duration-u<c.duration/2)){this.hls.trigger(ct.a.BUFFER_EOS,{type:'audio'}),this.state=Ya.ENDED;break}var h=n.fragments,v=h.length,E=h[0].start,b=h[v-1].start+h[v-1].duration,T;if(y)if(n.live&&!n.PTSKnown)gt.b.log('switching audiotrack, live stream, unknown PTS,load first fragment'),u=0;else if(u=a,n.PTSKnown&&a<E)if(s.end>E||s.nextStart)gt.b.log('alt audio track ahead of main track, seek to start of alt audio track'),this.media.currentTime=E+.05;else return;if(n.initSegment&&!n.initSegment.data)T=n.initSegment;else if(!(u<=E)){var S=void 0,_=t.maxFragLookUpTolerance,k=c?h[c.sn-h[0].sn+1]:void 0,L=function(e){var t=A(_,e.duration);return e.start+e.duration-t<=u?1:e.start-t>u&&e.start?-1:0};u<b?(u>b-_&&(_=0),S=k&&!L(k)?k:Qt.search(h,L)):S=h[v-1],S&&(T=S,E=S.start,c&&T.level===c.level&&T.sn===c.sn&&(T.sn<n.endSN?(T=h[T.sn+1-n.startSN],gt.b.log('SN just loaded, load next one: '+T.sn)):T=null))}else if(T=h[0],null!==this.videoTrackCC&&T.cc!==this.videoTrackCC&&(T=G(h,this.videoTrackCC)),n.live&&T.loadIdx&&T.loadIdx===this.fragLoadIdx){var D=s.nextStart?s.nextStart:E;return gt.b.log('no alt audio available @currentTime:'+this.media.currentTime+', seeking @'+(D+.05)),void(this.media.currentTime=D+.05)}T&&(T.encrypted?(gt.b.log('Loading key for '+T.sn+' of ['+n.startSN+' ,'+n.endSN+'],track '+m),this.state=Ya.KEY_LOADING,e.trigger(ct.a.KEY_LOADING,{frag:T})):(gt.b.log('Loading '+T.sn+', cc: '+T.cc+' of ['+n.startSN+' ,'+n.endSN+'],track '+m+', currentTime:'+a+',bufferEnd:'+u.toFixed(3)),(y||this.fragmentTracker.getState(T)===zt.NOT_LOADED)&&(this.fragCurrent=T,this.startFragRequested=!0,Object(ut.a)(T.sn)&&(this.nextLoadPosition=T.start+T.duration),e.trigger(ct.a.FRAG_LOADING,{frag:T}),this.state=Ya.FRAG_LOADING)))}break;case Ya.WAITING_TRACK:r=this.tracks[this.trackId],r&&r.details&&(this.state=Ya.IDLE);break;case Ya.FRAG_LOADING_WAITING_RETRY:var P=Wa.now(),C=this.retryDate;i=this.media;var I=i&&i.seeking;(!C||P>=C||I)&&(gt.b.log('audioStreamController: retryDate reached, switch back to IDLE state'),this.state=Ya.IDLE);break;case Ya.WAITING_INIT_PTS:var O=this.videoTrackCC;if(void 0===this.initPTS[O])break;var F=this.waitingFragment;if(F){var x=F.frag.cc;O===x?(this.state=Ya.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null):(r=this.tracks[this.trackId],r.details&&r.details.live&&(gt.b.warn('Waiting fragment CC ('+x+') does not match video track CC ('+O+')'),this.waitingFragment=null,this.state=Ya.IDLE))}else this.state=Ya.IDLE;break;case Ya.STOPPED:case Ya.FRAG_LOADING:case Ya.PARSING:case Ya.PARSED:case Ya.ENDED:break;default:}},t.prototype.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener('seeking',this.onvseeking),t.addEventListener('ended',this.onvended);var a=this.config;this.tracks&&a.autoStartLoad&&this.startLoad(a.startPosition)},t.prototype.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(gt.b.log('MSE detaching and video ended, reset startPosition'),this.startPosition=this.lastCurrentTime=0),e&&(e.removeEventListener('seeking',this.onvseeking),e.removeEventListener('ended',this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.stopLoad()},t.prototype.onMediaSeeking=function(){this.state===Ya.ENDED&&(this.state=Ya.IDLE),this.media&&(this.lastCurrentTime=this.media.currentTime),this.tick()},t.prototype.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},t.prototype.onAudioTracksUpdated=function(e){gt.b.log('audio tracks updated'),this.tracks=e.audioTracks},t.prototype.onAudioTrackSwitching=function(e){var t=!!e.url;this.trackId=e.id,this.fragCurrent=null,this.state=Ya.PAUSED,this.waitingFragment=null,t?this.setInterval(100):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),t&&(this.audioSwitch=!0,this.state=Ya.IDLE),this.tick()},t.prototype.onAudioTrackLoaded=function(e){var t=e.details,a=e.id,r=this.tracks[a],n=t.totalduration,o=0;if(gt.b.log('track '+a+' loaded ['+t.startSN+','+t.endSN+'],duration:'+n),t.live){var i=r.details;i&&0<t.fragments.length?(U(i,t),o=t.fragments[0].start,t.PTSKnown?gt.b.log('live audio playlist sliding:'+o.toFixed(3)):gt.b.log('live audio playlist - outdated PTS, unknown sliding')):(t.PTSKnown=!1,gt.b.log('live audio playlist - first load, unknown sliding'))}else t.PTSKnown=!1;if(r.details=t,!this.startFragRequested){if(-1===this.startPosition){var d=t.startTimeOffset;Object(ut.a)(d)?(gt.b.log('start time offset found in playlist, adjust startPosition to '+d),this.startPosition=d):this.startPosition=0}this.nextLoadPosition=this.startPosition}this.state===Ya.WAITING_TRACK&&(this.state=Ya.IDLE),this.tick()},t.prototype.onKeyLoaded=function(){this.state===Ya.KEY_LOADING&&(this.state=Ya.IDLE,this.tick())},t.prototype.onFragLoaded=function(e){var t=this.fragCurrent,a=e.frag;if(this.state===Ya.FRAG_LOADING&&t&&'audio'===a.type&&a.level===t.level&&a.sn===t.sn){var r=this.tracks[this.trackId],n=r.details,o=n.totalduration,i=t.level,d=t.sn,s=t.cc,l=this.config.defaultAudioCodec||r.audioCodec||'mp4a.40.2',p=this.stats=e.stats;if('initSegment'===d)this.state=Ya.IDLE,p.tparsed=p.tbuffered=Wa.now(),n.initSegment.data=e.payload,this.hls.trigger(ct.a.FRAG_BUFFERED,{stats:p,frag:t,id:'audio'}),this.tick();else{this.state=Ya.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new da(this.hls,'audio'));var u=this.initPTS[s],c=n.initSegment?n.initSegment.data:[];if(n.initSegment||void 0!==u){this.pendingBuffering=!0,gt.b.log('Demuxing '+d+' of ['+n.startSN+' ,'+n.endSN+'],track '+i);this.demuxer.push(e.payload,c,l,null,t,o,!1,u)}else gt.b.log('unknown video PTS for continuity counter '+s+', waiting for video PTS before demuxing audio frag '+d+' of ['+n.startSN+' ,'+n.endSN+'],track '+i),this.waitingFragment=e,this.state=Ya.WAITING_INIT_PTS}}this.fragLoadError=0},t.prototype.onFragParsingInitSegment=function(e){var t=this.fragCurrent,a=e.frag;if(t&&'audio'===e.id&&a.sn===t.sn&&a.level===t.level&&this.state===Ya.PARSING){var r=e.tracks,n;if(r.video&&delete r.video,n=r.audio,n){n.levelCodec=n.codec,n.id=e.id,this.hls.trigger(ct.a.BUFFER_CODECS,r),gt.b.log('audio track:audio,container:'+n.container+',codecs[level/parsed]=['+n.levelCodec+'/'+n.codec+']');var o=n.initSegment;if(o){var i={type:'audio',data:o,parent:'audio',content:'initSegment'};this.audioSwitch?this.pendingData=[i]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(ct.a.BUFFER_APPENDING,i))}this.tick()}}},t.prototype.onFragParsingData=function(e){var t=this,a=this.fragCurrent,r=e.frag;if(a&&'audio'===e.id&&'audio'===e.type&&r.sn===a.sn&&r.level===a.level&&this.state===Ya.PARSING){var n=this.trackId,o=this.tracks[n],i=this.hls;Object(ut.a)(e.endPTS)||(e.endPTS=e.startPTS+a.duration,e.endDTS=e.startDTS+a.duration),a.addElementaryStream(Rt.ElementaryStreamTypes.AUDIO),gt.b.log('parsed '+e.type+',PTS:['+e.startPTS.toFixed(3)+','+e.endPTS.toFixed(3)+'],DTS:['+e.startDTS.toFixed(3)+'/'+e.endDTS.toFixed(3)+'],nb:'+e.nb),M(o.details,a,e.startPTS,e.endPTS);var d=this.audioSwitch,s=this.media,l=!1;if(d&&s)if(s.readyState){var p=s.currentTime;gt.b.log('switching audio track : currentTime:'+p),p>=e.startPTS&&(gt.b.log('switching audio track : flushing all audio'),this.state=Ya.BUFFER_FLUSHING,i.trigger(ct.a.BUFFER_FLUSHING,{startOffset:0,endOffset:it,type:'audio'}),l=!0,this.audioSwitch=!1,i.trigger(ct.a.AUDIO_TRACK_SWITCHED,{id:n}))}else this.audioSwitch=!1,i.trigger(ct.a.AUDIO_TRACK_SWITCHED,{id:n});var u=this.pendingData;if(!u)return gt.b.warn('Apparently attempt to enqueue media payload without codec initialization data upfront'),void i.trigger(ct.a.ERROR,{type:pt.b.MEDIA_ERROR,details:null,fatal:!0});this.audioSwitch||([e.data1,e.data2].forEach(function(t){t&&t.length&&u.push({type:e.type,data:t,parent:'audio',content:'data'})}),!l&&u.length&&(u.forEach(function(e){t.state===Ya.PARSING&&(t.pendingBuffering=!0,t.hls.trigger(ct.a.BUFFER_APPENDING,e))}),this.pendingData=[],this.appended=!0)),this.tick()}},t.prototype.onFragParsed=function(e){var t=this.fragCurrent,a=e.frag;t&&'audio'===e.id&&a.sn===t.sn&&a.level===t.level&&this.state===Ya.PARSING&&(this.stats.tparsed=Wa.now(),this.state=Ya.PARSED,this._checkAppendedParsed())},t.prototype.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},t.prototype.onBufferCreated=function(e){var t=e.tracks.audio;t&&(this.mediaBuffer=t.buffer,this.loadedmetadata=!0),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer)},t.prototype.onBufferAppended=function(e){if('audio'===e.parent){var t=this.state;(t===Ya.PARSING||t===Ya.PARSED)&&(this.pendingBuffering=0<e.pending,this._checkAppendedParsed())}},t.prototype._checkAppendedParsed=function(){if(this.state===Ya.PARSED&&(!this.appended||!this.pendingBuffering)){var e=this.fragCurrent,t=this.stats,a=this.hls;if(e){this.fragPrevious=e,t.tbuffered=Wa.now(),a.trigger(ct.a.FRAG_BUFFERED,{stats:t,frag:e,id:'audio'});var r=this.mediaBuffer?this.mediaBuffer:this.media;gt.b.log('audio buffered : '+sa.toString(r.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,a.trigger(ct.a.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=Ya.IDLE}this.tick()}},t.prototype.onError=function(e){var t=e.frag;if(!(t&&'audio'!==t.type))switch(e.details){case pt.a.FRAG_LOAD_ERROR:case pt.a.FRAG_LOAD_TIMEOUT:var a=e.frag;if(a&&'audio'!==a.type)break;if(!e.fatal){var r=this.fragLoadError;r?r++:r=1;var n=this.config;if(r<=n.fragLoadingMaxRetry){this.fragLoadError=r;var o=A(ot(2,r-1)*n.fragLoadingRetryDelay,n.fragLoadingMaxRetryTimeout);gt.b.warn('AudioStreamController: frag loading failed, retry in '+o+' ms'),this.retryDate=Wa.now()+o,this.state=Ya.FRAG_LOADING_WAITING_RETRY}else gt.b.error('AudioStreamController: '+e.details+' reaches max retry, redispatch as fatal ...'),e.fatal=!0,this.state=Ya.ERROR}break;case pt.a.AUDIO_TRACK_LOAD_ERROR:case pt.a.AUDIO_TRACK_LOAD_TIMEOUT:case pt.a.KEY_LOAD_ERROR:case pt.a.KEY_LOAD_TIMEOUT:this.state!==Ya.ERROR&&(this.state=e.fatal?Ya.ERROR:Ya.IDLE,gt.b.warn('AudioStreamController: '+e.details+' while loading frag, now switching to '+this.state+' state ...'));break;case pt.a.BUFFER_FULL_ERROR:if('audio'===e.parent&&(this.state===Ya.PARSING||this.state===Ya.PARSED)){var i=this.mediaBuffer,d=this.media.currentTime,s=i&&Zt.isBuffered(i,d)&&Zt.isBuffered(i,d+.5);if(s){var l=this.config;l.maxMaxBufferLength>=l.maxBufferLength&&(l.maxMaxBufferLength/=2,gt.b.warn('AudioStreamController: reduce max buffer length to '+l.maxMaxBufferLength+'s')),this.state=Ya.IDLE}else gt.b.warn('AudioStreamController: buffer full error also media.currentTime is not buffered, flush audio buffer'),this.fragCurrent=null,this.state=Ya.BUFFER_FLUSHING,this.hls.trigger(ct.a.BUFFER_FLUSHING,{startOffset:0,endOffset:it,type:'audio'})}break;default:}},t.prototype.onBufferFlushed=function(){var e=this,t=this.pendingData;t&&t.length?(gt.b.log('AudioStreamController: appending pending audio data after buffer flushed'),t.forEach(function(t){e.hls.trigger(ct.a.BUFFER_APPENDING,t)}),this.appended=!0,this.pendingData=[],this.state=Ya.PARSED):(this.state=Ya.IDLE,this.fragPrevious=null,this.tick())},Ha(t,[{key:'state',set:function(e){if(this.state!==e){var t=this.state;this._state=e,gt.b.log('audio stream:'+t+'->'+e)}},get:function(){return this._state}}]),t}(pa),ja=function(){function e(e){if('string'!=typeof e)return!1;var t=n[e.toLowerCase()];return!!t&&e.toLowerCase()}function t(e){if('string'!=typeof e)return!1;var t=o[e.toLowerCase()];return!!t&&e.toLowerCase()}function a(e){for(var t=1,a;t<arguments.length;t++)for(var r in a=arguments[t],a)e[r]=a[r];return e}function r(r,n,o){var i=this,d=function(){return'undefined'==typeof navigator?void 0:/MSIE\s8\.0/.test(navigator.userAgent)}(),s={};d?i=document.createElement('custom'):s.enumerable=!0,i.hasBeenReset=!1;var l='',p=!1,u=r,c=n,g=o,f=null,y='',m=!0,h='auto',v='start',E=50,b='middle',T=50,S='middle';if(Object.defineProperty(i,'id',a({},s,{get:function(){return l},set:function(e){l=''+e}})),Object.defineProperty(i,'pauseOnExit',a({},s,{get:function(){return p},set:function(e){p=!!e}})),Object.defineProperty(i,'startTime',a({},s,{get:function(){return u},set:function(e){if('number'!=typeof e)throw new TypeError('Start time must be set to a number.');u=e,this.hasBeenReset=!0}})),Object.defineProperty(i,'endTime',a({},s,{get:function(){return c},set:function(e){if('number'!=typeof e)throw new TypeError('End time must be set to a number.');c=e,this.hasBeenReset=!0}})),Object.defineProperty(i,'text',a({},s,{get:function(){return g},set:function(e){g=''+e,this.hasBeenReset=!0}})),Object.defineProperty(i,'region',a({},s,{get:function(){return f},set:function(e){f=e,this.hasBeenReset=!0}})),Object.defineProperty(i,'vertical',a({},s,{get:function(){return y},set:function(t){var a=e(t);if(!1===a)throw new SyntaxError('An invalid or illegal string was specified.');y=a,this.hasBeenReset=!0}})),Object.defineProperty(i,'snapToLines',a({},s,{get:function(){return m},set:function(e){m=!!e,this.hasBeenReset=!0}})),Object.defineProperty(i,'line',a({},s,{get:function(){return h},set:function(e){if('number'!=typeof e&&'auto'!==e)throw new SyntaxError('An invalid number or illegal string was specified.');h=e,this.hasBeenReset=!0}})),Object.defineProperty(i,'lineAlign',a({},s,{get:function(){return v},set:function(e){var a=t(e);if(!a)throw new SyntaxError('An invalid or illegal string was specified.');v=a,this.hasBeenReset=!0}})),Object.defineProperty(i,'position',a({},s,{get:function(){return E},set:function(e){if(0>e||100<e)throw new Error('Position must be between 0 and 100.');E=e,this.hasBeenReset=!0}})),Object.defineProperty(i,'positionAlign',a({},s,{get:function(){return b},set:function(e){var a=t(e);if(!a)throw new SyntaxError('An invalid or illegal string was specified.');b=a,this.hasBeenReset=!0}})),Object.defineProperty(i,'size',a({},s,{get:function(){return T},set:function(e){if(0>e||100<e)throw new Error('Size must be between 0 and 100.');T=e,this.hasBeenReset=!0}})),Object.defineProperty(i,'align',a({},s,{get:function(){return S},set:function(e){var a=t(e);if(!a)throw new SyntaxError('An invalid or illegal string was specified.');S=a,this.hasBeenReset=!0}})),i.displayState=void 0,d)return i}if('undefined'!=typeof window&&window.VTTCue)return window.VTTCue;var n={"":!0,lr:!0,rl:!0},o={start:!0,middle:!0,end:!0,left:!0,right:!0};return r.prototype.getCueAsHTML=function(){var e=window.WebVTT;return e.convertCueToDOMTree(window,this.text)},r}(),za=function(){return{decode:function(e){if(!e)return'';if('string'!=typeof e)throw new Error('Error - expected string data.');return decodeURIComponent(encodeURIComponent(e))}}};we.prototype={set:function(e,t){this.get(e)||''===t||(this.values[e]=t)},get:function(e,t,a){return a?this.has(e)?this.values[e]:t[a]:this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,r){for(var a=0;a<r.length;++a)if(t===r[a]){this.set(e,t);break}},integer:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},percent:function(e,t){var a;return!!((a=t.match(/^([\d]{1,3})(\.[\d]*)?%$/))&&(t=parseFloat(t),0<=t&&100>=t))&&(this.set(e,t),!0)}};var Xa=new ja(0,0,0),Qa='middle'===Xa.align?'middle':'center';xe.prototype={parse:function(e){function t(){var e=r.buffer,t=0;for(e=Be(e);t<e.length&&'\r'!==e[t]&&'\n'!==e[t];)++t;var a=e.substr(0,t);return'\r'===e[t]&&++t,'\n'===e[t]&&++t,r.buffer=e.substr(t),a}function a(e){Me(e,function(){},/:/)}var r=this;e&&(r.buffer+=r.decoder.decode(e,{stream:!0}));try{var n;if('INITIAL'===r.state){if(!/\r\n|\n/.test(r.buffer))return this;n=t();var o=n.match(/^()?WEBVTT([ \t].*)?$/);if(!o||!o[0])throw new Error('Malformed WebVTT signature.');r.state='HEADER'}for(var i=!1;r.buffer;){if(!/\r\n|\n/.test(r.buffer))return this;switch(i?i=!1:n=t(),r.state){case'HEADER':/:/.test(n)?a(n):!n&&(r.state='ID');continue;case'NOTE':n||(r.state='ID');continue;case'ID':if(/^NOTE($|[ \t])/.test(n)){r.state='NOTE';break}if(!n)continue;if(r.cue=new ja(0,0,''),r.state='CUE',-1===n.indexOf('-->')){r.cue.id=n;continue}case'CUE':try{Ue(n,r.cue,r.regionList)}catch(t){r.cue=null,r.state='BADCUE';continue}r.state='CUETEXT';continue;case'CUETEXT':var d=-1!==n.indexOf('-->');if(!n||d&&(i=!0)){r.oncue&&r.oncue(r.cue),r.cue=null,r.state='ID';continue}r.cue.text&&(r.cue.text+='\n'),r.cue.text+=n;continue;case'BADCUE':n||(r.state='ID');continue;}}}catch(t){'CUETEXT'===r.state&&r.cue&&r.oncue&&r.oncue(r.cue),r.cue=null,r.state='INITIAL'===r.state?'BADWEBVTT':'BADCUE'}return this},flush:function(){var e=this;try{if(e.buffer+=e.decoder.decode(),(e.cue||'HEADER'===e.state)&&(e.buffer+='\n\n',e.parse()),'INITIAL'===e.state)throw new Error('Malformed WebVTT signature.')}catch(t){throw t}return e.onflush&&e.onflush(),this}};var Za={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Ja=function(e){var t=e;return Za.hasOwnProperty(e)&&(t=Za[e]),D(t)},$a={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},er={17:2,18:4,21:6,22:8,23:10,19:13,20:15},tr={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},ar={25:2,26:4,29:6,30:8,31:10,27:13,28:15},rr=['white','green','blue','cyan','red','yellow','magenta','black','transparent'],nr={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(e){this.time=e},log:function(e){var t=this.verboseFilter[e];if(this.verboseLevel>=t);}},or=function(e){for(var t=[],a=0;a<e.length;a++)t.push(e[a].toString(16));return t},ir=function(){function e(t,a,r,n,o){Ke(this,e),this.foreground=t||'white',this.underline=a||!1,this.italics=r||!1,this.background=n||'black',this.flash=o||!1}return e.prototype.reset=function(){this.foreground='white',this.underline=!1,this.italics=!1,this.background='black',this.flash=!1},e.prototype.setStyles=function(e){for(var t=['foreground','underline','italics','background','flash'],a=0,r;a<t.length;a++)r=t[a],e.hasOwnProperty(r)&&(this[r]=e[r])},e.prototype.isDefault=function(){return'white'===this.foreground&&!this.underline&&!this.italics&&'black'===this.background&&!this.flash},e.prototype.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},e.prototype.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},e.prototype.toString=function(){return'color='+this.foreground+', underline='+this.underline+', italics='+this.italics+', background='+this.background+', flash='+this.flash},e}(),dr=function(){function e(t,a,r,n,o,i){Ke(this,e),this.uchar=t||' ',this.penState=new ir(a,r,n,o,i)}return e.prototype.reset=function(){this.uchar=' ',this.penState.reset()},e.prototype.setChar=function(e,t){this.uchar=e,this.penState.copy(t)},e.prototype.setPenState=function(e){this.penState.copy(e)},e.prototype.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},e.prototype.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},e.prototype.isEmpty=function(){return' '===this.uchar&&this.penState.isDefault()},e}(),sr=function(){function e(){Ke(this,e),this.chars=[];for(var t=0;100>t;t++)this.chars.push(new dr);this.pos=0,this.currPenState=new ir}return e.prototype.equals=function(e){for(var t=!0,a=0;100>a;a++)if(!this.chars[a].equals(e.chars[a])){t=!1;break}return t},e.prototype.copy=function(e){for(var t=0;100>t;t++)this.chars[t].copy(e.chars[t])},e.prototype.isEmpty=function(){for(var e=!0,t=0;100>t;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},e.prototype.setCursor=function(e){this.pos!==e&&(this.pos=e),0>this.pos?(nr.log('ERROR','Negative cursor position '+this.pos),this.pos=0):100<this.pos&&(nr.log('ERROR','Too large cursor position '+this.pos),this.pos=100)},e.prototype.moveCursor=function(e){var t=this.pos+e;if(1<e)for(var a=this.pos+1;a<t+1;a++)this.chars[a].setPenState(this.currPenState);this.setCursor(t)},e.prototype.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(' ',this.currPenState)},e.prototype.insertChar=function(e){144<=e&&this.backSpace();var t=Ja(e);return 100<=this.pos?void nr.log('ERROR','Cannot insert '+e.toString(16)+' ('+t+') at position '+this.pos+'. Skipping it!'):void(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))},e.prototype.clearFromPos=function(e){var t;for(t=e;100>t;t++)this.chars[t].reset()},e.prototype.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},e.prototype.clearToEndOfRow=function(){this.clearFromPos(this.pos)},e.prototype.getTextString=function(){for(var e=[],t=!0,a=0,r;100>a;a++)r=this.chars[a].uchar,' '!==r&&(t=!1),e.push(r);return t?'':e.join('')},e.prototype.setPenStyles=function(e){this.currPenState.setStyles(e);var t=this.chars[this.pos];t.setPenState(this.currPenState)},e}(),lr=function(){function e(){Ke(this,e),this.rows=[];for(var t=0;15>t;t++)this.rows.push(new sr);this.currRow=14,this.nrRollUpRows=null,this.reset()}return e.prototype.reset=function(){for(var e=0;15>e;e++)this.rows[e].clear();this.currRow=14},e.prototype.equals=function(e){for(var t=!0,a=0;15>a;a++)if(!this.rows[a].equals(e.rows[a])){t=!1;break}return t},e.prototype.copy=function(e){for(var t=0;15>t;t++)this.rows[t].copy(e.rows[t])},e.prototype.isEmpty=function(){for(var e=!0,t=0;15>t;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},e.prototype.backSpace=function(){var e=this.rows[this.currRow];e.backSpace()},e.prototype.clearToEndOfRow=function(){var e=this.rows[this.currRow];e.clearToEndOfRow()},e.prototype.insertChar=function(e){var t=this.rows[this.currRow];t.insertChar(e)},e.prototype.setPen=function(e){var t=this.rows[this.currRow];t.setPenStyles(e)},e.prototype.moveCursor=function(e){var t=this.rows[this.currRow];t.moveCursor(e)},e.prototype.setCursor=function(e){nr.log('INFO','setCursor: '+e);var t=this.rows[this.currRow];t.setCursor(e)},e.prototype.setPAC=function(e){nr.log('INFO','pacData = '+JSON.stringify(e));var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var a=0;15>a;a++)this.rows[a].clear();var r=this.currRow+1-this.nrRollUpRows,n=this.lastOutputScreen;if(n){var o=n.rows[r].cueStartTime;if(o&&o<nr.time)for(var d=0;d<this.nrRollUpRows;d++)this.rows[t-this.nrRollUpRows+d+1].copy(n.rows[r+d])}}this.currRow=t;var s=this.rows[this.currRow];if(null!==e.indent){var l=e.indent,p=R(l-1,0);s.setCursor(e.indent),e.color=s.chars[p].penState.foreground}var u={foreground:e.color,underline:e.underline,italics:e.italics,background:'black',flash:!1};this.setPen(u)},e.prototype.setBkgData=function(e){nr.log('INFO','bkgData = '+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)},e.prototype.setRollUpRows=function(e){this.nrRollUpRows=e},e.prototype.rollUp=function(){if(null===this.nrRollUpRows)return void nr.log('DEBUG','roll_up but nrRollUpRows not set yet');nr.log('TEXT',this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),nr.log('INFO','Rolling up')},e.prototype.getDisplayText=function(e){e=e||!1;for(var t=[],a='',r=-1,n=0,o;15>n;n++)o=this.rows[n].getTextString(),o&&(r=n+1,e?t.push('Row '+r+': \''+o+'\''):t.push(o.trim()));return 0<t.length&&(e?a='['+t.join(' | ')+']':a=t.join('\n')),a},e.prototype.getTextAndFormat=function(){return this.rows},e}(),pr=function(){function e(t,a){Ke(this,e),this.chNr=t,this.outputFilter=a,this.mode=null,this.verbose=0,this.displayedMemory=new lr,this.nonDisplayedMemory=new lr,this.lastOutputScreen=new lr,this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return e.prototype.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},e.prototype.getHandler=function(){return this.outputFilter},e.prototype.setHandler=function(e){this.outputFilter=e},e.prototype.setPAC=function(e){this.writeScreen.setPAC(e)},e.prototype.setBkgData=function(e){this.writeScreen.setBkgData(e)},e.prototype.setMode=function(e){e===this.mode||(this.mode=e,nr.log('INFO','MODE='+e),'MODE_POP-ON'===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),'MODE_ROLL-UP'!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},e.prototype.insertChars=function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var a=this.writeScreen===this.displayedMemory?'DISP':'NON_DISP';nr.log('INFO',a+': '+this.writeScreen.getDisplayText(!0)),('MODE_PAINT-ON'===this.mode||'MODE_ROLL-UP'===this.mode)&&(nr.log('TEXT','DISPLAYED: '+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},e.prototype.ccRCL=function(){nr.log('INFO','RCL - Resume Caption Loading'),this.setMode('MODE_POP-ON')},e.prototype.ccBS=function(){nr.log('INFO','BS - BackSpace'),'MODE_TEXT'===this.mode||(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},e.prototype.ccAOF=function(){},e.prototype.ccAON=function(){},e.prototype.ccDER=function(){nr.log('INFO','DER- Delete to End of Row'),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},e.prototype.ccRU=function(e){nr.log('INFO','RU('+e+') - Roll Up'),this.writeScreen=this.displayedMemory,this.setMode('MODE_ROLL-UP'),this.writeScreen.setRollUpRows(e)},e.prototype.ccFON=function(){nr.log('INFO','FON - Flash On'),this.writeScreen.setPen({flash:!0})},e.prototype.ccRDC=function(){nr.log('INFO','RDC - Resume Direct Captioning'),this.setMode('MODE_PAINT-ON')},e.prototype.ccTR=function(){nr.log('INFO','TR'),this.setMode('MODE_TEXT')},e.prototype.ccRTD=function(){nr.log('INFO','RTD'),this.setMode('MODE_TEXT')},e.prototype.ccEDM=function(){nr.log('INFO','EDM - Erase Displayed Memory'),this.displayedMemory.reset(),this.outputDataUpdate(!0)},e.prototype.ccCR=function(){nr.log('CR - Carriage Return'),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},e.prototype.ccENM=function(){nr.log('INFO','ENM - Erase Non-displayed Memory'),this.nonDisplayedMemory.reset()},e.prototype.ccEOC=function(){if(nr.log('INFO','EOC - End Of Caption'),'MODE_POP-ON'===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,nr.log('TEXT','DISP: '+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},e.prototype.ccTO=function(e){nr.log('INFO','TO('+e+') - Tab Offset'),this.writeScreen.moveCursor(e)},e.prototype.ccMIDROW=function(e){var t={flash:!1,underline:1==e%2,italics:46<=e};if(!t.italics){var a=L(e/2)-16;t.foreground=['white','green','blue','cyan','red','yellow','magenta'][a]}else t.foreground='white';nr.log('INFO','MIDROW: '+JSON.stringify(t)),this.writeScreen.setPen(t)},e.prototype.outputDataUpdate=function(){var e=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],a=nr.time},e.prototype.cueSplitAtTime=function(e){this.outputFilter&&!this.displayedMemory.isEmpty()&&(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e)},e}(),ur=function(){function e(t,a,r){Ke(this,e),this.field=t||1,this.outputs=[a,r],this.channels=[new pr(1,a),new pr(2,r)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}return e.prototype.getHandler=function(e){return this.channels[e].getHandler()},e.prototype.setHandler=function(e,t){this.channels[e].setHandler(t)},e.prototype.addData=function(e,t){var r=!1,n,o,d;this.lastTime=e,nr.setTime(e);for(var s=0;s<t.length;s+=2){if(o=127&t[s],d=127&t[s+1],0===o&&0===d){this.dataCounters.padding+=2;continue}else nr.log('DATA','['+or([t[s],t[s+1]])+'] -> ('+or([o,d])+')');if(n=this.parseCmd(o,d),n||(n=this.parseMidrow(o,d)),n||(n=this.parsePAC(o,d)),n||(n=this.parseBackgroundAttributes(o,d)),!n&&(r=this.parseChars(o,d),r))if(this.currChNr&&0<=this.currChNr){var l=this.channels[this.currChNr-1];l.insertChars(r)}else nr.log('WARNING','No channel found yet. TEXT-MODE?');n?this.dataCounters.cmd+=2:r?this.dataCounters.char+=2:(this.dataCounters.other+=2,nr.log('WARNING','Couldn\'t parse cleaned data '+or([o,d])+' orig: '+or([t[s],t[s+1]])))}},e.prototype.parseCmd=function(e,t){var a=null;if(!((20===e||28===e)&&32<=t&&47>=t||(23===e||31===e)&&33<=t&&35>=t))return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,nr.log('DEBUG','Repeated command ('+or([e,t])+') is dropped'),!0;a=20===e||23===e?1:2;var r=this.channels[a-1];return 20===e||28===e?32===t?r.ccRCL():33===t?r.ccBS():34===t?r.ccAOF():35===t?r.ccAON():36===t?r.ccDER():37===t?r.ccRU(2):38===t?r.ccRU(3):39===t?r.ccRU(4):40===t?r.ccFON():41===t?r.ccRDC():42===t?r.ccTR():43===t?r.ccRTD():44===t?r.ccEDM():45===t?r.ccCR():46===t?r.ccENM():47==t&&r.ccEOC():r.ccTO(t-32),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=a,!0},e.prototype.parseMidrow=function(e,t){var a=null;if((17===e||25===e)&&32<=t&&47>=t){if(a=17===e?1:2,a!==this.currChNr)return nr.log('ERROR','Mismatch channel in midrow parsing'),!1;var r=this.channels[a-1];return r.ccMIDROW(t),nr.log('DEBUG','MIDROW ('+or([e,t])+')'),!0}return!1},e.prototype.parsePAC=function(e,t){var a=null,r=null;if(!((17<=e&&23>=e||25<=e&&31>=e)&&64<=t&&127>=t||(16===e||24===e)&&64<=t&&95>=t))return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;a=23>=e?1:2,r=64<=t&&95>=t?1===a?$a[e]:tr[e]:1===a?er[e]:ar[e];var n=this.interpretPAC(r,t),o=this.channels[a-1];return o.setPAC(n),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=a,!0},e.prototype.interpretPAC=function(e,t){var a=t,r={color:null,italics:!1,indent:null,underline:!1,row:e};return a=95<t?t-96:t-64,r.underline=1==(1&a),13>=a?r.color=['white','green','blue','cyan','red','yellow','magenta','white'][L(a/2)]:15>=a?(r.italics=!0,r.color='white'):r.indent=4*L((a-16)/2),r},e.prototype.parseChars=function(e,t){var a=null,r=null,n=null;if(25<=e?(a=2,n=e-8):(a=1,n=e),17<=n&&19>=n){var o=t;o=17===n?t+80:18===n?t+112:t+144,nr.log('INFO','Special char \''+Ja(o)+'\' in channel '+a),r=[o]}else 32<=e&&127>=e&&(r=0===t?[e]:[e,t]);if(r){var i=or(r);nr.log('DEBUG','Char codes =  '+i.join(',')),this.lastCmdA=null,this.lastCmdB=null}return r},e.prototype.parseBackgroundAttributes=function(e,t){var a=void 0,r=void 0,n=void 0,o=void 0;return!!((16===e||24===e)&&32<=t&&47>=t||(23===e||31===e)&&45<=t&&47>=t)&&(a={},16===e||24===e?(r=L((t-32)/2),a.background=rr[r],1==t%2&&(a.background+='_semi')):45===t?a.background='transparent':(a.foreground='black',47==t&&(a.underline=!0)),n=24>e?1:2,o=this.channels[n-1],o.setBkgData(a),this.lastCmdA=null,this.lastCmdB=null,!0)},e.prototype.reset=function(){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].reset();this.lastCmdA=null,this.lastCmdB=null},e.prototype.cueSplitAtTime=function(e){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].cueSplitAtTime(e)},e}(),cr=function(){function e(t,a){He(this,e),this.timelineController=t,this.trackName=a,this.startTime=null,this.endTime=null,this.screen=null}return e.prototype.dispatchCue=function(){null===this.startTime||(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen),this.startTime=null)},e.prototype.newCue=function(e,t,a){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=a,this.timelineController.createCaptionsTrack(this.trackName)},e}(),gr=cr,fr=function(e,t,a){return e.substr(a||0,t.length)===t},yr=function(e){var t=parseInt(e.substr(-3)),a=parseInt(e.substr(-6,2)),r=parseInt(e.substr(-9,2)),n=9<e.length?parseInt(e.substr(0,e.indexOf(':'))):0;return Object(ut.a)(t)&&Object(ut.a)(a)&&Object(ut.a)(r)&&Object(ut.a)(n)?(t+=1e3*a,t+=60000*r,t+=3600000*n,t):-1},mr=function(e){for(var t=5381,a=e.length;a;)t=33*t^e.charCodeAt(--a);return(t>>>0).toString()},hr=function(e,t,a){var r=e[t],n=e[r.prevCC];if(!n||!n.new&&r.new)return e.ccOffset=e.presentationOffset=r.start,void(r.new=!1);for(;n&&n.new;)e.ccOffset+=r.start-n.start,r.new=!1,r=n,n=e[r.prevCC];e.presentationOffset=a},vr={parse:function(e,t,a,r,n,o){var i=/\r\n|\n\r|\n|\r/g,d=Object(ba.b)(new Uint8Array(e)).trim().replace(i,'\n').split('\n'),s='00:00.000',l=0,p=0,u=0,c=[],g=void 0,f=!0,y=new xe;y.oncue=function(e){var t=a[r],n=a.ccOffset;t&&t.new&&(p===void 0?hr(a,r,u):n=a.ccOffset=t.start),u&&(n=u+a.ccOffset-a.presentationOffset),e.startTime+=n-p,e.endTime+=n-p,e.id=mr(e.startTime.toString())+mr(e.endTime.toString())+mr(e.text),e.text=decodeURIComponent(encodeURIComponent(e.text)),0<e.endTime&&c.push(e)},y.onparsingerror=function(t){g=t},y.onflush=function(){return g&&o?void o(g):void n(c)},d.forEach(function(e){if(f){if(fr(e,'X-TIMESTAMP-MAP=')){f=!1,e.substr(16).split(',').forEach(function(e){fr(e,'LOCAL:')?s=e.substr(6):fr(e,'MPEGTS:')&&(l=parseInt(e.substr(7)))});try{t=0>t?t+8589934592:t,l-=t,p=yr(s)/1e3,u=l/9e4,-1==p&&(g=new Error('Malformed X-TIMESTAMP-MAP: '+e))}catch(t){g=new Error('Malformed X-TIMESTAMP-MAP: '+e)}return}''===e&&(f=!1)}y.parse(e+'\n')}),y.flush()}},Er=function(e){function t(a){Ve(this,t);var r=We(this,e.call(this,a,ct.a.MEDIA_ATTACHING,ct.a.MEDIA_DETACHING,ct.a.FRAG_PARSING_USERDATA,ct.a.FRAG_DECRYPTED,ct.a.MANIFEST_LOADING,ct.a.MANIFEST_LOADED,ct.a.FRAG_LOADED,ct.a.LEVEL_SWITCHING,ct.a.INIT_PTS_FOUND));if(r.hls=a,r.config=a.config,r.enabled=!0,r.Cues=a.config.cueHandler,r.textTracks=[],r.tracks=[],r.unparsedVttFrags=[],r.initPTS=void 0,r.cueRanges=[],r.captionsTracks={},r.captionsProperties={textTrack1:{label:r.config.captionsTextTrack1Label,languageCode:r.config.captionsTextTrack1LanguageCode},textTrack2:{label:r.config.captionsTextTrack2Label,languageCode:r.config.captionsTextTrack2LanguageCode}},r.config.enableCEA708Captions){var n=new gr(r,'textTrack1'),o=new gr(r,'textTrack2');r.cea608Parser=new ur(0,n,o)}return r}return Ye(t,e),t.prototype.addCues=function(e,t,a,r){for(var n=this.cueRanges,o=!1,d=n.length;d--;){var s=n[d],l=je(s[0],s[1],t,a);if(0<=l&&(s[0]=A(s[0],t),s[1]=R(s[1],a),o=!0,.5<l/(a-t)))return}o||n.push([t,a]),this.Cues.newCue(this.captionsTracks[e],t,a,r)},t.prototype.onInitPtsFound=function(e){var t=this;'undefined'==typeof this.initPTS&&(this.initPTS=e.initPTS),this.unparsedVttFrags.length&&(this.unparsedVttFrags.forEach(function(e){t.onFragLoaded(e)}),this.unparsedVttFrags=[])},t.prototype.getExistingTrack=function(e){var t=this.media;if(t)for(var a=0,r;a<t.textTracks.length;a++)if(r=t.textTracks[a],r[e])return r;return null},t.prototype.createCaptionsTrack=function(e){var t=this.captionsProperties[e],a=t.label,r=t.languageCode,n=this.captionsTracks;if(!n[e]){var o=this.getExistingTrack(e);if(!o){var i=this.createTextTrack('captions',a,r);i&&(i[e]=!0,n[e]=i)}else n[e]=o,se(n[e]),de(n[e],this.media)}},t.prototype.createTextTrack=function(e,t,a){var r=this.media;if(r)return r.addTextTrack(e,t,a)},t.prototype.destroy=function(){ht.prototype.destroy.call(this)},t.prototype.onMediaAttaching=function(e){this.media=e.media,this._cleanTracks()},t.prototype.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach(function(t){se(e[t]),delete e[t]})},t.prototype.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0},this._cleanTracks()},t.prototype._cleanTracks=function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var a=0;a<t.length;a++)se(t[a])}},t.prototype.onManifestLoaded=function(e){var t=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=void 0,this.cueRanges=[],this.config.enableWebVTT){this.tracks=e.subtitles||[];var a=this.media?this.media.textTracks:[];this.tracks.forEach(function(e,r){var n;if(r<a.length){var o=a[r];qe(o,e)&&(n=o)}n||(n=t.createTextTrack('subtitles',e.name,e.lang)),n.mode=e.default?t.hls.subtitleDisplay?'showing':'hidden':'disabled',t.textTracks.push(n)})}},t.prototype.onLevelSwitching=function(){this.enabled='NONE'!==this.hls.currentLevel.closedCaptions},t.prototype.onFragLoaded=function(e){var t=e.frag,a=e.payload;if('main'===t.type){var r=t.sn;if(r!==this.lastSn+1){var n=this.cea608Parser;n&&n.reset()}this.lastSn=r}else if('subtitle'===t.type)if(a.byteLength){if('undefined'==typeof this.initPTS)return void this.unparsedVttFrags.push(e);var o=t.decryptdata;(null==o||null==o.key||'AES-128'!==o.method)&&this._parseVTTs(t,a)}else this.hls.trigger(ct.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})},t.prototype._parseVTTs=function(t,e){var a=this.vttCCs;a[t.cc]||(a[t.cc]={start:t.start,prevCC:this.prevCC,new:!0},this.prevCC=t.cc);var r=this.textTracks,n=this.hls;vr.parse(e,this.initPTS,a,t.cc,function(e){var a=r[t.trackId];return'disabled'===a.mode?void n.trigger(ct.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t}):void(e.forEach(function(e){if(!a.cues.getCueById(e.id))try{a.addCue(e)}catch(r){var t=new window.TextTrackCue(e.startTime,e.endTime,e.text);t.id=e.id,a.addCue(t)}}),n.trigger(ct.a.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t}))},function(a){gt.b.log('Failed to parse VTT cue: '+a),n.trigger(ct.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})})},t.prototype.onFragDecrypted=function(e){var t=e.payload,a=e.frag;if('subtitle'===a.type){if('undefined'==typeof this.initPTS)return void this.unparsedVttFrags.push(e);this._parseVTTs(a,t)}},t.prototype.onFragParsingUserdata=function(e){if(this.enabled&&this.config.enableCEA708Captions)for(var t=0,a;t<e.samples.length;t++)a=this.extractCea608Data(e.samples[t].bytes),this.cea608Parser.addData(e.samples[t].pts,a)},t.prototype.extractCea608Data=function(e){for(var t=31&e[0],a=2,r=void 0,n=void 0,o=void 0,i=void 0,d=void 0,s=[],l=0;l<t;l++)(r=e[a++],n=127&e[a++],o=127&e[a++],i=0!=(4&r),d=3&r,0!==n||0!==o)&&i&&0===d&&(s.push(n),s.push(o));return s},t}(ht),br=function(){function e(e,t){for(var a=0,r;a<t.length;a++)r=t[a],r.enumerable=r.enumerable||!1,r.configurable=!0,'value'in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),Tr=function(e){function t(a){ze(this,t);var r=Xe(this,e.call(this,a,ct.a.MEDIA_ATTACHED,ct.a.MEDIA_DETACHING,ct.a.MANIFEST_LOADING,ct.a.MANIFEST_LOADED,ct.a.SUBTITLE_TRACK_LOADED));return r.tracks=[],r.trackId=-1,r.media=null,r.subtitleDisplay=!0,r}return Qe(t,e),t.prototype._onTextTracksChanged=function(){if(this.media){for(var e=-1,t=Ze(this.media.textTracks),a=0;a<t.length;a++)if('hidden'===t[a].mode)e=a;else if('showing'===t[a].mode){e=a;break}this.subtitleTrack=e}},t.prototype.destroy=function(){ht.prototype.destroy.call(this)},t.prototype.onMediaAttached=function(e){var t=this;this.media=e.media,this.media&&(this.queuedDefaultTrack&&(this.subtitleTrack=this.queuedDefaultTrack,delete this.queuedDefaultTrack),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&'onchange'in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval(function(){t.trackChangeListener()},500):this.media.textTracks.addEventListener('change',this.trackChangeListener))},t.prototype.onMediaDetaching=function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener('change',this.trackChangeListener),this.media=null)},t.prototype.onManifestLoading=function(){this.tracks=[],this.trackId=-1},t.prototype.onManifestLoaded=function(e){var t=this,a=e.subtitles||[];this.tracks=a,this.trackId=-1,this.hls.trigger(ct.a.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:a}),a.forEach(function(e){e.default&&(t.media?t.subtitleTrack=e.id:t.queuedDefaultTrack=e.id)})},t.prototype.onTick=function(){var e=this.trackId,t=this.tracks[e];if(t){var a=t.details;(!a||a.live)&&(gt.b.log('(re)loading playlist for subtitle track '+e),this.hls.trigger(ct.a.SUBTITLE_TRACK_LOADING,{url:t.url,id:e}))}},t.prototype.onSubtitleTrackLoaded=function(e){var t=this;e.id<this.tracks.length&&(gt.b.log('subtitle track '+e.id+' loaded'),this.tracks[e.id].details=e.details,e.details.live&&!this.timer&&(this.timer=setInterval(function(){t.onTick()},1e3*e.details.targetduration,this)),!e.details.live&&this.timer&&this._stopTimer())},t.prototype.setSubtitleTrackInternal=function(e){var t=this.hls,a=this.tracks;if(!('number'!=typeof e||-1>e||e>=a.length)&&(this._stopTimer(),this.trackId=e,gt.b.log('switching to subtitle track '+e),t.trigger(ct.a.SUBTITLE_TRACK_SWITCH,{id:e}),-1!==e)){var r=a[e],n=r.details;(!n||n.live)&&(gt.b.log('(re)loading playlist for subtitle track '+e),t.trigger(ct.a.SUBTITLE_TRACK_LOADING,{url:r.url,id:e}))}},t.prototype._stopTimer=function(){this.timer&&(clearInterval(this.timer),this.timer=null)},t.prototype._toggleTrackModes=function(e){var t=this.media,a=this.subtitleDisplay,r=this.trackId;if(t){var n=Ze(t.textTracks);if(-1===e)[].slice.call(n).forEach(function(e){e.mode='disabled'});else{var o=n[r];o&&(o.mode='disabled')}var i=n[e];i&&(i.mode=a?'showing':'hidden')}},br(t,[{key:'subtitleTracks',get:function(){return this.tracks}},{key:'subtitleTrack',get:function(){return this.trackId},set:function(e){this.trackId!==e&&(this._toggleTrackModes(e),this.setSubtitleTrackInternal(e))}}]),t}(ht),Sr=r(8),_r=window,Rr=_r.performance,Ar={STOPPED:'STOPPED',IDLE:'IDLE',KEY_LOADING:'KEY_LOADING',FRAG_LOADING:'FRAG_LOADING'},kr=function(e){function t(a){Je(this,t);var r=$e(this,e.call(this,a,ct.a.MEDIA_ATTACHED,ct.a.ERROR,ct.a.KEY_LOADED,ct.a.FRAG_LOADED,ct.a.SUBTITLE_TRACKS_UPDATED,ct.a.SUBTITLE_TRACK_SWITCH,ct.a.SUBTITLE_TRACK_LOADED,ct.a.SUBTITLE_FRAG_PROCESSED));return r.config=a.config,r.vttFragSNsProcessed={},r.vttFragQueues=void 0,r.currentlyProcessing=null,r.state=Ar.STOPPED,r.currentTrackId=-1,r.decrypter=new Sr.a(a.observer,a.config),r}return et(t,e),t.prototype.onHandlerDestroyed=function(){this.state=Ar.STOPPED},t.prototype.clearVttFragQueues=function(){var e=this;this.vttFragQueues={},this.tracks.forEach(function(t){e.vttFragQueues[t.id]=[]})},t.prototype.nextFrag=function(){if(null===this.currentlyProcessing&&-1<this.currentTrackId&&this.vttFragQueues[this.currentTrackId].length){var e=this.currentlyProcessing=this.vttFragQueues[this.currentTrackId].shift();this.fragCurrent=e,this.hls.trigger(ct.a.FRAG_LOADING,{frag:e}),this.state=Ar.FRAG_LOADING}},t.prototype.onSubtitleFragProcessed=function(e){e.success&&this.vttFragSNsProcessed[e.frag.trackId].push(e.frag.sn),this.currentlyProcessing=null,this.state=Ar.IDLE,this.nextFrag()},t.prototype.onMediaAttached=function(){this.state=Ar.IDLE},t.prototype.onError=function(e){var t=e.frag;t&&'subtitle'!==t.type||this.currentlyProcessing&&(this.currentlyProcessing=null,this.nextFrag())},t.prototype.doTick=function(){var e=this;switch(this.state){case Ar.IDLE:var t=this.tracks,a=this.currentTrackId,r=this.vttFragSNsProcessed[a],n=this.vttFragQueues[a],o=this.currentlyProcessing?this.currentlyProcessing.sn:-1,i=function(e){return-1<r.indexOf(e.sn)},d=function(e){return n.some(function(t){return t.sn===e.sn})};if(!t)break;var s;if(a<t.length&&(s=t[a].details),'undefined'==typeof s)break;s.fragments.forEach(function(t){i(t)||t.sn===o||d(t)||(t.encrypted?(gt.b.log('Loading key for '+t.sn),e.state=Ar.KEY_LOADING,e.hls.trigger(ct.a.KEY_LOADING,{frag:t})):(t.trackId=a,n.push(t),e.nextFrag()))});}},t.prototype.onSubtitleTracksUpdated=function(e){var t=this;gt.b.log('subtitle tracks updated'),this.tracks=e.subtitleTracks,this.clearVttFragQueues(),this.vttFragSNsProcessed={},this.tracks.forEach(function(e){t.vttFragSNsProcessed[e.id]=[]})},t.prototype.onSubtitleTrackSwitch=function(e){if(this.currentTrackId=e.id,this.tracks&&-1!==this.currentTrackId){var t=this.tracks[this.currentTrackId];t&&t.details&&this.tick()}},t.prototype.onSubtitleTrackLoaded=function(){this.tick()},t.prototype.onKeyLoaded=function(){this.state===Ar.KEY_LOADING&&(this.state=Ar.IDLE,this.tick())},t.prototype.onFragLoaded=function(e){var t=this.fragCurrent,a=e.frag.decryptdata,r=e.frag,n=this.hls;if(this.state===Ar.FRAG_LOADING&&t&&'subtitle'===e.frag.type&&t.sn===e.frag.sn&&0<e.payload.byteLength&&null!=a&&null!=a.key&&'AES-128'===a.method){var o;try{o=Rr.now()}catch(e){o=Date.now()}this.decrypter.decrypt(e.payload,a.key.buffer,a.iv.buffer,function(e){var t;try{t=Rr.now()}catch(e){t=Date.now()}n.trigger(ct.a.FRAG_DECRYPTED,{frag:r,payload:e,stats:{tstart:o,tdecrypt:t}})})}},t}(pa),Lr=function(){function e(e,t){for(var a=0,r;a<t.length;a++)r=t[a],r.enumerable=r.enumerable||!1,r.configurable=!0,'value'in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),Dr=window,Pr=Dr.XMLHttpRequest,Cr={WIDEVINE:'com.widevine.alpha',PLAYREADY:'com.microsoft.playready'},Ir=function(e,t){var a={videoCapabilities:[]};return t.forEach(function(e){a.videoCapabilities.push({contentType:'video/mp4; codecs="'+e+'"'})}),[a]},Or=function(e,t,a){switch(e){case Cr.WIDEVINE:return Ir(t,a);default:throw Error('Unknown key-system: '+e);}},Fr=function(e){function t(a){tt(this,t);var r=at(this,e.call(this,a,ct.a.MEDIA_ATTACHED,ct.a.MANIFEST_PARSED));return r._widevineLicenseUrl=a.config.widevineLicenseUrl,r._licenseXhrSetup=a.config.licenseXhrSetup,r._emeEnabled=a.config.emeEnabled,r._requestMediaKeySystemAccess=a.config.requestMediaKeySystemAccessFunc,r._mediaKeysList=[],r._media=null,r._hasSetMediaKeys=!1,r._isMediaEncrypted=!1,r._requestLicenseFailureCount=0,r}return rt(t,e),t.prototype.getLicenseServerUrl=function(e){var t;return t=e===Cr.WIDEVINE?this._widevineLicenseUrl:null,t||(gt.b.error('No license server URL configured for key-system "'+e+'"'),this.hls.trigger(ct.a.ERROR,{type:pt.b.KEY_SYSTEM_ERROR,details:pt.a.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})),t},t.prototype._attemptKeySystemAccess=function(e,t,a){var r=this,n=Or(e,t,a);return n?void(gt.b.log('Requesting encrypted media key-system access'),this.requestMediaKeySystemAccess(e,n).then(function(t){r._onMediaKeySystemAccessObtained(e,t)}).catch(function(t){gt.b.error('Failed to obtain key-system "'+e+'" access:',t)})):void gt.b.warn('Can not create config for key-system (maybe because platform is not supported):',e)},t.prototype._onMediaKeySystemAccessObtained=function(e,t){var a=this;gt.b.log('Access for key-system "'+e+'" obtained');var r={mediaKeys:null,mediaKeysSession:null,mediaKeysSessionInitialized:!1,mediaKeySystemAccess:t,mediaKeySystemDomain:e};this._mediaKeysList.push(r),t.createMediaKeys().then(function(t){r.mediaKeys=t,gt.b.log('Media-keys created for key-system "'+e+'"'),a._onMediaKeysCreated()}).catch(function(e){gt.b.error('Failed to create media-keys:',e)})},t.prototype._onMediaKeysCreated=function(){var e=this;this._mediaKeysList.forEach(function(t){t.mediaKeysSession||(t.mediaKeysSession=t.mediaKeys.createSession(),e._onNewMediaKeySession(t.mediaKeysSession))})},t.prototype._onNewMediaKeySession=function(e){var t=this;gt.b.log('New key-system session '+e.sessionId),e.addEventListener('message',function(a){t._onKeySessionMessage(e,a.message)},!1)},t.prototype._onKeySessionMessage=function(e,t){gt.b.log('Got EME message event, creating license request'),this._requestLicense(t,function(t){gt.b.log('Received license data, updating key-session'),e.update(t)})},t.prototype._onMediaEncrypted=function(e,t){gt.b.log('Media is encrypted using "'+e+'" init data type'),this._isMediaEncrypted=!0,this._mediaEncryptionInitDataType=e,this._mediaEncryptionInitData=t,this._attemptSetMediaKeys(),this._generateRequestWithPreferredKeySession()},t.prototype._attemptSetMediaKeys=function(){if(!this._hasSetMediaKeys){var e=this._mediaKeysList[0];if(!e||!e.mediaKeys)return gt.b.error('Fatal: Media is encrypted but no CDM access or no keys have been obtained yet'),void this.hls.trigger(ct.a.ERROR,{type:pt.b.KEY_SYSTEM_ERROR,details:pt.a.KEY_SYSTEM_NO_KEYS,fatal:!0});gt.b.log('Setting keys for encrypted media'),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0}},t.prototype._generateRequestWithPreferredKeySession=function(){var e=this,t=this._mediaKeysList[0];if(!t)return gt.b.error('Fatal: Media is encrypted but not any key-system access has been obtained yet'),void this.hls.trigger(ct.a.ERROR,{type:pt.b.KEY_SYSTEM_ERROR,details:pt.a.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(t.mediaKeysSessionInitialized)return void gt.b.warn('Key-Session already initialized but requested again');var a=t.mediaKeysSession;a||(gt.b.error('Fatal: Media is encrypted but no key-session existing'),this.hls.trigger(ct.a.ERROR,{type:pt.b.KEY_SYSTEM_ERROR,details:pt.a.KEY_SYSTEM_NO_SESSION,fatal:!0}));var r=this._mediaEncryptionInitDataType,n=this._mediaEncryptionInitData;gt.b.log('Generating key-session request for "'+r+'" init data type'),t.mediaKeysSessionInitialized=!0,a.generateRequest(r,n).then(function(){gt.b.debug('Key-session generation succeeded')}).catch(function(t){gt.b.error('Error generating key-session request:',t),e.hls.trigger(ct.a.ERROR,{type:pt.b.KEY_SYSTEM_ERROR,details:pt.a.KEY_SYSTEM_NO_SESSION,fatal:!1})})},t.prototype._createLicenseXhr=function(e,t,a){var r=new Pr,n=this._licenseXhrSetup;try{if(n)try{n(r,e)}catch(t){r.open('POST',e,!0),n(r,e)}r.readyState||r.open('POST',e,!0)}catch(t){return gt.b.error('Error setting up key-system license XHR',t),void this.hls.trigger(ct.a.ERROR,{type:pt.b.KEY_SYSTEM_ERROR,details:pt.a.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}return r.responseType='arraybuffer',r.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,r,e,t,a),r},t.prototype._onLicenseRequestReadyStageChange=function(e,t,a,r){switch(e.readyState){case 4:if(200===e.status)this._requestLicenseFailureCount=0,gt.b.log('License request succeeded'),r(e.response);else{if(gt.b.error('License Request XHR failed ('+t+'). Status: '+e.status+' ('+e.statusText+')'),this._requestLicenseFailureCount++,3>=this._requestLicenseFailureCount){var n=3-this._requestLicenseFailureCount+1;return gt.b.warn('Retrying license request, '+n+' attempts left'),void this._requestLicense(a,r)}this.hls.trigger(ct.a.ERROR,{type:pt.b.KEY_SYSTEM_ERROR,details:pt.a.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}}},t.prototype._generateLicenseRequestChallenge=function(e,t){var a;return e.mediaKeySystemDomain===Cr.PLAYREADY?gt.b.error('PlayReady is not supported (yet)'):e.mediaKeySystemDomain===Cr.WIDEVINE?a=t:gt.b.error('Unsupported key-system:',e.mediaKeySystemDomain),a},t.prototype._requestLicense=function(e,t){gt.b.log('Requesting content license for key-system');var a=this._mediaKeysList[0];if(!a)return gt.b.error('Fatal error: Media is encrypted but no key-system access has been obtained yet'),void this.hls.trigger(ct.a.ERROR,{type:pt.b.KEY_SYSTEM_ERROR,details:pt.a.KEY_SYSTEM_NO_ACCESS,fatal:!0});var r=this.getLicenseServerUrl(a.mediaKeySystemDomain),n=this._createLicenseXhr(r,e,t);gt.b.log('Sending license request to URL: '+r),n.send(this._generateLicenseRequestChallenge(a,e))},t.prototype.onMediaAttached=function(e){var t=this;if(this._emeEnabled){var a=e.media;this._media=a,a.addEventListener('encrypted',function(a){t._onMediaEncrypted(a.initDataType,a.initData)})}},t.prototype.onManifestParsed=function(e){if(this._emeEnabled){var t=e.levels.map(function(e){return e.audioCodec}),a=e.levels.map(function(e){return e.videoCodec});this._attemptKeySystemAccess(Cr.WIDEVINE,t,a)}},Lr(t,[{key:'requestMediaKeySystemAccess',get:function(){if(!this._requestMediaKeySystemAccess)throw new Error('No requestMediaKeySystemAccess function configured');return this._requestMediaKeySystemAccess}}]),t}(ht),xr=function(){return'undefined'!=typeof window&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null}(),Nr={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:60000000,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:Ba,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:Da,bufferController:Ca,capLevelController:Oa,fpsController:Na,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,requestMediaKeySystemAccessFunc:xr};Nr.subtitleStreamController=kr,Nr.subtitleTrackController=Tr,Nr.timelineController=Er,Nr.cueHandler=dt,Nr.enableCEA708Captions=!0,Nr.enableWebVTT=!0,Nr.captionsTextTrack1Label='English',Nr.captionsTextTrack1LanguageCode='en',Nr.captionsTextTrack2Label='Spanish',Nr.captionsTextTrack2LanguageCode='es',Nr.audioStreamController=qa,Nr.audioTrackController=Ka,Nr.emeController=Fr;var wr=function(){function e(e,t){for(var a=0,r;a<t.length;a++)r=t[a],r.enumerable=r.enumerable||!1,r.configurable=!0,'value'in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}();r(14);var Mr=function(){function e(){var t=this,a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};nt(this,e);var r=e.DefaultConfig;if((a.liveSyncDurationCount||a.liveMaxLatencyDurationCount)&&(a.liveSyncDuration||a.liveMaxLatencyDuration))throw new Error('Illegal hls.js config: don\'t mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration');for(var n in r)n in a||(a[n]=r[n]);if(void 0!==a.liveMaxLatencyDurationCount&&a.liveMaxLatencyDurationCount<=a.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==a.liveMaxLatencyDuration&&(a.liveMaxLatencyDuration<=a.liveSyncDuration||void 0===a.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');Object(gt.a)(a.debug),this.config=a,this._autoLevelCapping=-1;var o=this.observer=new $t.a;o.trigger=function(e){for(var t=arguments.length,a=Array(1<t?t-1:0),r=1;r<t;r++)a[r-1]=arguments[r];o.emit.apply(o,[e,e].concat(a))},o.off=function(e){for(var t=arguments.length,a=Array(1<t?t-1:0),r=1;r<t;r++)a[r-1]=arguments[r];o.removeListener.apply(o,[e].concat(a))},this.on=o.on.bind(o),this.off=o.off.bind(o),this.once=o.once.bind(o),this.trigger=o.trigger.bind(o);var i=this.abrController=new a.abrController(this),d=new a.bufferController(this),s=new a.capLevelController(this),l=new a.fpsController(this),p=new Yt(this),u=new qt(this),c=new jt(this),g=new Ta(this),f=this.levelController=new Ea(this),y=new Xt(this),m=this.streamController=new fa(this,y),h=[f,m],v=a.audioStreamController;v&&h.push(new v(this,y)),this.networkControllers=h;var E=[p,u,c,i,d,s,l,g,y];if(v=a.audioTrackController,v){var b=new v(this);this.audioTrackController=b,E.push(b)}if(v=a.subtitleTrackController,v){var T=new v(this);this.subtitleTrackController=T,E.push(T)}if(v=a.emeController,v){var S=new v(this);this.emeController=S,E.push(S)}[a.subtitleStreamController,a.timelineController].forEach(function(e){e&&E.push(new e(t))}),this.coreComponents=E}return e.isSupported=function(){return ce()},wr(e,null,[{key:'version',get:function(){return'0.11.0'}},{key:'Events',get:function(){return ct.a}},{key:'ErrorTypes',get:function(){return pt.b}},{key:'ErrorDetails',get:function(){return pt.a}},{key:'DefaultConfig',get:function(){return e.defaultConfig?e.defaultConfig:Nr},set:function(t){e.defaultConfig=t}}]),e.prototype.destroy=function(){gt.b.log('destroy'),this.trigger(ct.a.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(e){e.destroy()}),this.url=null,this.observer.removeAllListeners(),this._autoLevelCapping=-1},e.prototype.attachMedia=function(e){gt.b.log('attachMedia'),this.media=e,this.trigger(ct.a.MEDIA_ATTACHING,{media:e})},e.prototype.detachMedia=function(){gt.b.log('detachMedia'),this.trigger(ct.a.MEDIA_DETACHING),this.media=null},e.prototype.loadSource=function(e){e=lt.a.buildAbsoluteURL(window.location.href,e,{alwaysNormalize:!0}),gt.b.log('loadSource:'+e),this.url=e,this.trigger(ct.a.MANIFEST_LOADING,{url:e})},e.prototype.startLoad=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:-1;gt.b.log('startLoad('+e+')'),this.networkControllers.forEach(function(t){t.startLoad(e)})},e.prototype.stopLoad=function(){gt.b.log('stopLoad'),this.networkControllers.forEach(function(e){e.stopLoad()})},e.prototype.swapAudioCodec=function(){gt.b.log('swapAudioCodec'),this.streamController.swapAudioCodec()},e.prototype.recoverMediaError=function(){gt.b.log('recoverMediaError');var e=this.media;this.detachMedia(),this.attachMedia(e)},wr(e,[{key:'levels',get:function(){return this.levelController.levels}},{key:'currentLevel',get:function(){return this.streamController.currentLevel},set:function(e){gt.b.log('set currentLevel:'+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()}},{key:'nextLevel',get:function(){return this.streamController.nextLevel},set:function(e){gt.b.log('set nextLevel:'+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:'loadLevel',get:function(){return this.levelController.level},set:function(e){gt.b.log('set loadLevel:'+e),this.levelController.manualLevel=e}},{key:'nextLoadLevel',get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:'firstLevel',get:function(){return R(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){gt.b.log('set firstLevel:'+e),this.levelController.firstLevel=e}},{key:'startLevel',get:function(){return this.levelController.startLevel},set:function(e){gt.b.log('set startLevel:'+e);var t=this;-1!==e&&(e=R(e,t.minAutoLevel)),t.levelController.startLevel=e}},{key:'autoLevelCapping',get:function(){return this._autoLevelCapping},set:function(e){gt.b.log('set autoLevelCapping:'+e),this._autoLevelCapping=e}},{key:'autoLevelEnabled',get:function(){return-1===this.levelController.manualLevel}},{key:'manualLevel',get:function(){return this.levelController.manualLevel}},{key:'minAutoLevel',get:function(){for(var e=this,t=e.levels,a=e.config.minAutoBitrate,r=t?t.length:0,n=0,o;n<r;n++)if(o=t[n].realBitrate?R(t[n].realBitrate,t[n].bitrate):t[n].bitrate,o>a)return n;return 0}},{key:'maxAutoLevel',get:function(){var e=this,t=e.levels,a=e.autoLevelCapping,r=void 0;return r=-1===a&&t&&t.length?t.length-1:a,r}},{key:'nextAutoLevel',get:function(){var e=this;return A(R(e.abrController.nextAutoLevel,e.minAutoLevel),e.maxAutoLevel)},set:function(e){var t=this;t.abrController.nextAutoLevel=R(t.minAutoLevel,e)}},{key:'audioTracks',get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:'audioTrack',get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:'liveSyncPosition',get:function(){return this.streamController.liveSyncPosition}},{key:'subtitleTracks',get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:'subtitleTrack',get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:'subtitleDisplay',get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}}]),e}(),Ur=a['default']=Mr},function(e,t,a){function r(e){function t(r){if(a[r])return a[r].exports;var n=a[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var a={};t.m=e,t.c=a,t.i=function(e){return e},t.d=function(e,a,r){t.o(e,a)||Object.defineProperty(e,a,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var a=e&&e.__esModule?function(){return e['default']}:function(){return e};return t.d(a,'a',a),a},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p='/',t.oe=function(e){throw console.error(e),e};var r=t(t.s=ENTRY_MODULE);return r.default||r}function n(e){return(e+'').replace(/[.?*+^$[\]\\(){}|-]/g,'\\$&')}function o(e,t,r){var o={};o[r]=[];var i=t.toString(),d=i.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/);if(!d)return o;for(var s=d[1],l=new RegExp('(\\\\n|\\W)'+n(s)+'\\((/\\*.*?\\*/)?s?.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)','g'),p;p=l.exec(i);)'dll-reference'!==p[3]&&o[r].push(p[3]);for(l=new RegExp('\\('+n(s)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\((/\\*.*?\\*/)?s?.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)','g');p=l.exec(i);)e[p[2]]||(o[r].push(p[1]),e[p[2]]=a(p[1]).m),o[p[2]]=o[p[2]]||[],o[p[2]].push(p[4]);return o}function d(e){var t=Object.keys(e);return t.reduce(function(t,a){return t||0<e[a].length},!1)}function i(e,t){for(var a={main:[t]},r={main:[]},n={main:{}};d(a);)for(var s=Object.keys(a),l=0;l<s.length;l++){var p=s[l],u=a[p],c=u.pop();if(n[p]=n[p]||{},!n[p][c]&&e[p][c]){n[p][c]=!0,r[p]=r[p]||[],r[p].push(c);for(var g=o(e,e[p][c],p),f=Object.keys(g),y=0;y<f.length;y++)a[f[y]]=a[f[y]]||[],a[f[y]]=a[f[y]].concat(g[f[y]])}}return r}e.exports=function(e,t){t=t||{};var n={main:a.m},o=t.all?{main:Object.keys(n)}:i(n,e),d='';Object.keys(o).filter(function(e){return'main'!==e}).forEach(function(e){for(var t=0;o[e][t];)t++;o[e].push(t),n[e][t]='(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })',d=d+'var '+e+' = ('+r.toString().replace('ENTRY_MODULE',JSON.stringify(t))+')({'+o[e].map(function(t){return''+JSON.stringify(t)+': '+n[e][t].toString()}).join(',')+'});\n'}),d=d+'('+r.toString().replace('ENTRY_MODULE',JSON.stringify(e))+')({'+o.main.map(function(e){return''+JSON.stringify(e)+': '+n.main[e].toString()}).join(',')+'})(self);';var s=new window.Blob([d],{type:'text/javascript'});if(t.bare)return s;var l=window.URL||window.webkitURL||window.mozURL||window.msURL,p=l.createObjectURL(s),u=new window.Worker(p);return u.objectURL=p,u}},function(e,t,a){Object.defineProperty(t,'__esModule',{value:!0});var r=a(10),n=a(1),o=a(0),i=a(7),d=a.n(i);t['default']=function(e){var t=new d.a;t.trigger=function(e){for(var a=arguments.length,r=Array(1<a?a-1:0),n=1;n<a;n++)r[n-1]=arguments[n];t.emit.apply(t,[e,e].concat(r))},t.off=function(e){for(var a=arguments.length,r=Array(1<a?a-1:0),n=1;n<a;n++)r[n-1]=arguments[n];t.removeListener.apply(t,[e].concat(r))};var a=function(t,a){e.postMessage({event:t,data:a})};e.addEventListener('message',function(n){var i=n.data;switch(i.cmd){case'init':var d=JSON.parse(i.config);e.demuxer=new r.a(t,i.typeSupported,d,i.vendor);try{Object(o.a)(!0===d.debug)}catch(e){console.warn('demuxerWorker: unable to enable logs')}a('init',null);break;case'demux':e.demuxer.push(i.data,i.decryptdata,i.initSegment,i.audioCodec,i.videoCodec,i.timeOffset,i.discontinuity,i.trackSwitch,i.contiguous,i.duration,i.accurateTimeOffset,i.defaultInitPTS);break;default:}}),t.on(n.a.FRAG_DECRYPTED,a),t.on(n.a.FRAG_PARSING_INIT_SEGMENT,a),t.on(n.a.FRAG_PARSED,a),t.on(n.a.ERROR,a),t.on(n.a.FRAG_PARSING_METADATA,a),t.on(n.a.FRAG_PARSING_USERDATA,a),t.on(n.a.INIT_PTS_FOUND,a),t.on(n.a.FRAG_PARSING_DATA,function(t,a){var r=[],n={event:t,data:a};a.data1&&(n.data1=a.data1.buffer,r.push(a.data1.buffer),delete a.data1),a.data2&&(n.data2=a.data2.buffer,r.push(a.data2.buffer),delete a.data2),e.postMessage(n,r)})}},function(){var e=String.prototype;e.endsWith||function(){var t=function(){try{var e={},t=Object.defineProperty,a=t(e,e,e)&&t}catch(e){}return a}(),a={}.toString,r=function(e){if(null==this)throw TypeError();var t=this+'';if(e&&'[object RegExp]'==a.call(e))throw TypeError();var r=t.length,n=e+'',o=n.length,i=r;if(1<arguments.length){var d=arguments[1];d!==void 0&&(i=d?+d:0,i!=i&&(i=0))}var s=A(R(i,0),r),l=s-o;if(0>l)return!1;for(var p=-1;++p<o;)if(t.charCodeAt(l+p)!=n.charCodeAt(p))return!1;return!0};t?t(String.prototype,'endsWith',{value:r,configurable:!0,writable:!0}):e.endsWith=r}()}])['default']})}),ie=function(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,'default')?e.default:e}(oe),de=function(e){function t(e,a){w(this,t);var r=G(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a));return r.hls=new ie,r}return B(t,e),M(t,[{key:'componentDidMount',value:function(){var e=this.props,t=e.src,a=e.video;ie.isSupported()&&(this.hls.loadSource(t),this.hls.attachMedia(a),this.hls.on(ie.Events.MANIFEST_PARSED,function(){a.play()}))}},{key:'componentWillUnmount',value:function(){this.hls&&this.hls.destroy()}},{key:'render',value:function(){return null}}]),t}(t.Component),se={actions:V.object,player:V.object},le=function(e){function t(e){return w(this,t),G(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return B(t,e),M(t,[{key:'shouldComponentUpdate',value:function(e){return e.player.paused!==this.props.player.paused}},{key:'handleClick',value:function(){var e=this.props,t=e.actions,a=e.player;a.paused?t.play():t.pause()}},{key:'render',value:function(){var e=this;return P.createElement('button',{className:W({"video-play-toggle-button":!0,"video-paused":this.props.player.paused},'video-control','tool-tip'),onClick:function(){return e.handleClick()},tabIndex:0},P.createElement('div',{className:'tool-tip-text top-center'},this.props.player.paused?'Ph\xE1t':'D\u1EEBng'))}}]),t}(P.Component),pe={className:V.string,onMouseDown:V.func,onMouseMove:V.func,stepForward:V.func,stepBack:V.func,sliderActive:V.func,sliderInactive:V.func,onMouseUp:V.func,onFocus:V.func,onBlur:V.func,onClick:V.func,getPercent:V.func,vertical:V.bool,children:V.node,label:V.string,valuenow:V.string,valuetext:V.string},ue=function(e){function t(e,a){w(this,t);var r=G(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a));return r.handleMouseDown=r.handleMouseDown.bind(r),r.handleMouseMove=r.handleMouseMove.bind(r),r.handleMouseUp=r.handleMouseUp.bind(r),r.handleFocus=r.handleFocus.bind(r),r.handleBlur=r.handleBlur.bind(r),r.handleClick=r.handleClick.bind(r),r.handleKeyPress=r.handleKeyPress.bind(r),r.stepForward=r.stepForward.bind(r),r.stepBack=r.stepBack.bind(r),r.calculateDistance=r.calculateDistance.bind(r),r.getProgress=r.getProgress.bind(r),r.renderChildren=r.renderChildren.bind(r),r.state={active:!1},r}return B(t,e),M(t,[{key:'getProgress',value:function(){var e=this.props.getPercent;if(!e)return 0;var t=e();return('number'!=typeof t||0>t||t===1/0)&&(t=0),t}},{key:'handleMouseDown',value:function(e){var t=this.props.onMouseDown;document.addEventListener('mousemove',this.handleMouseMove,!0),document.addEventListener('mouseup',this.handleMouseUp,!0),document.addEventListener('touchmove',this.handleMouseMove,!0),document.addEventListener('touchend',this.handleMouseUp,!0),this.setState({active:!0,distance:0}),this.props.sliderActive&&this.props.sliderActive(e),this.handleMouseMove(e),t&&t(e)}},{key:'handleMouseMove',value:function(e){var t=this.props.onMouseMove;t&&t(e)}},{key:'handleMouseUp',value:function(e){var t=this.props.onMouseUp;document.removeEventListener('mousemove',this.handleMouseMove,!0),document.removeEventListener('mouseup',this.handleMouseUp,!0),document.removeEventListener('touchmove',this.handleMouseMove,!0),document.removeEventListener('touchend',this.handleMouseUp,!0),this.setState({active:!1}),this.props.sliderInactive&&this.props.sliderInactive(e),t&&t(e)}},{key:'handleFocus',value:function(t){document.addEventListener('keydown',this.handleKeyPress,!0),this.props.onFocus&&this.props.onFocus(t)}},{key:'handleBlur',value:function(t){document.removeEventListener('keydown',this.handleKeyPress,!0),this.props.onBlur&&this.props.onBlur(t)}},{key:'handleClick',value:function(e){e.preventDefault(),this.props.onClick&&this.props.onClick(e)}},{key:'handleKeyPress',value:function(e){37===e.which||40===e.which?(e.preventDefault(),e.stopPropagation(),this.stepBack()):(38===e.which||39===e.which)&&(e.preventDefault(),e.stopPropagation(),this.stepForward())}},{key:'stepForward',value:function(){this.props.stepForward&&this.props.stepForward()}},{key:'stepBack',value:function(){this.props.stepBack&&this.props.stepBack()}},{key:'calculateDistance',value:function(e){var t=a.findDOMNode(this),r=m(t,e);return this.props.vertical?r.y:r.x}},{key:'renderChildren',value:function(){var e=this.getProgress(),t=(100*e).toFixed(2)+'%';return P.Children.map(this.props.children,function(a){return P.cloneElement(a,{progress:e,percentage:t})})}},{key:'render',value:function(){var e=this.props,t=e.vertical,a=e.label,r=e.valuenow,n=e.valuetext;return P.createElement('div',{className:W(this.props.className,{"video-react-slider-vertical":t,"video-react-slider-horizontal":!t,"video-react-sliding":this.state.active},'video-react-slider'),tabIndex:'0',onMouseDown:this.handleMouseDown,onTouchStart:this.handleMouseDown,onFocus:this.handleFocus,onBlur:this.handleBlur,onClick:this.handleClick,"aria-label":a||'',"aria-valuenow":r||'',"aria-valuetext":n||'',"aria-valuemin":0,"aria-valuemax":100},this.renderChildren())}}]),t}(t.Component);ue.propTypes=pe,ue.displayName='Slider';var ce={percentage:V.string,vertical:V.bool,className:V.string};v.defaultProps={percentage:'100%',vertical:!1},v.propTypes=ce,v.displayName='VolumeLevel';var ge={actions:V.object,player:V.object,className:V.string,onFocus:V.func,onBlur:V.func},fe=function(e){function t(e,a){w(this,t);var r=G(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a));return r.state={percentage:'0%'},r.handleMouseMove=r.handleMouseMove.bind(r),r.handlePercentageChange=r.handlePercentageChange.bind(r),r.checkMuted=r.checkMuted.bind(r),r.getPercent=r.getPercent.bind(r),r.stepForward=r.stepForward.bind(r),r.stepBack=r.stepBack.bind(r),r.handleFocus=r.handleFocus.bind(r),r.handleBlur=r.handleBlur.bind(r),r.handleClick=r.handleClick.bind(r),r}return B(t,e),M(t,[{key:'componentDidMount',value:function(){}},{key:'getPercent',value:function(){var e=this.props.player;return e.muted?0:e.volume}},{key:'checkMuted',value:function(){var e=this.props,t=e.player,a=e.actions;t.muted&&a.mute(!1)}},{key:'handleMouseMove',value:function(e){var t=this.props.actions;this.checkMuted();var a=this.slider.calculateDistance(e);t.changeVolume(a)}},{key:'stepForward',value:function(){var e=this.props,t=e.player,a=e.actions;this.checkMuted(),a.changeVolume(t.volume+.1)}},{key:'stepBack',value:function(){var e=this.props,t=e.player,a=e.actions;this.checkMuted(),a.changeVolume(t.volume-.1)}},{key:'handleFocus',value:function(t){this.props.onFocus&&this.props.onFocus(t)}},{key:'handleBlur',value:function(t){this.props.onBlur&&this.props.onBlur(t)}},{key:'handlePercentageChange',value:function(e){e!==this.state.percentage&&this.setState({percentage:e})}},{key:'handleClick',value:function(e){e.stopPropagation()}},{key:'render',value:function(){var e=this,t=this.props.player,a=(100*t.volume).toFixed(2);return P.createElement(ue,U({ref:function(t){e.slider=t},label:'volume level',valuenow:a,valuetext:a+'%',onMouseMove:this.handleMouseMove,onFocus:this.handleFocus,onBlur:this.handleBlur,onClick:this.handleClick,sliderActive:this.handleFocus,sliderInactive:this.handleBlur,getPercent:this.getPercent,onPercentageChange:this.handlePercentageChange,stepForward:this.stepForward,stepBack:this.stepBack},this.props,{className:'video-volume-bar video-control'}),P.createElement(v,this.props))}}]),t}(t.Component);fe.propTypes=ge,fe.displayName='VolumeBar';var ye={player:V.object,actions:V.object,className:V.string},me=function(e){function t(e,a){w(this,t);var r=G(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a));return r.state={active:!1},r.handleClick=r.handleClick.bind(r),r.handleFocus=r.handleFocus.bind(r),r.handleBlur=r.handleBlur.bind(r),r}return B(t,e),M(t,[{key:'handleClick',value:function(){var e=this.props,t=e.player,a=e.actions;a.mute(!t.muted)}},{key:'handleFocus',value:function(){this.setState({active:!0})}},{key:'handleBlur',value:function(){this.setState({active:!1})}},{key:'render',value:function(){var e=this.props.player,t=this.volumeLevel;return P.createElement('div',{className:W({"video-vol-slider-active":this.state.active},'video-volume-menu')},P.createElement('button',{className:W({"video-vol-muted":e.muted,"video-vol-0":0===t&&!e.muted,"video-vol-1":1===t,"video-vol-2":2===t,"video-vol-3":3===t},'video-volume-button video-control','tool-tip'),onClick:this.handleClick,onFocus:this.handleFocus,onBlur:this.handleBlur},P.createElement('div',{className:'tool-tip-text top-center'},'\xC2m lu\u1EE3ng')),P.createElement(fe,U({onFocus:this.handleFocus,onBlur:this.handleBlur},this.props)))}},{key:'volumeLevel',get:function(){var e=this.props.player,t=e.volume,a=e.muted,r=3;return 0===t||a?r=0:.33>t?r=1:.67>t&&(r=2),r}}]),t}(t.Component);me.propTypes=ye,me.displayName='VolumeMenuButton';var he={currentTime:V.number,duration:V.number,percentage:V.string,className:V.string};E.propTypes=he,E.displayName='PlayProgressBar';var ve={duration:V.number,buffered:V.object};b.propTypes=ve,b.displayName='LoadProgressBar',T.propTypes={duration:V.number,mouseTime:V.object},T.displayName='MouseTimeDisplay';var Ee={player:V.object,mouseTime:V.object,actions:V.object,className:V.string},be=function(e){function t(e,a){w(this,t);var r=G(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a));return r.getPercent=r.getPercent.bind(r),r.getNewTime=r.getNewTime.bind(r),r.stepForward=r.stepForward.bind(r),r.stepBack=r.stepBack.bind(r),r.handleMouseDown=r.handleMouseDown.bind(r),r.handleMouseMove=r.handleMouseMove.bind(r),r.handleMouseUp=r.handleMouseUp.bind(r),r}return B(t,e),M(t,[{key:'componentDidMount',value:function(){}},{key:'componentDidUpdate',value:function(){}},{key:'getPercent',value:function(){var e=this.props.player,t=e.currentTime,a=e.seekingTime,r=e.duration,n=(a||t)/r;return 1<=n?1:n}},{key:'getNewTime',value:function(e){var t=this.props.player.duration,a=this.slider.calculateDistance(e),r=a*t;return r===t?r-.1:r}},{key:'handleMouseDown',value:function(){}},{key:'handleMouseUp',value:function(e){var t=this.props.actions,a=this.getNewTime(e);t.seek(a),t.handleEndSeeking(a)}},{key:'handleMouseMove',value:function(e){var t=this.props.actions,a=this.getNewTime(e);t.handleSeekingTime(a)}},{key:'stepForward',value:function(){var e=this.props.actions;e.forward(5)}},{key:'stepBack',value:function(){var e=this.props.actions;e.replay(5)}},{key:'render',value:function(){var e=this,t=this.props,a=t.player,r=a.currentTime,n=a.seekingTime,o=a.duration,i=a.buffered,d=t.mouseTime,s=n||r;return P.createElement(ue,{ref:function(t){e.slider=t},label:'video progress bar',className:'video-progress-control-box video-control',valuenow:(100*this.getPercent()).toFixed(2),valuetext:c(s,o),onMouseDown:this.handleMouseDown,onMouseMove:this.handleMouseMove,onMouseUp:this.handleMouseUp,getPercent:this.getPercent,stepForward:this.stepForward,stepBack:this.stepBack},P.createElement(b,{buffered:i,currentTime:s,duration:o}),P.createElement(T,{duration:o,mouseTime:d}),P.createElement(E,{currentTime:s,duration:o}))}}]),t}(t.Component);be.propTypes=Ee,be.displayName='SeekBar';var Te={player:V.object,className:V.string},Se=function(e){function t(e,a){w(this,t);var r=G(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a));return r.state={mouseTime:{time:null,position:0}},r.handleMouseMoveThrottle=r.handleMouseMove.bind(r),r}return B(t,e),M(t,[{key:'handleMouseMove',value:function(e){if(e.pageX){var t=this.props.player.duration,r=a.findDOMNode(this.seekBar),n=m(r,e).x*t,o=e.pageX-y(r).left;this.setState({mouseTime:{time:n,position:o}})}}},{key:'render',value:function(){var e=this;return P.createElement('div',{onMouseMove:this.handleMouseMoveThrottle,className:'video-progress-control video-control'},P.createElement(be,U({mouseTime:this.state.mouseTime,ref:function(t){e.seekBar=t}},this.props)))}}]),t}(t.Component);Se.propTypes=Te,Se.displayName='ProgressControl';var _e={actions:V.object,player:V.object},Re=function(e){function t(e,a){w(this,t);var r=G(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a));return r.handleClick=r.handleClick.bind(r),r}return B(t,e),M(t,[{key:'shouldComponentUpdate',value:function(e){return e.player.isFullscreen!==this.props.player.isFullscreen}}]),M(t,[{key:'handleClick',value:function(){var e=this.props,t=e.player,a=e.actions;a.toggleFullscreen(t)}},{key:'render',value:function(){var e=this,t=this.props.player;return P.createElement('button',{className:W({"ekiio-video-icon-fullscreen-exit":t.isFullscreen,"ekiio-video-icon-fullscreen":!t.isFullscreen},'video-fullscreen-control video-control ekiio-video-icon','tool-tip'),ref:function(t){e.button=t},tabIndex:'0',onClick:this.handleClick},P.createElement('div',{className:'tool-tip-text top-left'},this.props.player.isFullscreen?'Tho\xE1t ch\u1EBF \u0111\u1ED9 to\xE0n m\xE0n h\xECnh':'To\xE0n m\xE0n h\xECnh'))}}]),t}(t.Component);Re.propTypes=_e,Re.displayName='FullscreenToggle';var Ae=function(e){function t(){return w(this,t),G(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return B(t,e),M(t,[{key:'render',value:function(){return P.createElement('button',{className:'ekiio-video-icon ekiio-video-icon-setting video-control tool-tip',onClick:this.props.toggleSetting},P.createElement('div',{className:'tool-tip-text top-center'},'Tu\u1EF3 ch\u1EC9nh'))}}]),t}(P.PureComponent),ke={player:V.object};S.propTypes=ke,S.displayName='CurrentTimeDisplay';var Le={player:V.object};_.propTypes=Le,_.displayName='DurationDisplay';var De=function(e){var t=[P.createElement(le,U({key:'toggle-play'},e)),P.createElement(me,U({key:'volume-menu-button'},e)),P.createElement(S,{key:'current-time-display',player:e.player}),P.createElement(Se,U({key:'progress-control'},e)),P.createElement(_,{key:'duration-display',player:e.player}),P.createElement(Ae,U({key:'setting-popup-toggle'},e)),P.createElement(Re,U({key:'full-screen-toggle'},e))];return P.createElement('div',{className:W('control-bar','control-bar-auto-hide')},t)},Pe='undefined'!=typeof window&&window.navigator?window.navigator.userAgent:'',Ce=/iPad/i.test(Pe),Ie=/iPhone/i.test(Pe)&&!Ce,Oe=/iPod/i.test(Pe),Fe={clickable:V.bool,dblclickable:V.bool,manager:V.object,actions:V.object,player:V.object,shortcuts:V.array},xe=function(e){function t(e,a){w(this,t);var r=G(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a));return r.defaultShortcuts=[{keyCode:32,handle:r.togglePlay},{keyCode:75,handle:r.togglePlay},{keyCode:70,handle:r.toggleFullscreen},{keyCode:37,handle:function(e,t){e.hasStarted&&t.replay(5,{action:'replay-5',source:'shortcut'})}},{keyCode:74,handle:function(e,t){e.hasStarted&&t.replay(10,{action:'replay-10',source:'shortcut'})}},{keyCode:39,handle:function(e,t){e.hasStarted&&t.forward(5,{action:'forward-5',source:'shortcut'})}},{keyCode:76,handle:function(e,t){e.hasStarted&&t.forward(10,{action:'forward-10',source:'shortcut'})}},{keyCode:36,handle:function(e,t){e.hasStarted&&t.seek(0)}},{keyCode:35,handle:function(e,t){e.hasStarted&&t.seek(e.duration)}},{keyCode:38,handle:function(e,t){var a=e.volume+.05;1<a&&(a=1),t.changeVolume(a,{action:'volume-up',source:'shortcut'})}},{keyCode:40,handle:function(e,t){var a=e.volume-.05;0>a&&(a=0);var r=0<a?'volume-down':'volume-off';t.changeVolume(a,{action:r,source:'shortcut'})}},{keyCode:190,shift:!0,handle:function(e,t){var a=e.playbackRate;1.5<=a?a=2:1.25<=a?a=1.5:1<=a?a=1.25:.5<=a?a=1:.25<=a?a=.5:0<=a&&(a=.25),t.changeRate(a,{action:'fast-forward',source:'shortcut'})}},{keyCode:188,shift:!0,handle:function(e,t){var a=e.playbackRate;.5>=a?a=.25:1>=a?a=.5:1.25>=a?a=1:1.5>=a?a=1.25:2>=a&&(a=1.5),t.changeRate(a,{action:'fast-rewind',source:'shortcut'})}}],r.shortcuts=[].concat(K(r.defaultShortcuts)),r.mergeShortcuts=r.mergeShortcuts.bind(r),r.handleKeyPress=r.handleKeyPress.bind(r),r.handleClick=r.handleClick.bind(r),r.handleDoubleClick=r.handleDoubleClick.bind(r),r}return B(t,e),M(t,[{key:'componentDidMount',value:function(){this.mergeShortcuts(),document.addEventListener('keydown',this.handleKeyPress),document.addEventListener('click',this.handleClick),document.addEventListener('dblclick',this.handleDoubleClick)}},{key:'componentDidUpdate',value:function(e){e.shortcuts!==this.props.shortcuts&&this.mergeShortcuts()}},{key:'componentWillUnmount',value:function(){document.removeEventListener('keydown',this.handleKeyPress),document.removeEventListener('click',this.handleClick),document.removeEventListener('dblclick',this.handleDoubleClick)}},{key:'mergeShortcuts',value:function(){var e=function(e){var t=0;return['ctrl','shift','alt'].forEach(function(a){e[a]&&t++}),t},t=(this.props.shortcuts||[]).filter(function(e){return e.keyCode&&e.handle&&'function'==typeof e.handle});this.shortcuts=[].concat(K(t),K(this.defaultShortcuts)).sort(function(t,a){return e(a)-e(t)})}},{key:'togglePlay',value:function(e,t){e.paused?t.play({action:'play',source:'shortcut'}):t.pause({action:'pause',source:'shortcut'})}},{key:'toggleFullscreen',value:function(e,t){t.toggleFullscreen(e)}},{key:'handleKeyPress',value:function(t){var e=this.props,a=e.player,r=e.actions;if(a.isActive&&!(document.activeElement&&(h(document.activeElement,'video-control')||h(document.activeElement,'video-menu-button-active')||h(document.activeElement,'video-big-play-button')))){var n=t.keyCode||t.which,o=t.ctrlKey||t.metaKey,i=t.shiftKey,d=t.altKey,s=this.shortcuts.filter(function(e){return!!(e.keyCode&&0==e.keyCode-n)&&(void 0===e.ctrl||e.ctrl===o)&&(void 0===e.shift||e.shift===i)&&(void 0===e.alt||e.alt===d)})[0];s&&(s.handle(a,r),t.preventDefault())}}},{key:'canBeClicked',value:function(t,a){return!!(t.isActive&&'VIDEO'===a.target.nodeName&&4===t.readyState)}},{key:'handleClick',value:function(t){var e=this.props,a=e.player,r=e.actions,n=e.clickable;this.canBeClicked(a,t)&&n&&this.togglePlay(a,r)}},{key:'handleDoubleClick',value:function(t){var e=this.props,a=e.player,r=e.actions,n=e.dblclickable;this.canBeClicked(a,t)&&n&&this.toggleFullscreen(a,r)}},{key:'render',value:function(){return null}}]),t}(t.Component);xe.propTypes=Fe,xe.defaultProps={clickable:!0,dblclickable:!0},xe.displayName='Shortcut';var Ne={player:V.object},we=function(e){function t(){return w(this,t),G(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return B(t,e),M(t,[{key:'render',value:function(){var e=this.props.player;return e.error?null:P.createElement('div',{className:'video-loading-spinner'},P.createElement('div',null),P.createElement('div',null))}}]),t}(P.Component);we.propTypes=Ne,we.displayName=' LoadingSpinner';var Me={poster:V.string,player:V.object,actions:V.object},Ue=function(e){function t(){return w(this,t),G(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return B(t,e),M(t,[{key:'shouldComponentUpdate',value:function(e){return e.player.hasStarted!==this.props.player.hasStarted}},{key:'render',value:function(){var e=this.props,t=e.player,a=e.actions;return t.hasStarted?null:P.createElement('button',{className:'video-big-play-button video-control',onClick:function(){t.paused&&a.play()}})}}]),t}(P.Component);Ue.propTypes=Me,Ue.displayName='BigPlayButton';var Be={manager:V.object},Ge=function(e){function t(e,a){w(this,t);var r=G(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a));return r.timer=null,e.manager.subscribeToOperationStateChange(r.handleStateChange.bind(r)),r.state={hidden:!0,operation:{}},r}return B(t,e),M(t,[{key:'handleStateChange',value:function(e,t){var a=this;e.count!==t.count&&'shortcut'===e.operation.source&&(this.timer&&(clearTimeout(this.timer),this.timer=null),this.setState({hidden:!1,count:e.count,operation:e.operation}),this.timer=setTimeout(function(){a.setState({hidden:!0}),a.timer=null},500))}},{key:'render',value:function(){if('shortcut'!==this.state.operation.source)return null;var e=this.state.hidden?{display:'block'}:null;return P.createElement('div',{className:W({"video-bezel":!0,"video-bezel-animation":0==this.state.count%2,"video-bezel-animation-alt":1==this.state.count%2}),style:e,role:'status',"aria-label":this.state.operation.action},P.createElement('div',{className:W('ekiio-video-bezel-icon','ekiio-video-bezel-icon-'+this.state.operation.action)}))}}]),t}(t.Component);Ge.propTypes=Be,Ge.displayName='Bezel';var Ke={children:V.any,muted:V.bool,playsInline:V.bool,aspectRatio:V.string,className:V.string,videoId:V.string,startTime:V.number,loop:V.bool,autoPlay:V.bool,src:V.string,poster:V.string,preload:V.oneOf(['auto','metadata','none']),onLoadStart:V.func,onWaiting:V.func,onCanPlay:V.func,onCanPlayThrough:V.func,onPlaying:V.func,onEnded:V.func,onSeeking:V.func,onSeeked:V.func,onPlay:V.func,onPause:V.func,onProgress:V.func,onDurationChange:V.func,onError:V.func,onSuspend:V.func,onAbort:V.func,onEmptied:V.func,onStalled:V.func,onLoadedMetadata:V.func,onLoadedData:V.func,onTimeUpdate:V.func,onRateChange:V.func,onVolumeChange:V.func,store:V.object},He=function(e){function t(e){w(this,t);var a=G(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.controlsHideTimer=null,a.video=null,a.manager=new te(e.store),a.actions=a.manager.getActions(),a.manager.subscribeToPlayerStateChange(a.handleStateChange.bind(a)),a.handleResize=a.handleResize.bind(a),a.getChildren=a.getChildren.bind(a),a.handleMouseMove=f(a.handleMouseMove.bind(a),250),a.handleMouseDown=a.handleMouseDown.bind(a),a.startControlsTimer=a.startControlsTimer.bind(a),a.handleFullScreenChange=a.handleFullScreenChange.bind(a),a.handleKeyDown=a.handleKeyDown.bind(a),a.handleFocus=a.handleFocus.bind(a),a.handleBlur=a.handleBlur.bind(a),a}return B(t,e),M(t,[{key:'componentDidMount',value:function(){this.handleResize(),window.addEventListener('resize',this.handleResize),Z.addEventListener(this.handleFullScreenChange)}},{key:'componentWillUnmount',value:function(){window.removeEventListener('resize',this.handleResize),Z.removeEventListener(this.handleFullScreenChange),this.controlsHideTimer&&window.clearTimeout(this.controlsHideTimer)}},{key:'getChildren',value:function(e){var t=this,a={actions:e.actions,player:e.player},r=e.HLS?P.createElement(ne,U({ref:function(e){t.video=e,t.manager.video=t.video},key:'video'},e),P.createElement(de,{isVideoChild:!0,src:e.src})):P.createElement(ne,U({ref:function(e){t.video=e,t.manager.video=t.video},key:'video'},e));return[r,P.createElement(De,U({key:'control-bar'},a,{toggleSetting:e.toggleSetting,rootElement:this.manager.rootElement})),P.createElement(xe,U({key:'short-cut'},a)),P.createElement(we,{key:'loading-spinner',player:e.player}),P.createElement(Ge,{key:'bezel',manager:e.manager})]}},{key:'getState',value:function(){return this.manager.getState()}},{key:'play',value:function(){this.video.play()}},{key:'pause',value:function(){this.video.pause()}},{key:'load',value:function(){this.video.load()}},{key:'addTextTrack',value:function(){var e;(e=this.video).addTextTrack.apply(e,arguments)}},{key:'canPlayType',value:function(){var e;(e=this.video).canPlayType.apply(e,arguments)}},{key:'seek',value:function(e){this.video.seek(e)}},{key:'forward',value:function(e){this.video.forward(e)}},{key:'replay',value:function(e){this.video.replay(e)}},{key:'toggleFullscreen',value:function(){this.video.toggleFullscreen()}},{key:'subscribeToStateChange',value:function(e){return this.manager.subscribeToPlayerStateChange(e)}},{key:'handleResize',value:function(){}},{key:'handleFullScreenChange',value:function(){this.actions.handleFullscreenChange(Z.isFullscreen)}},{key:'handleMouseDown',value:function(){this.startControlsTimer()}},{key:'handleMouseMove',value:function(){this.startControlsTimer()}},{key:'handleKeyDown',value:function(){this.startControlsTimer()}},{key:'startControlsTimer',value:function(){var e=this;this.actions.userActivate(!0),clearTimeout(this.controlsHideTimer),this.controlsHideTimer=setTimeout(function(){e.actions.userActivate(!1)},3e3)}},{key:'handleStateChange',value:function(e,t){e.isFullscreen!==t.isFullscreen&&this.handleResize(),this.forceUpdate()}},{key:'handleFocus',value:function(){this.actions.activate(!0)}},{key:'handleBlur',value:function(){this.actions.activate(!1)}},{key:'render',value:function(){var e=this,t=this.manager.getState(),a=t.player,r=a.paused,n=a.hasStarted,o=a.waiting,i=a.seeking,d=a.isFullscreen,s=a.userActivity,l=a.readyState,p=U({},this.props,{player:a,src:this.props.src,actions:this.actions,manager:this.manager,store:this.manager.store,video:this.video?this.video.video:null}),u=this.getChildren(p);return P.createElement('div',{className:W({"video-has-started":n,"video-paused":r,"video-playing":!r,"video-waiting":o,"video-seeking":i,"video-fullscreen":d,"video-user-inactive":!s,"video-user-active":s,"video-workinghover":!(Ie||Ce||Oe),"video-not-ready":2>l},'ekiio-video-player',this.props.className),ref:function(t){e.manager.rootElement=t},onTouchStart:this.handleMouseDown,onMouseDown:this.handleMouseDown,onMouseMove:this.handleMouseMove,onKeyDown:this.handleKeyDown,onFocus:this.handleFocus,onBlur:this.handleBlur,tabIndex:'-1'},P.Children.map(this.props.children,function(t){return P.cloneElement(t,{player:a,actions:e.actions})}),u)}},{key:'playbackRate',get:function(){return this.video.playbackRate},set:function(e){this.video.playbackRate=e}},{key:'muted',get:function(){return this.video.muted},set:function(e){this.video.muted=e}},{key:'volume',get:function(){return this.video.volume},set:function(e){this.video.volume=e}},{key:'videoWidth',get:function(){return this.video.videoWidth}},{key:'videoHeight',get:function(){return this.video.videoHeight}}]),t}(t.Component);He.contextTypes={store:V.object},He.propTypes=Ke,He.defaultProps={HLS:!1},He.displayName='Player';var Ve={actions:V.object,player:V.object},We=function(e){function t(e,a){return w(this,t),G(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a))}return B(t,e),M(t,[{key:'shouldComponentUpdate',value:function(){return!1}},{key:'render',value:function(){return P.createElement('button',{className:'btn-switch-sub',type:'button',onClick:this.props.toggleSubVi},'VI/EN')}}]),t}(P.Component);We.propTypes=Ve,e.Player=He,e.Video=ne,e.TogglePlay=le,e.CurrentTime=S,e.ChangeSubVi=We,Object.defineProperty(e,'__esModule',{value:!0})});
//# sourceMappingURL=ekiio-video-react.full.min.js.map
